<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive BOM for KiCAD</title>
  <style type="text/css">
:root {
  --pcb-edge-color: black;
  --pad-color: #878787;
  --pad-hole-color: #CCCCCC;
  --pad-color-highlight: #D04040;
  --pin1-outline-color: #ffb629;
  --pin1-outline-color-highlight: #b4ff03;
  --silkscreen-edge-color: #aa4;
  --silkscreen-polygon-color: #4aa;
  --silkscreen-text-color: #4aa;
  --fabrication-edge-color: #907651;
  --fabrication-polygon-color: #907651;
  --fabrication-text-color: #a27c24;
  --track-color: #def5f1;
  --track-color-highlight: #D04040;
  --zone-color: #def5f1;
  --zone-color-highlight: #d0404080;
}

html, body {
  margin: 0px;
  height: 100%;
  font-family: Verdana, sans-serif;
}

.dark.topmostdiv {
  --pcb-edge-color: #eee;
  --pad-color: #808080;
  --pin1-outline-color: #ffa800;
  --pin1-outline-color-highlight: #ccff00;
  --track-color: #42524f;
  --zone-color: #42524f;
  background-color: #252c30;
  color: #eee;
}

button {
  background-color: #eee;
  border: 1px solid #888;
  color: black;
  height: 44px;
  width: 44px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  font-weight: bolder;
}

.dark button {
  /* This will be inverted */
  background-color: #c3b7b5;
}

button.depressed {
  background-color: #0a0;
  color: white;
}

.dark button.depressed {
  /* This will be inverted */
  background-color: #b3b;
}

button:focus {
  outline: 0;
}

button#tb-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' fill='none' stroke='%23000' stroke-width='.4' stroke-linejoin='round'/%3E%3Cpath d='M1.32 290.12h5.82M1.32 291.45h5.82' fill='none' stroke='%23000' stroke-width='.4'/%3E%3Cpath d='M4.37 292.5v4.23M.26 292.63H8.2' fill='none' stroke='%23000' stroke-width='.3'/%3E%3Ctext font-weight='700' font-size='3.17' font-family='sans-serif'%3E%3Ctspan x='1.35' y='295.73'%3EF%3C/tspan%3E%3Ctspan x='5.03' y='295.68'%3EB%3C/tspan%3E%3C/text%3E%3C/g%3E%3C/svg%3E%0A");
}

button#lr-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' fill='none' stroke='%23000' stroke-width='.4' stroke-linejoin='round'/%3E%3Cpath d='M1.06 290.12H3.7m-2.64 1.33H3.7m-2.64 1.32H3.7m-2.64 1.3H3.7m-2.64 1.33H3.7' fill='none' stroke='%23000' stroke-width='.4'/%3E%3Cpath d='M4.37 288.8v7.94m0-4.11h3.96' fill='none' stroke='%23000' stroke-width='.3'/%3E%3Ctext font-weight='700' font-size='3.17' font-family='sans-serif'%3E%3Ctspan x='5.11' y='291.96'%3EF%3C/tspan%3E%3Ctspan x='5.03' y='295.68'%3EB%3C/tspan%3E%3C/text%3E%3C/g%3E%3C/svg%3E%0A");
}

button#bom-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)' fill='none' stroke='%23000' stroke-width='.4'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' stroke-linejoin='round'/%3E%3Cpath d='M1.59 290.12h5.29M1.59 291.45h5.33M1.59 292.75h5.33M1.59 294.09h5.33M1.59 295.41h5.33'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-grouped-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg stroke='%23000' stroke-linejoin='round' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-linecap='square' stroke-width='2' d='M6 10h4m4 0h5m4 0h3M6.1 22h3m3.9 0h5m4 0h4m-16-8h4m4 0h4'/%3E%3Cpath stroke-linecap='null' d='M5 17.5h22M5 26.6h22M5 5.5h22'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-ungrouped-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg stroke='%23000' stroke-linejoin='round' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-linecap='square' stroke-width='2' d='M6 10h4m-4 8h3m-3 8h4'/%3E%3Cpath stroke-linecap='null' d='M5 13.5h22m-22 8h22M5 5.5h22'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-netlist-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg fill='none' stroke='%23000' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-width='2' d='M6 26l6-6v-8m13.8-6.3l-6 6v8'/%3E%3Ccircle cx='11.8' cy='9.5' r='2.8' stroke-width='2'/%3E%3Ccircle cx='19.8' cy='22.8' r='2.8' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E");
}

button#copy {
  background-image: url("data:image/svg+xml,%3Csvg height='48' viewBox='0 0 48 48' width='48' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h48v48h-48z' fill='none'/%3E%3Cpath d='M32 2h-24c-2.21 0-4 1.79-4 4v28h4v-28h24v-4zm6 8h-22c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h22c2.21 0 4-1.79 4-4v-28c0-2.21-1.79-4-4-4zm0 32h-22v-28h22v28z'/%3E%3C/svg%3E");
  background-position: 6px 6px;
  background-repeat: no-repeat;
  background-size: 26px 26px;
  border-radius: 6px;
  height: 40px;
  width: 40px;
  margin: 10px 5px;
}

button#copy:active {
    box-shadow: inset 0px 0px 5px #6c6c6c;
}

textarea.clipboard-temp {
  position: fixed;
  top: 0;
  left: 0;
  width: 2em;
  height: 2em;
  padding: 0;
  border: None;
  outline: None;
  box-shadow: None;
  background: transparent;
}

.left-most-button {
  border-right: 0;
  border-top-left-radius: 6px;
  border-bottom-left-radius: 6px;
}

.middle-button {
  border-right: 0;
}

.right-most-button {
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
}

.button-container {
  font-size: 0;
  margin: 10px 10px 10px 0px;
}

.dark .button-container {
  filter: invert(1);
}

.button-container button {
  background-size: 32px 32px;
  background-position: 5px 5px;
  background-repeat: no-repeat;
}

@media print {
  .hideonprint {
    display: none;
  }
}

canvas {
  cursor: crosshair;
}

canvas:active {
  cursor: grabbing;
}

.fileinfo {
  width: 100%;
  max-width: 1000px;
  border: none;
  padding: 5px;
}

.fileinfo .title {
  font-size: 20pt;
  font-weight: bold;
}

.fileinfo td {
  overflow: hidden;
  white-space: nowrap;
  max-width: 1px;
  width: 50%;
  text-overflow: ellipsis;
}

.bom {
  border-collapse: collapse;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 10pt;
  table-layout: fixed;
  width: 100%;
  margin-top: 1px;
}

.bom th, .bom td {
  border: 1px solid black;
  padding: 5px;
  word-wrap: break-word;
  text-align: center;
  position: relative;
}

.dark .bom th, .dark .bom td {
  border: 1px solid #777;
}

.bom th {
  background-color: #CCCCCC;
  background-clip: padding-box;
}

.dark .bom th {
  background-color: #3b4749;
}

.bom tr.highlighted:nth-child(n) {
  background-color: #cfc;
}

.dark .bom tr.highlighted:nth-child(n) {
  background-color: #226022;
}

.bom tr:nth-child(even) {
  background-color: #f2f2f2;
}

.dark .bom tr:nth-child(even) {
  background-color: #313b40;
}

.bom tr.checked {
  color: #aaa;
}

.dark .bom tr.checked {
  color: #666;
}

.bom tr {
  transition: background-color 0.2s;
}

.bom .numCol {
  width: 25px;
}

.bom .Description {
  width: 10%;
}

.bom .Part {
  width: 10%;
}

.bom .Value {
  width: 15%;
}

.bom .Quantity {
  width: 65px;
}

.bom th .sortmark {
  position: absolute;
  right: 1px;
  top: 1px;
  margin-top: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #221 transparent;
  transform-origin: 50% 85%;
  transition: opacity 0.2s, transform 0.4s;
}

.dark .bom th .sortmark {
  filter: invert(1);
}

.bom th .sortmark.none {
  opacity: 0;
}

.bom th .sortmark.desc {
  transform: rotate(180deg);
}

.bom th:hover .sortmark.none {
  opacity: 0.5;
}

.bom .bom-checkbox {
  width: 30px;
  position: relative;
  user-select: none;
  -moz-user-select: none;
}

.bom .bom-checkbox:before {
  content: "";
  position: absolute;
  border-width: 15px;
  border-style: solid;
  border-color: #51829f transparent transparent transparent;
  visibility: hidden;
  top: -15px;
}

.bom .bom-checkbox:after {
  content: "Double click to set/unset all";
  position: absolute;
  color: white;
  top: -35px;
  left: -26px;
  background: #51829f;
  padding: 5px 15px;
  border-radius: 8px;
  white-space: nowrap;
  visibility: hidden;
}

.bom .bom-checkbox:hover:before, .bom .bom-checkbox:hover:after {
  visibility: visible;
  transition: visibility 0.2s linear 1s;
}

.split {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden;
  background-color: inherit;
}

.split.split-horizontal, .gutter.gutter-horizontal {
  height: 100%;
  float: left;
}

.gutter {
  background-color: #ddd;
  background-repeat: no-repeat;
  background-position: 50%;
  transition: background-color 0.3s;
}

.dark .gutter {
  background-color: #777;
}

.gutter.gutter-horizontal {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
  cursor: ew-resize;
  width: 5px;
}

.gutter.gutter-vertical {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=');
  cursor: ns-resize;
  height: 5px;
}

.searchbox {
  float: left;
  height: 40px;
  margin: 10px 5px;
  padding: 12px 32px;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 18px;
  box-sizing: border-box;
  border: 1px solid #888;
  border-radius: 6px;
  outline: none;
  background-color: #eee;
  transition: background-color 0.2s, border 0.2s;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABNklEQVQ4T8XSMUvDQBQH8P/LElFa/AIZHcTBQSz0I/gFstTBRR2KUC4ldDxw7h0Bl3RRUATxi4iiODgoiLNrbQYp5J6cpJJqomkX33Z37/14d/dIa33MzDuYI4johOI4XhyNRteO46zNYjDzAxE1yBZprVeZ+QbAUhXEGJMA2Ox2u4+fQIa0mPmsCgCgJYQ4t7lfgF0opQYAdv9ABkKI/UnOFCClXKjX61cA1osQY8x9kiRNKeV7IWA3oyhaSdP0FkAtjxhj3hzH2RBCPOf3pzqYHCilfAAX+URm9oMguPzeWSGQvUcMYC8rOBJCHBRdqxTo9/vbRHRqi8bj8XKv1xvODbiuW2u32/bvf0SlDv4XYOY7z/Mavu+nM1+BmQ+NMc0wDF/LprP0DbTWW0T00ul0nn4b7Q87+X4Qmfiq2wAAAABJRU5ErkJggg==');
  background-position: 10px 10px;
  background-repeat: no-repeat;
}

.dark .searchbox {
  background-color: #111;
  color: #eee;
}

.searchbox::placeholder {
  color: #ccc;
}

.dark .searchbox::placeholder {
  color: #666;
}

.filter {
  width: calc(60% - 64px);
}

.reflookup {
  width: calc(40% - 10px);
}

input[type=text]:focus {
  background-color: white;
  border: 1px solid #333;
}

.dark input[type=text]:focus {
  background-color: #333;
  border: 1px solid #ccc;
}

mark.highlight {
  background-color: #5050ff;
  color: #fff;
  padding: 2px;
  border-radius: 6px;
}

.dark mark.highlight {
  background-color: #76a6da;
  color: #111;
}

.menubtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 20 20'%3E%3Cpath fill='none' d='M0 0h20v20H0V0z'/%3E%3Cpath d='M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z'/%3E%3C/svg%3E%0A");
  background-position: center;
  background-repeat: no-repeat;
}

.statsbtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg width='36' height='36' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 6h28v24H4V6zm0 8h28v8H4m9-16v24h10V5.8' fill='none' stroke='%23000' stroke-width='2'/%3E%3C/svg%3E");
  background-position: center;
  background-repeat: no-repeat;
}

.iobtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36'%3E%3Cpath fill='none' stroke='%23000' stroke-width='2' d='M3 33v-7l6.8-7h16.5l6.7 7v7H3zM3.2 26H33M21 9l5-5.9 5 6h-2.5V15h-5V9H21zm-4.9 0l-5 6-5-6h2.5V3h5v6h2.5z'/%3E%3Cpath fill='none' stroke='%23000' d='M6.1 29.5H10'/%3E%3C/svg%3E");
  background-position: center;
  background-repeat: no-repeat;
}

.dark .statsbtn, .dark .savebtn, .dark .menubtn, .dark .iobtn {
  filter: invert(1);
}

.flexbox {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.savebtn {
  background-color: #d6d6d6;
  width: auto;
  height: 30px;
  flex-grow: 1;
  margin: 5px;
  border-radius: 4px;
}

.savebtn:active {
  background-color: #0a0;
  color: white;
}

.dark .savebtn:active {
  /* This will be inverted */
  background-color: #b3b;
}

.stats {
  border-collapse: collapse;
  font-size: 12pt;
  table-layout: fixed;
  width: 100%;
  min-width: 450px;
}

.dark .stats td {
  border: 1px solid #bbb;
}

.stats td {
  border: 1px solid black;
  padding: 5px;
  word-wrap: break-word;
  text-align: center;
  position: relative;
}

#checkbox-stats div {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

#checkbox-stats .bar {
  background-color: rgba(28, 251, 0, 0.6);
}

.menu {
  position: relative;
  display: inline-block;
  margin: 10px 10px 10px 0px;
}

.menu-content {
  display: none;
  position: absolute;
  background-color: white;
  right: 0;
  min-width: 300px;
  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
  z-index: 100;
  padding: 8px;
}

.dark .menu-content {
  background-color: #111;
}

.menu:hover .menu-content {
  display: block;
}

.menu:hover .menubtn, .menu:hover .iobtn, .menu:hover .statsbtn {
  background-color: #eee;
}

.menu-label {
  display: inline-block;
  padding: 8px;
  border: 1px solid #ccc;
  border-top: 0;
  width: calc(100% - 18px);
}

.menu-label-top {
  border-top: 1px solid #ccc;
}

.menu-textbox {
  float: left;
  height: 24px;
  margin: 10px 5px;
  padding: 5px 5px;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 14px;
  box-sizing: border-box;
  border: 1px solid #888;
  border-radius: 4px;
  outline: none;
  background-color: #eee;
  transition: background-color 0.2s, border 0.2s;
  width: calc(100% - 10px);
}

.menu-textbox.invalid, .dark .menu-textbox.invalid {
  color: red;
}

.dark .menu-textbox {
  background-color: #222;
  color: #eee;
}

.radio-container {
  margin: 4px;
}

.topmostdiv {
  width: 100%;
  height: 100%;
  background-color: white;
  transition: background-color 0.3s;
}

#top {
  height: 78px;
  border-bottom: 2px solid black;
}

.dark #top {
  border-bottom: 2px solid #ccc;
}

#dbg {
  display: block;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #aaa;
}

::-webkit-scrollbar-thumb {
  background: #666;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  margin: 3px 0;
  padding: 0;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
  border-radius: 3px;
}

.slider:hover {
  opacity: 1;
}

.slider:focus {
  outline: none;
}

.slider::-webkit-slider-runnable-track {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  background: #d3d3d3;
  border-radius: 3px;
  border: none;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
  margin-top: -4px;
}

.dark .slider::-webkit-slider-thumb {
  background: #3d3;
}

.slider::-moz-range-thumb {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
}

.slider::-moz-range-track {
  height: 8px;
  background: #d3d3d3;
  border-radius: 3px;
}

.dark .slider::-moz-range-thumb {
  background: #3d3;
}

.slider::-ms-track {
  width: 100%;
  height: 8px;
  border-width: 3px 0;
  background: transparent;
  border-color: transparent;
  color: transparent;
  transition: opacity .2s;
}

.slider::-ms-fill-lower {
  background: #d3d3d3;
  border: none;
  border-radius: 3px;
}

.slider::-ms-fill-upper {
  background: #d3d3d3;
  border: none;
  border-radius: 3px;
}

.slider::-ms-thumb {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
  margin: 0;
}

.shameless-plug {
  font-size: 0.8em;
  text-align: center;
  display: block;
}

a {
  color: #0278a4;
}

.dark a {
  color: #00b9fd;
}

#frontcanvas, #backcanvas {
    touch-action: none;
}

 
  </style>
  <script type="text/javascript" >
///////////////////////////////////////////////
/*
  Split.js - v1.3.5
  MIT License
  https://github.com/nathancahill/Split.js
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Split=t()}(this,function(){"use strict";var e=window,t=e.document,n="addEventListener",i="removeEventListener",r="getBoundingClientRect",s=function(){return!1},o=e.attachEvent&&!e[n],a=["","-webkit-","-moz-","-o-"].filter(function(e){var n=t.createElement("div");return n.style.cssText="width:"+e+"calc(9px)",!!n.style.length}).shift()+"calc",l=function(e){return"string"==typeof e||e instanceof String?t.querySelector(e):e};return function(u,c){function z(e,t,n){var i=A(y,t,n);Object.keys(i).forEach(function(t){return e.style[t]=i[t]})}function h(e,t){var n=B(y,t);Object.keys(n).forEach(function(t){return e.style[t]=n[t]})}function f(e){var t=E[this.a],n=E[this.b],i=t.size+n.size;t.size=e/this.size*i,n.size=i-e/this.size*i,z(t.element,t.size,this.aGutterSize),z(n.element,n.size,this.bGutterSize)}function m(e){var t;this.dragging&&((t="touches"in e?e.touches[0][b]-this.start:e[b]-this.start)<=E[this.a].minSize+M+this.aGutterSize?t=E[this.a].minSize+this.aGutterSize:t>=this.size-(E[this.b].minSize+M+this.bGutterSize)&&(t=this.size-(E[this.b].minSize+this.bGutterSize)),f.call(this,t),c.onDrag&&c.onDrag())}function g(){var e=E[this.a].element,t=E[this.b].element;this.size=e[r]()[y]+t[r]()[y]+this.aGutterSize+this.bGutterSize,this.start=e[r]()[G]}function d(){var t=this,n=E[t.a].element,r=E[t.b].element;t.dragging&&c.onDragEnd&&c.onDragEnd(),t.dragging=!1,e[i]("mouseup",t.stop),e[i]("touchend",t.stop),e[i]("touchcancel",t.stop),t.parent[i]("mousemove",t.move),t.parent[i]("touchmove",t.move),delete t.stop,delete t.move,n[i]("selectstart",s),n[i]("dragstart",s),r[i]("selectstart",s),r[i]("dragstart",s),n.style.userSelect="",n.style.webkitUserSelect="",n.style.MozUserSelect="",n.style.pointerEvents="",r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",t.gutter.style.cursor="",t.parent.style.cursor=""}function S(t){var i=this,r=E[i.a].element,o=E[i.b].element;!i.dragging&&c.onDragStart&&c.onDragStart(),t.preventDefault(),i.dragging=!0,i.move=m.bind(i),i.stop=d.bind(i),e[n]("mouseup",i.stop),e[n]("touchend",i.stop),e[n]("touchcancel",i.stop),i.parent[n]("mousemove",i.move),i.parent[n]("touchmove",i.move),r[n]("selectstart",s),r[n]("dragstart",s),o[n]("selectstart",s),o[n]("dragstart",s),r.style.userSelect="none",r.style.webkitUserSelect="none",r.style.MozUserSelect="none",r.style.pointerEvents="none",o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",i.gutter.style.cursor=j,i.parent.style.cursor=j,g.call(i)}function v(e){e.forEach(function(t,n){if(n>0){var i=F[n-1],r=E[i.a],s=E[i.b];r.size=e[n-1],s.size=t,z(r.element,r.size,i.aGutterSize),z(s.element,s.size,i.bGutterSize)}})}function p(){F.forEach(function(e){e.parent.removeChild(e.gutter),E[e.a].element.style[y]="",E[e.b].element.style[y]=""})}void 0===c&&(c={});var y,b,G,E,w=l(u[0]).parentNode,D=e.getComputedStyle(w).flexDirection,U=c.sizes||u.map(function(){return 100/u.length}),k=void 0!==c.minSize?c.minSize:100,x=Array.isArray(k)?k:u.map(function(){return k}),L=void 0!==c.gutterSize?c.gutterSize:10,M=void 0!==c.snapOffset?c.snapOffset:30,O=c.direction||"horizontal",j=c.cursor||("horizontal"===O?"ew-resize":"ns-resize"),C=c.gutter||function(e,n){var i=t.createElement("div");return i.className="gutter gutter-"+n,i},A=c.elementStyle||function(e,t,n){var i={};return"string"==typeof t||t instanceof String?i[e]=t:i[e]=o?t+"%":a+"("+t+"% - "+n+"px)",i},B=c.gutterStyle||function(e,t){return n={},n[e]=t+"px",n;var n};"horizontal"===O?(y="width","clientWidth",b="clientX",G="left","paddingLeft"):"vertical"===O&&(y="height","clientHeight",b="clientY",G="top","paddingTop");var F=[];return E=u.map(function(e,t){var i,s={element:l(e),size:U[t],minSize:x[t]};if(t>0&&(i={a:t-1,b:t,dragging:!1,isFirst:1===t,isLast:t===u.length-1,direction:O,parent:w},i.aGutterSize=L,i.bGutterSize=L,i.isFirst&&(i.aGutterSize=L/2),i.isLast&&(i.bGutterSize=L/2),"row-reverse"===D||"column-reverse"===D)){var a=i.a;i.a=i.b,i.b=a}if(!o&&t>0){var c=C(t,O);h(c,L),c[n]("mousedown",S.bind(i)),c[n]("touchstart",S.bind(i)),w.insertBefore(c,s.element),i.gutter=c}0===t||t===u.length-1?z(s.element,s.size,L/2):z(s.element,s.size,L);var f=s.element[r]()[y];return f<s.minSize&&(s.minSize=f),t>0&&F.push(i),s}),o?{setSizes:v,destroy:p}:{setSizes:v,getSizes:function(){return E.map(function(e){return e.size})},collapse:function(e){if(e===F.length){var t=F[e-1];g.call(t),o||f.call(t,t.size-t.bGutterSize)}else{var n=F[e];g.call(n),o||f.call(n,n.aGutterSize)}},destroy:p}}});

///////////////////////////////////////////////

///////////////////////////////////////////////
// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>
// This work is free. You can redistribute it and/or modify it
// under the terms of the WTFPL, Version 2
// For more information see LICENSE.txt or http://www.wtfpl.net/
//
// For more information, the home page:
// http://pieroxy.net/blog/pages/lz-string/testing.html
//
// LZ-based compression algorithm, version 1.4.4
var LZString=function(){var o=String.fromCharCode,i={};var n={decompressFromBase64:function(o){return null==o?"":""==o?null:n._decompress(o.length,32,function(n){return function(o,n){if(!i[o]){i[o]={};for(var t=0;t<o.length;t++)i[o][o.charAt(t)]=t}return i[o][n]}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o.charAt(n))})},_decompress:function(i,n,t){var r,e,a,s,p,u,l,f=[],c=4,d=4,h=3,v="",g=[],m={val:t(0),position:n,index:1};for(r=0;r<3;r+=1)f[r]=r;for(a=0,p=Math.pow(2,2),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,p=Math.pow(2,8),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;l=o(a);break;case 1:for(a=0,p=Math.pow(2,16),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;l=o(a);break;case 2:return""}for(f[3]=l,e=l,g.push(l);;){if(m.index>i)return"";for(a=0,p=Math.pow(2,h),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;switch(l=a){case 0:for(a=0,p=Math.pow(2,8),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;f[d++]=o(a),l=d-1,c--;break;case 1:for(a=0,p=Math.pow(2,16),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;f[d++]=o(a),l=d-1,c--;break;case 2:return g.join("")}if(0==c&&(c=Math.pow(2,h),h++),f[l])v=f[l];else{if(l!==d)return null;v=e+e.charAt(0)}g.push(v),f[d++]=e+v.charAt(0),e=v,0==--c&&(c=Math.pow(2,h),h++)}}};return n}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module?module.exports=LZString:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return LZString});
///////////////////////////////////////////////

///////////////////////////////////////////////
/*!
 * PEP v0.4.3 | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 */
! function (a, b) {
  "object" == typeof exports && "undefined" != typeof module ? module.exports = b() : "function" == typeof define && define.amd ? define(b) : a.PointerEventsPolyfill = b()
}(this, function () {
  "use strict";

  function a(a, b) {
    b = b || Object.create(null);
    var c = document.createEvent("Event");
    c.initEvent(a, b.bubbles || !1, b.cancelable || !1);
    for (var d, e = 2; e < m.length; e++) d = m[e], c[d] = b[d] || n[e];
    c.buttons = b.buttons || 0;
    var f = 0;
    return f = b.pressure && c.buttons ? b.pressure : c.buttons ? .5 : 0, c.x = c.clientX, c.y = c.clientY, c.pointerId = b.pointerId || 0, c.width = b.width || 0, c.height = b.height || 0, c.pressure = f, c.tiltX = b.tiltX || 0, c.tiltY = b.tiltY || 0, c.twist = b.twist || 0, c.tangentialPressure = b.tangentialPressure || 0, c.pointerType = b.pointerType || "", c.hwTimestamp = b.hwTimestamp || 0, c.isPrimary = b.isPrimary || !1, c
  }

  function b() {
    this.array = [], this.size = 0
  }

  function c(a, b, c, d) {
    this.addCallback = a.bind(d), this.removeCallback = b.bind(d), this.changedCallback = c.bind(d), A && (this.observer = new A(this.mutationWatcher.bind(this)))
  }

  function d(a) {
    return "body /shadow-deep/ " + e(a)
  }

  function e(a) {
    return '[touch-action="' + a + '"]'
  }

  function f(a) {
    return "{ -ms-touch-action: " + a + "; touch-action: " + a + "; }"
  }

  function g() {
    if (F) {
      D.forEach(function (a) {
        String(a) === a ? (E += e(a) + f(a) + "\n", G && (E += d(a) + f(a) + "\n")) : (E += a.selectors.map(e) + f(a.rule) + "\n", G && (E += a.selectors.map(d) + f(a.rule) + "\n"))
      });
      var a = document.createElement("style");
      a.textContent = E, document.head.appendChild(a)
    }
  }

  function h() {
    if (!window.PointerEvent) {
      if (window.PointerEvent = a, window.navigator.msPointerEnabled) {
        var b = window.navigator.msMaxTouchPoints;
        Object.defineProperty(window.navigator, "maxTouchPoints", {
          value: b,
          enumerable: !0
        }), u.registerSource("ms", _)
      } else Object.defineProperty(window.navigator, "maxTouchPoints", {
        value: 0,
        enumerable: !0
      }), u.registerSource("mouse", N), void 0 !== window.ontouchstart && u.registerSource("touch", V);
      u.register(document)
    }
  }

  function i(a) {
    if (!u.pointermap.has(a)) {
      var b = new Error("InvalidPointerId");
      throw b.name = "InvalidPointerId", b
    }
  }

  function j(a) {
    for (var b = a.parentNode; b && b !== a.ownerDocument;) b = b.parentNode;
    if (!b) {
      var c = new Error("InvalidStateError");
      throw c.name = "InvalidStateError", c
    }
  }

  function k(a) {
    var b = u.pointermap.get(a);
    return 0 !== b.buttons
  }

  function l() {
    window.Element && !Element.prototype.setPointerCapture && Object.defineProperties(Element.prototype, {
      setPointerCapture: {
        value: W
      },
      releasePointerCapture: {
        value: X
      },
      hasPointerCapture: {
        value: Y
      }
    })
  }
  var m = ["bubbles", "cancelable", "view", "detail", "screenX", "screenY", "clientX", "clientY", "ctrlKey", "altKey", "shiftKey", "metaKey", "button", "relatedTarget", "pageX", "pageY"],
    n = [!1, !1, null, null, 0, 0, 0, 0, !1, !1, !1, !1, 0, null, 0, 0],
    o = window.Map && window.Map.prototype.forEach,
    p = o ? Map : b;
  b.prototype = {
    set: function (a, b) {
      return void 0 === b ? this["delete"](a) : (this.has(a) || this.size++, void(this.array[a] = b))
    },
    has: function (a) {
      return void 0 !== this.array[a]
    },
    "delete": function (a) {
      this.has(a) && (delete this.array[a], this.size--)
    },
    get: function (a) {
      return this.array[a]
    },
    clear: function () {
      this.array.length = 0, this.size = 0
    },
    forEach: function (a, b) {
      return this.array.forEach(function (c, d) {
        a.call(b, c, d, this)
      }, this)
    }
  };
  var q = ["bubbles", "cancelable", "view", "detail", "screenX", "screenY", "clientX", "clientY", "ctrlKey", "altKey", "shiftKey", "metaKey", "button", "relatedTarget", "buttons", "pointerId", "width", "height", "pressure", "tiltX", "tiltY", "pointerType", "hwTimestamp", "isPrimary", "type", "target", "currentTarget", "which", "pageX", "pageY", "timeStamp"],
    r = [!1, !1, null, null, 0, 0, 0, 0, !1, !1, !1, !1, 0, null, 0, 0, 0, 0, 0, 0, 0, "", 0, !1, "", null, null, 0, 0, 0, 0],
    s = {
      pointerover: 1,
      pointerout: 1,
      pointerenter: 1,
      pointerleave: 1
    },
    t = "undefined" != typeof SVGElementInstance,
    u = {
      pointermap: new p,
      eventMap: Object.create(null),
      captureInfo: Object.create(null),
      eventSources: Object.create(null),
      eventSourceList: [],
      registerSource: function (a, b) {
        var c = b,
          d = c.events;
        d && (d.forEach(function (a) {
          c[a] && (this.eventMap[a] = c[a].bind(c))
        }, this), this.eventSources[a] = c, this.eventSourceList.push(c))
      },
      register: function (a) {
        for (var b, c = this.eventSourceList.length, d = 0; d < c && (b = this.eventSourceList[d]); d++)
          b.register.call(b, a)
      },
      unregister: function (a) {
        for (var b, c = this.eventSourceList.length, d = 0; d < c && (b = this.eventSourceList[d]); d++)
          b.unregister.call(b, a)
      },
      contains: function (a, b) {
        try {
          return a.contains(b)
        } catch (c) {
          return !1
        }
      },
      down: function (a) {
        a.bubbles = !0, this.fireEvent("pointerdown", a)
      },
      move: function (a) {
        a.bubbles = !0, this.fireEvent("pointermove", a)
      },
      up: function (a) {
        a.bubbles = !0, this.fireEvent("pointerup", a)
      },
      enter: function (a) {
        a.bubbles = !1, this.fireEvent("pointerenter", a)
      },
      leave: function (a) {
        a.bubbles = !1, this.fireEvent("pointerleave", a)
      },
      over: function (a) {
        a.bubbles = !0, this.fireEvent("pointerover", a)
      },
      out: function (a) {
        a.bubbles = !0, this.fireEvent("pointerout", a)
      },
      cancel: function (a) {
        a.bubbles = !0, this.fireEvent("pointercancel", a)
      },
      leaveOut: function (a) {
        this.out(a), this.propagate(a, this.leave, !1)
      },
      enterOver: function (a) {
        this.over(a), this.propagate(a, this.enter, !0)
      },
      eventHandler: function (a) {
        if (!a._handledByPE) {
          var b = a.type,
            c = this.eventMap && this.eventMap[b];
          c && c(a), a._handledByPE = !0
        }
      },
      listen: function (a, b) {
        b.forEach(function (b) {
          this.addEvent(a, b)
        }, this)
      },
      unlisten: function (a, b) {
        b.forEach(function (b) {
          this.removeEvent(a, b)
        }, this)
      },
      addEvent: function (a, b) {
        a.addEventListener(b, this.boundHandler)
      },
      removeEvent: function (a, b) {
        a.removeEventListener(b, this.boundHandler)
      },
      makeEvent: function (b, c) {
        this.captureInfo[c.pointerId] && (c.relatedTarget = null);
        var d = new a(b, c);
        return c.preventDefault && (d.preventDefault = c.preventDefault), d._target = d._target || c.target, d
      },
      fireEvent: function (a, b) {
        var c = this.makeEvent(a, b);
        return this.dispatchEvent(c)
      },
      cloneEvent: function (a) {
        for (var b, c = Object.create(null), d = 0; d < q.length; d++) b = q[d], c[b] = a[b] || r[d], !t || "target" !== b && "relatedTarget" !== b || c[b] instanceof SVGElementInstance && (c[b] = c[b].correspondingUseElement);
        return a.preventDefault && (c.preventDefault = function () {
          a.preventDefault()
        }), c
      },
      getTarget: function (a) {
        var b = this.captureInfo[a.pointerId];
        return b ? a._target !== b && a.type in s ? void 0 : b : a._target
      },
      propagate: function (a, b, c) {
        for (var d = a.target, e = []; d !== document && !d.contains(a.relatedTarget);)
          if (e.push(d), d = d.parentNode, !d) return;
        c && e.reverse(), e.forEach(function (c) {
          a.target = c, b.call(this, a)
        }, this)
      },
      setCapture: function (b, c, d) {
        this.captureInfo[b] && this.releaseCapture(b, d), this.captureInfo[b] = c, this.implicitRelease = this.releaseCapture.bind(this, b, d), document.addEventListener("pointerup", this.implicitRelease), document.addEventListener("pointercancel", this.implicitRelease);
        var e = new a("gotpointercapture");
        e.pointerId = b, e._target = c, d || this.asyncDispatchEvent(e)
      },
      releaseCapture: function (b, c) {
        var d = this.captureInfo[b];
        if (d) {
          this.captureInfo[b] = void 0, document.removeEventListener("pointerup", this.implicitRelease), document.removeEventListener("pointercancel", this.implicitRelease);
          var e = new a("lostpointercapture");
          e.pointerId = b, e._target = d, c || this.asyncDispatchEvent(e)
        }
      },
      dispatchEvent: /*scope.external.dispatchEvent || */ function (a) {
        var b = this.getTarget(a);
        if (b) return b.dispatchEvent(a)
      },
      asyncDispatchEvent: function (a) {
        requestAnimationFrame(this.dispatchEvent.bind(this, a))
      }
    };
  u.boundHandler = u.eventHandler.bind(u);
  var v = {
      shadow: function (a) {
        if (a) return a.shadowRoot || a.webkitShadowRoot
      },
      canTarget: function (a) {
        return a && Boolean(a.elementFromPoint)
      },
      targetingShadow: function (a) {
        var b = this.shadow(a);
        if (this.canTarget(b)) return b
      },
      olderShadow: function (a) {
        var b = a.olderShadowRoot;
        if (!b) {
          var c = a.querySelector("shadow");
          c && (b = c.olderShadowRoot)
        }
        return b
      },
      allShadows: function (a) {
        for (var b = [], c = this.shadow(a); c;) b.push(c), c = this.olderShadow(c);
        return b
      },
      searchRoot: function (a, b, c) {
        if (a) {
          var d, e, f = a.elementFromPoint(b, c);
          for (e = this.targetingShadow(f); e;) {
            if (d = e.elementFromPoint(b, c)) {
              var g = this.targetingShadow(d);
              return this.searchRoot(g, b, c) || d
            }
            e = this.olderShadow(e)
          }
          return f
        }
      },
      owner: function (a) {
        for (var b = a; b.parentNode;) b = b.parentNode;
        return b.nodeType !== Node.DOCUMENT_NODE && b.nodeType !== Node.DOCUMENT_FRAGMENT_NODE && (b = document), b
      },
      findTarget: function (a) {
        var b = a.clientX,
          c = a.clientY,
          d = this.owner(a.target);
        return d.elementFromPoint(b, c) || (d = document), this.searchRoot(d, b, c)
      }
    },
    w = Array.prototype.forEach.call.bind(Array.prototype.forEach),
    x = Array.prototype.map.call.bind(Array.prototype.map),
    y = Array.prototype.slice.call.bind(Array.prototype.slice),
    z = Array.prototype.filter.call.bind(Array.prototype.filter),
    A = window.MutationObserver || window.WebKitMutationObserver,
    B = "[touch-action]",
    C = {
      subtree: !0,
      childList: !0,
      attributes: !0,
      attributeOldValue: !0,
      attributeFilter: ["touch-action"]
    };
  c.prototype = {
    watchSubtree: function (a) {
      //
      this.observer && v.canTarget(a) && this.observer.observe(a, C)
    },
    enableOnSubtree: function (a) {
      this.watchSubtree(a), a === document && "complete" !== document.readyState ? this.installOnLoad() : this.installNewSubtree(a)
    },
    installNewSubtree: function (a) {
      w(this.findElements(a), this.addElement, this)
    },
    findElements: function (a) {
      return a.querySelectorAll ? a.querySelectorAll(B) : []
    },
    removeElement: function (a) {
      this.removeCallback(a)
    },
    addElement: function (a) {
      this.addCallback(a)
    },
    elementChanged: function (a, b) {
      this.changedCallback(a, b)
    },
    concatLists: function (a, b) {
      return a.concat(y(b))
    },
    installOnLoad: function () {
      document.addEventListener("readystatechange", function () {
        "complete" === document.readyState && this.installNewSubtree(document)
      }.bind(this))
    },
    isElement: function (a) {
      return a.nodeType === Node.ELEMENT_NODE
    },
    flattenMutationTree: function (a) {
      var b = x(a, this.findElements, this);
      return b.push(z(a, this.isElement)), b.reduce(this.concatLists, [])
    },
    mutationWatcher: function (a) {
      a.forEach(this.mutationHandler, this)
    },
    mutationHandler: function (a) {
      if ("childList" === a.type) {
        var b = this.flattenMutationTree(a.addedNodes);
        b.forEach(this.addElement, this);
        var c = this.flattenMutationTree(a.removedNodes);
        c.forEach(this.removeElement, this)
      } else "attributes" === a.type && this.elementChanged(a.target, a.oldValue)
    }
  };
  var D = ["none", "auto", "pan-x", "pan-y", {
      rule: "pan-x pan-y",
      selectors: ["pan-x pan-y", "pan-y pan-x"]
    }],
    E = "",
    F = window.PointerEvent || window.MSPointerEvent,
    G = !window.ShadowDOMPolyfill && document.head.createShadowRoot,
    H = u.pointermap,
    I = 25,
    J = [1, 4, 2, 8, 16],
    K = !1;
  try {
    K = 1 === new MouseEvent("test", {
      buttons: 1
    }).buttons
  } catch (L) {}
  var M, N = {
      POINTER_ID: 1,
      POINTER_TYPE: "mouse",
      events: ["mousedown", "mousemove", "mouseup", "mouseover", "mouseout"],
      register: function (a) {
        u.listen(a, this.events)
      },
      unregister: function (a) {
        u.unlisten(a, this.events)
      },
      lastTouches: [],
      isEventSimulatedFromTouch: function (a) {
        for (var b, c = this.lastTouches, d = a.clientX, e = a.clientY, f = 0, g = c.length; f < g && (b = c[f]); f++) {
          var h = Math.abs(d - b.x),
            i = Math.abs(e - b.y);
          if (h <= I && i <= I) return !0
        }
      },
      prepareEvent: function (a) {
        var b = u.cloneEvent(a),
          c = b.preventDefault;
        return b.preventDefault = function () {
          a.preventDefault(), c()
        }, b.pointerId = this.POINTER_ID, b.isPrimary = !0, b.pointerType = this.POINTER_TYPE, b
      },
      prepareButtonsForMove: function (a, b) {
        var c = H.get(this.POINTER_ID);
        0 !== b.which && c ? a.buttons = c.buttons : a.buttons = 0, b.buttons = a.buttons
      },
      mousedown: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = H.get(this.POINTER_ID),
            c = this.prepareEvent(a);
          K || (c.buttons = J[c.button], b && (c.buttons |= b.buttons), a.buttons = c.buttons), H.set(this.POINTER_ID, a), b && 0 !== b.buttons ? u.move(c) : u.down(c)
        }
      },
      mousemove: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, H.set(this.POINTER_ID, a), u.move(b)
        }
      },
      mouseup: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = H.get(this.POINTER_ID),
            c = this.prepareEvent(a);
          if (!K) {
            var d = J[c.button];
            c.buttons = b ? b.buttons & ~d : 0, a.buttons = c.buttons
          }
          H.set(this.POINTER_ID, a),
            c.buttons &= ~J[c.button], 0 === c.buttons ? u.up(c) : u.move(c)
        }
      },
      mouseover: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, H.set(this.POINTER_ID, a), u.enterOver(b)
        }
      },
      mouseout: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, u.leaveOut(b)
        }
      },
      cancel: function (a) {
        var b = this.prepareEvent(a);
        u.cancel(b), this.deactivateMouse()
      },
      deactivateMouse: function () {
        H["delete"](this.POINTER_ID)
      }
    },
    O = u.captureInfo,
    P = v.findTarget.bind(v),
    Q = v.allShadows.bind(v),
    R = u.pointermap,
    S = 2500,
    T = 200,
    U = "touch-action",
    V = {
      events: ["touchstart", "touchmove", "touchend", "touchcancel"],
      register: function (a) {
        M.enableOnSubtree(a)
      },
      unregister: function () {},
      elementAdded: function (a) {
        var b = a.getAttribute(U),
          c = this.touchActionToScrollType(b);
        c && (a._scrollType = c, u.listen(a, this.events),
          Q(a).forEach(function (a) {
            a._scrollType = c, u.listen(a, this.events)
          }, this))
      },
      elementRemoved: function (a) {
        a._scrollType = void 0, u.unlisten(a, this.events),
          Q(a).forEach(function (a) {
            a._scrollType = void 0, u.unlisten(a, this.events)
          }, this)
      },
      elementChanged: function (a, b) {
        var c = a.getAttribute(U),
          d = this.touchActionToScrollType(c),
          e = this.touchActionToScrollType(b);
        d && e ? (a._scrollType = d, Q(a).forEach(function (a) {
          a._scrollType = d
        }, this)) : e ? this.elementRemoved(a) : d && this.elementAdded(a)
      },
      scrollTypes: {
        EMITTER: "none",
        XSCROLLER: "pan-x",
        YSCROLLER: "pan-y",
        SCROLLER: /^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/
      },
      touchActionToScrollType: function (a) {
        var b = a,
          c = this.scrollTypes;
        return "none" === b ? "none" : b === c.XSCROLLER ? "X" : b === c.YSCROLLER ? "Y" : c.SCROLLER.exec(b) ? "XY" : void 0
      },
      POINTER_TYPE: "touch",
      firstTouch: null,
      isPrimaryTouch: function (a) {
        return this.firstTouch === a.identifier
      },
      setPrimaryTouch: function (a) {
        (0 === R.size || 1 === R.size && R.has(1)) && (this.firstTouch = a.identifier, this.firstXY = {
          X: a.clientX,
          Y: a.clientY
        }, this.scrolling = !1, this.cancelResetClickCount())
      },
      removePrimaryPointer: function (a) {
        a.isPrimary && (this.firstTouch = null, this.firstXY = null, this.resetClickCount())
      },
      clickCount: 0,
      resetId: null,
      resetClickCount: function () {
        var a = function () {
          this.clickCount = 0, this.resetId = null
        }.bind(this);
        this.resetId = setTimeout(a, T)
      },
      cancelResetClickCount: function () {
        this.resetId && clearTimeout(this.resetId)
      },
      typeToButtons: function (a) {
        var b = 0;
        return "touchstart" !== a && "touchmove" !== a || (b = 1), b
      },
      touchToPointer: function (a) {
        var b = this.currentTouchEvent,
          c = u.cloneEvent(a),
          d = c.pointerId = a.identifier + 2;
        c.target = O[d] || P(c), c.bubbles = !0, c.cancelable = !0, c.detail = this.clickCount, c.button = 0, c.buttons = this.typeToButtons(b.type), c.width = 2 * (a.radiusX || a.webkitRadiusX || 0), c.height = 2 * (a.radiusY || a.webkitRadiusY || 0), c.pressure = a.force || a.webkitForce || .5, c.isPrimary = this.isPrimaryTouch(a), c.pointerType = this.POINTER_TYPE,
          c.altKey = b.altKey, c.ctrlKey = b.ctrlKey, c.metaKey = b.metaKey, c.shiftKey = b.shiftKey;
        var e = this;
        return c.preventDefault = function () {
          e.scrolling = !1, e.firstXY = null, b.preventDefault()
        }, c
      },
      processTouches: function (a, b) {
        var c = a.changedTouches;
        this.currentTouchEvent = a;
        for (var d, e = 0; e < c.length; e++) d = c[e], b.call(this, this.touchToPointer(d))
      },
      shouldScroll: function (a) {
        if (this.firstXY) {
          var b, c = a.currentTarget._scrollType;
          if ("none" === c)
            b = !1;
          else if ("XY" === c)
            b = !0;
          else {
            var d = a.changedTouches[0],
              e = c,
              f = "Y" === c ? "X" : "Y",
              g = Math.abs(d["client" + e] - this.firstXY[e]),
              h = Math.abs(d["client" + f] - this.firstXY[f]);
            b = g >= h
          }
          return this.firstXY = null, b
        }
      },
      findTouch: function (a, b) {
        for (var c, d = 0, e = a.length; d < e && (c = a[d]); d++)
          if (c.identifier === b) return !0
      },
      vacuumTouches: function (a) {
        var b = a.touches;
        if (R.size >= b.length) {
          var c = [];
          R.forEach(function (a, d) {
            if (1 !== d && !this.findTouch(b, d - 2)) {
              var e = a.out;
              c.push(e)
            }
          }, this), c.forEach(this.cancelOut, this)
        }
      },
      touchstart: function (a) {
        this.vacuumTouches(a), this.setPrimaryTouch(a.changedTouches[0]), this.dedupSynthMouse(a), this.scrolling || (this.clickCount++, this.processTouches(a, this.overDown))
      },
      overDown: function (a) {
        R.set(a.pointerId, {
          target: a.target,
          out: a,
          outTarget: a.target
        }), u.enterOver(a), u.down(a)
      },
      touchmove: function (a) {
        this.scrolling || (this.shouldScroll(a) ? (this.scrolling = !0, this.touchcancel(a)) : (a.preventDefault(), this.processTouches(a, this.moveOverOut)))
      },
      moveOverOut: function (a) {
        var b = a,
          c = R.get(b.pointerId);
        if (c) {
          var d = c.out,
            e = c.outTarget;
          u.move(b), d && e !== b.target && (d.relatedTarget = b.target, b.relatedTarget = e,
            d.target = e, b.target ? (u.leaveOut(d), u.enterOver(b)) : (
              b.target = e, b.relatedTarget = null, this.cancelOut(b))), c.out = b, c.outTarget = b.target
        }
      },
      touchend: function (a) {
        this.dedupSynthMouse(a), this.processTouches(a, this.upOut)
      },
      upOut: function (a) {
        this.scrolling || (u.up(a), u.leaveOut(a)), this.cleanUpPointer(a)
      },
      touchcancel: function (a) {
        this.processTouches(a, this.cancelOut)
      },
      cancelOut: function (a) {
        u.cancel(a), u.leaveOut(a), this.cleanUpPointer(a)
      },
      cleanUpPointer: function (a) {
        R["delete"](a.pointerId), this.removePrimaryPointer(a)
      },
      dedupSynthMouse: function (a) {
        var b = N.lastTouches,
          c = a.changedTouches[0];
        if (this.isPrimaryTouch(c)) {
          var d = {
            x: c.clientX,
            y: c.clientY
          };
          b.push(d);
          var e = function (a, b) {
            var c = a.indexOf(b);
            c > -1 && a.splice(c, 1)
          }.bind(null, b, d);
          setTimeout(e, S)
        }
      }
    };
  M = new c(V.elementAdded, V.elementRemoved, V.elementChanged, V);
  var W, X, Y, Z = u.pointermap,
    $ = window.MSPointerEvent && "number" == typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,
    _ = {
      events: ["MSPointerDown", "MSPointerMove", "MSPointerUp", "MSPointerOut", "MSPointerOver", "MSPointerCancel", "MSGotPointerCapture", "MSLostPointerCapture"],
      register: function (a) {
        u.listen(a, this.events)
      },
      unregister: function (a) {
        u.unlisten(a, this.events)
      },
      POINTER_TYPES: ["", "unavailable", "touch", "pen", "mouse"],
      prepareEvent: function (a) {
        var b = a;
        return $ && (b = u.cloneEvent(a), b.pointerType = this.POINTER_TYPES[a.pointerType]), b
      },
      cleanup: function (a) {
        Z["delete"](a)
      },
      MSPointerDown: function (a) {
        Z.set(a.pointerId, a);
        var b = this.prepareEvent(a);
        u.down(b)
      },
      MSPointerMove: function (a) {
        var b = this.prepareEvent(a);
        u.move(b)
      },
      MSPointerUp: function (a) {
        var b = this.prepareEvent(a);
        u.up(b), this.cleanup(a.pointerId)
      },
      MSPointerOut: function (a) {
        var b = this.prepareEvent(a);
        u.leaveOut(b)
      },
      MSPointerOver: function (a) {
        var b = this.prepareEvent(a);
        u.enterOver(b)
      },
      MSPointerCancel: function (a) {
        var b = this.prepareEvent(a);
        u.cancel(b), this.cleanup(a.pointerId)
      },
      MSLostPointerCapture: function (a) {
        var b = u.makeEvent("lostpointercapture", a);
        u.dispatchEvent(b)
      },
      MSGotPointerCapture: function (a) {
        var b = u.makeEvent("gotpointercapture", a);
        u.dispatchEvent(b)
      }
    },
    aa = window.navigator;
  aa.msPointerEnabled ? (W = function (a) {
    i(a), j(this), k(a) && (u.setCapture(a, this, !0), this.msSetPointerCapture(a))
  }, X = function (a) {
    i(a), u.releaseCapture(a, !0), this.msReleasePointerCapture(a)
  }) : (W = function (a) {
    i(a), j(this), k(a) && u.setCapture(a, this)
  }, X = function (a) {
    i(a), u.releaseCapture(a)
  }), Y = function (a) {
    return !!u.captureInfo[a]
  }, g(), h(), l();
  var ba = {
    dispatcher: u,
    Installer: c,
    PointerEvent: a,
    PointerMap: p,
    targetFinding: v
  };
  return ba
});
///////////////////////////////////////////////

///////////////////////////////////////////////
var config = {"show_fabrication":false,"redraw_on_drag":true,"highlight_pin1":false,"extra_fields":[],"dark_mode":false,"bom_view":"left-right","board_rotation":0,"checkboxes":"Sourced,Placed","show_silkscreen":true,"show_pads":true,"layer_view":"FB"};
///////////////////////////////////////////////

///////////////////////////////////////////////
var pcbdata = {"ibom_version":"v2.3-50-g53ae\n","edges_bbox":{"minx":4026,"miny":3032,"maxx":4243,"maxy":3203.5},"edges":[{"type":"polyline","net":"S$349","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4180.5,3136.5 4081.6813,3136.5"},{"type":"polyline","net":"S$363","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4180.5,3071.5 4118.2955,3071.5"},{"type":"polyline","net":"S$359","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4180.5,3136.5 4180.5,3071.6577"},{"type":"polyline","net":"S$431","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4081.5001,3136.5001 4081.8473,3095.8717"},{"type":"polyline","net":"S$438","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4101.9864,3088.94 4099.3463,3091.5001 4097.8463,3092.5001 4095.3463,3094.0001 4092.5963,3095.1202 4085.8463,3096.0001 4081.8463,3095.8702"},{"type":"polyline","net":"S$427","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4117.9171,3071.6578 4101.983,3088.9361"}],"drawings":{"silkscreen":{"F":[{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4145.5012,3095.537 4142.3906,3095.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3099.463 4145.5012,3099.463"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4146.1012,3098.863 4146.1012,3096.137"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4137.4988,3095.537 4140.6094,3095.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3099.463 4137.4988,3099.463"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4136.8988,3098.863 4136.8988,3096.137"},{"type":"arc","width":0.6,"svgpath":"M 4145.5012 3099.463 A 0.6 0.6 0 0 0 4146.1012 3098.863","net":""},{"type":"arc","width":0.6,"svgpath":"M 4146.1012 3096.137 A 0.6 0.6 0 0 0 4145.5012 3095.537","net":""},{"type":"arc","width":0.6,"svgpath":"M 4137.4988 3099.463 A 0.6 0.6 0 0 1 4136.8988 3098.863","net":""},{"type":"arc","width":0.6,"svgpath":"M 4136.8988 3096.137 A 0.6 0.6 0 0 1 4137.4988 3095.537","net":""},{"type":"text","svgpath":"M 4141.5 3083.78 L 4141.91 3083.57 L 4142.52 3082.96 L 4142.52 3087.25 M 4145.1 3082.96 L 4144.49 3083.16 L 4144.08 3083.78 L 4143.87 3084.8 L 4143.87 3085.41 L 4144.08 3086.44 L 4144.49 3087.05 L 4145.1 3087.25 L 4145.51 3087.25 L 4146.12 3087.05 L 4146.53 3086.44 L 4146.74 3085.41 L 4146.74 3084.8 L 4146.53 3083.78 L 4146.12 3083.16 L 4145.51 3082.96 L 4145.1 3082.96 M 4148.09 3084.39 L 4148.09 3086.44 L 4148.29 3087.05 L 4148.7 3087.25 L 4149.31 3087.25 L 4149.72 3087.05 L 4150.34 3086.44 M 4150.34 3084.39 L 4150.34 3087.25 M 4151.69 3082.96 L 4151.69 3087.25 M 4151.69 3082.96 L 4154.35 3082.96 M 4151.69 3085 L 4153.32 3085","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3132.463 4137.7825,3132.463 4137.7825,3128.537 4140.6094,3128.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3132.463 4145.2175,3132.463 4145.2175,3128.537 4142.3906,3128.537"},{"type":"text","svgpath":"M 4141.84 3112.83 L 4142.81 3111.44 L 4142.81 3112.83 Z  M 4143.62 3112.83 L 4143.16 3112.83 L 4143.16 3111.02 L 4142.92 3111.02 L 4141.62 3112.88 L 4141.62 3113.09 L 4142.81 3113.09 L 4142.81 3114 L 4143.16 3114 L 4143.16 3113.09 L 4143.62 3113.09 Z  M 4143.92 3111.07 L 4143.92 3111.41 L 4145.45 3111.41 L 4144.28 3113.96 L 4144.32 3114 L 4144.66 3114 L 4145.7 3111.28 L 4145.7 3111.07 Z  M 4148.01 3113.82 L 4147.27 3112.63 L 4147.78 3112.12 L 4148.18 3112.07 L 4148.18 3111.92 L 4147.18 3111.92 L 4147.18 3112.07 L 4147.52 3112.14 L 4146.73 3112.96 L 4146.73 3111.42 L 4146.75 3110.79 L 4146.69 3110.76 L 4146.01 3110.94 L 4146.01 3111.08 L 4146.37 3111.11 L 4146.37 3113.08 C 4146.37 3113.32 4146.36 3113.58 4146.36 3113.82 L 4146.02 3113.86 L 4146.02 3114 L 4147.08 3114 L 4147.08 3113.86 L 4146.74 3113.82 C 4146.73 3113.61 4146.73 3113.39 4146.73 3113.18 L 4147.02 3112.88 L 4147.7 3114 L 4148.3 3114 L 4148.3 3113.86 Z  M 4151.1 3113.26 L 4150.99 3113.69 L 4150.37 3113.69 L 4150.37 3113.69 C 4150.82 3113.37 4151.18 3112.9 4151.18 3112.33 C 4151.18 3111.47 4150.58 3111 4149.9 3111 C 4149.22 3111 4148.62 3111.47 4148.62 3112.33 C 4148.62 3112.9 4148.98 3113.37 4149.43 3113.69 L 4149.43 3113.69 L 4148.8 3113.69 L 4148.7 3113.26 L 4148.47 3113.26 L 4148.52 3114 L 4149.69 3114 L 4149.69 3113.73 C 4149.28 3113.4 4149.02 3112.88 4149.02 3112.33 C 4149.02 3111.68 4149.35 3111.19 4149.9 3111.19 C 4150.45 3111.19 4150.77 3111.68 4150.77 3112.33 C 4150.77 3112.88 4150.52 3113.4 4150.1 3113.73 L 4150.1 3114 L 4151.28 3114 L 4151.32 3113.26 Z ","useTrueTypeFontRendering":true,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3125.463 4137.7825,3125.463 4137.7825,3121.537 4140.6094,3121.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3125.463 4145.2175,3125.463 4145.2175,3121.537 4142.3906,3121.537"},{"type":"text","svgpath":"M 4142.84 3105.83 L 4143.81 3104.44 L 4143.81 3105.83 Z  M 4144.62 3105.83 L 4144.16 3105.83 L 4144.16 3104.02 L 4143.92 3104.02 L 4142.62 3105.88 L 4142.62 3106.09 L 4143.81 3106.09 L 4143.81 3107 L 4144.16 3107 L 4144.16 3106.09 L 4144.62 3106.09 Z  M 4144.92 3104.07 L 4144.92 3104.41 L 4146.45 3104.41 L 4145.28 3106.96 L 4145.32 3107 L 4145.66 3107 L 4146.7 3104.28 L 4146.7 3104.07 Z  M 4149.01 3106.82 L 4148.27 3105.63 L 4148.78 3105.12 L 4149.18 3105.07 L 4149.18 3104.92 L 4148.18 3104.92 L 4148.18 3105.07 L 4148.52 3105.14 L 4147.73 3105.96 L 4147.73 3104.42 L 4147.75 3103.79 L 4147.69 3103.76 L 4147.01 3103.94 L 4147.01 3104.08 L 4147.37 3104.11 L 4147.37 3106.08 C 4147.37 3106.32 4147.36 3106.58 4147.36 3106.82 L 4147.02 3106.86 L 4147.02 3107 L 4148.08 3107 L 4148.08 3106.86 L 4147.74 3106.82 C 4147.73 3106.61 4147.73 3106.39 4147.73 3106.18 L 4148.02 3105.88 L 4148.7 3107 L 4149.3 3107 L 4149.3 3106.86 Z  M 4152.1 3106.26 L 4151.99 3106.69 L 4151.37 3106.69 L 4151.37 3106.69 C 4151.82 3106.37 4152.18 3105.9 4152.18 3105.33 C 4152.18 3104.47 4151.58 3104 4150.9 3104 C 4150.22 3104 4149.62 3104.47 4149.62 3105.33 C 4149.62 3105.9 4149.98 3106.37 4150.43 3106.69 L 4150.43 3106.69 L 4149.8 3106.69 L 4149.7 3106.26 L 4149.47 3106.26 L 4149.52 3107 L 4150.69 3107 L 4150.69 3106.73 C 4150.28 3106.4 4150.02 3105.88 4150.02 3105.33 C 4150.02 3104.68 4150.35 3104.19 4150.9 3104.19 C 4151.45 3104.19 4151.77 3104.68 4151.77 3105.33 C 4151.77 3105.88 4151.52 3106.4 4151.1 3106.73 L 4151.1 3107 L 4152.28 3107 L 4152.32 3106.26 Z ","useTrueTypeFontRendering":true,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3111.963 4137.7825,3111.963 4137.7825,3108.037 4140.6094,3108.037"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3111.963 4145.2175,3111.963 4145.2175,3108.037 4142.3906,3108.037"},{"type":"text","svgpath":"M 4142.84 3092.33 L 4143.81 3090.94 L 4143.81 3092.33 Z  M 4144.62 3092.33 L 4144.16 3092.33 L 4144.16 3090.52 L 4143.92 3090.52 L 4142.62 3092.38 L 4142.62 3092.59 L 4143.81 3092.59 L 4143.81 3093.5 L 4144.16 3093.5 L 4144.16 3092.59 L 4144.62 3092.59 Z  M 4144.92 3090.57 L 4144.92 3090.91 L 4146.45 3090.91 L 4145.28 3093.46 L 4145.32 3093.5 L 4145.66 3093.5 L 4146.7 3090.78 L 4146.7 3090.57 Z  M 4149.01 3093.32 L 4148.27 3092.13 L 4148.78 3091.62 L 4149.18 3091.57 L 4149.18 3091.42 L 4148.18 3091.42 L 4148.18 3091.57 L 4148.52 3091.64 L 4147.73 3092.46 L 4147.73 3090.92 L 4147.75 3090.29 L 4147.69 3090.26 L 4147.01 3090.44 L 4147.01 3090.58 L 4147.37 3090.61 L 4147.37 3092.58 C 4147.37 3092.82 4147.36 3093.08 4147.36 3093.32 L 4147.02 3093.36 L 4147.02 3093.5 L 4148.08 3093.5 L 4148.08 3093.36 L 4147.74 3093.32 C 4147.73 3093.11 4147.73 3092.89 4147.73 3092.68 L 4148.02 3092.38 L 4148.7 3093.5 L 4149.3 3093.5 L 4149.3 3093.36 Z  M 4152.1 3092.76 L 4151.99 3093.19 L 4151.37 3093.19 L 4151.37 3093.19 C 4151.82 3092.87 4152.18 3092.4 4152.18 3091.83 C 4152.18 3090.97 4151.58 3090.5 4150.9 3090.5 C 4150.22 3090.5 4149.62 3090.97 4149.62 3091.83 C 4149.62 3092.4 4149.98 3092.87 4150.43 3093.19 L 4150.43 3093.19 L 4149.8 3093.19 L 4149.7 3092.76 L 4149.47 3092.76 L 4149.52 3093.5 L 4150.69 3093.5 L 4150.69 3093.23 C 4150.28 3092.9 4150.02 3092.38 4150.02 3091.83 C 4150.02 3091.18 4150.35 3090.69 4150.9 3090.69 C 4151.45 3090.69 4151.77 3091.18 4151.77 3091.83 C 4151.77 3092.38 4151.52 3092.9 4151.1 3093.23 L 4151.1 3093.5 L 4152.28 3093.5 L 4152.32 3092.76 Z ","useTrueTypeFontRendering":true,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3105.463 4137.7825,3105.463 4137.7825,3101.537 4140.6094,3101.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3105.463 4145.2175,3105.463 4145.2175,3101.537 4142.3906,3101.537"},{"type":"text","svgpath":"M 4142.84 3085.83 L 4143.81 3084.44 L 4143.81 3085.83 Z  M 4144.62 3085.83 L 4144.16 3085.83 L 4144.16 3084.02 L 4143.92 3084.02 L 4142.62 3085.88 L 4142.62 3086.09 L 4143.81 3086.09 L 4143.81 3087 L 4144.16 3087 L 4144.16 3086.09 L 4144.62 3086.09 Z  M 4144.92 3084.07 L 4144.92 3084.41 L 4146.45 3084.41 L 4145.28 3086.96 L 4145.32 3087 L 4145.66 3087 L 4146.7 3084.28 L 4146.7 3084.07 Z  M 4149.01 3086.82 L 4148.27 3085.63 L 4148.78 3085.12 L 4149.18 3085.07 L 4149.18 3084.92 L 4148.18 3084.92 L 4148.18 3085.07 L 4148.52 3085.14 L 4147.73 3085.96 L 4147.73 3084.42 L 4147.75 3083.79 L 4147.69 3083.76 L 4147.01 3083.94 L 4147.01 3084.08 L 4147.37 3084.11 L 4147.37 3086.08 C 4147.37 3086.32 4147.36 3086.58 4147.36 3086.82 L 4147.02 3086.86 L 4147.02 3087 L 4148.08 3087 L 4148.08 3086.86 L 4147.74 3086.82 C 4147.73 3086.61 4147.73 3086.39 4147.73 3086.18 L 4148.02 3085.88 L 4148.7 3087 L 4149.3 3087 L 4149.3 3086.86 Z  M 4152.1 3086.26 L 4151.99 3086.69 L 4151.37 3086.69 L 4151.37 3086.69 C 4151.82 3086.37 4152.18 3085.9 4152.18 3085.33 C 4152.18 3084.47 4151.58 3084 4150.9 3084 C 4150.22 3084 4149.62 3084.47 4149.62 3085.33 C 4149.62 3085.9 4149.98 3086.37 4150.43 3086.69 L 4150.43 3086.69 L 4149.8 3086.69 L 4149.7 3086.26 L 4149.47 3086.26 L 4149.52 3087 L 4150.69 3087 L 4150.69 3086.73 C 4150.28 3086.4 4150.02 3085.88 4150.02 3085.33 C 4150.02 3084.68 4150.35 3084.19 4150.9 3084.19 C 4151.45 3084.19 4151.77 3084.68 4151.77 3085.33 C 4151.77 3085.88 4151.52 3086.4 4151.1 3086.73 L 4151.1 3087 L 4152.28 3087 L 4152.32 3086.26 Z ","useTrueTypeFontRendering":true,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.6094,3118.463 4137.7825,3118.463 4137.7825,3114.537 4140.6094,3114.537"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.3906,3118.463 4145.2175,3118.463 4145.2175,3114.537 4142.3906,3114.537"},{"type":"text","svgpath":"M 4142.84 3098.83 L 4143.81 3097.44 L 4143.81 3098.83 Z  M 4144.62 3098.83 L 4144.16 3098.83 L 4144.16 3097.02 L 4143.92 3097.02 L 4142.62 3098.88 L 4142.62 3099.09 L 4143.81 3099.09 L 4143.81 3100 L 4144.16 3100 L 4144.16 3099.09 L 4144.62 3099.09 Z  M 4144.92 3097.07 L 4144.92 3097.41 L 4146.45 3097.41 L 4145.28 3099.96 L 4145.32 3100 L 4145.66 3100 L 4146.7 3097.28 L 4146.7 3097.07 Z  M 4149.01 3099.82 L 4148.27 3098.63 L 4148.78 3098.12 L 4149.18 3098.07 L 4149.18 3097.92 L 4148.18 3097.92 L 4148.18 3098.07 L 4148.52 3098.14 L 4147.73 3098.96 L 4147.73 3097.42 L 4147.75 3096.79 L 4147.69 3096.76 L 4147.01 3096.94 L 4147.01 3097.08 L 4147.37 3097.11 L 4147.37 3099.08 C 4147.37 3099.32 4147.36 3099.58 4147.36 3099.82 L 4147.02 3099.86 L 4147.02 3100 L 4148.08 3100 L 4148.08 3099.86 L 4147.74 3099.82 C 4147.73 3099.61 4147.73 3099.39 4147.73 3099.18 L 4148.02 3098.88 L 4148.7 3100 L 4149.3 3100 L 4149.3 3099.86 Z  M 4152.1 3099.26 L 4151.99 3099.69 L 4151.37 3099.69 L 4151.37 3099.69 C 4151.82 3099.37 4152.18 3098.9 4152.18 3098.33 C 4152.18 3097.47 4151.58 3097 4150.9 3097 C 4150.22 3097 4149.62 3097.47 4149.62 3098.33 C 4149.62 3098.9 4149.98 3099.37 4150.43 3099.69 L 4150.43 3099.69 L 4149.8 3099.69 L 4149.7 3099.26 L 4149.47 3099.26 L 4149.52 3100 L 4150.69 3100 L 4150.69 3099.73 C 4150.28 3099.4 4150.02 3098.88 4150.02 3098.33 C 4150.02 3097.68 4150.35 3097.19 4150.9 3097.19 C 4151.45 3097.19 4151.77 3097.68 4151.77 3098.33 C 4151.77 3098.88 4151.52 3099.4 4151.1 3099.73 L 4151.1 3100 L 4152.28 3100 L 4152.32 3099.26 Z ","useTrueTypeFontRendering":true,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4178.5275,3095.3906 4178.5275,3128.6094"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4162.3219,3089.8544 4172.5091,3089.8544"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4154.9901,3134.1456 4154.9252,3134.1456 4154.9252,3089.8544 4154.9901,3089.8544"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.5091,3134.1456 4162.3219,3134.1456"},{"type":"circle","_svgpath":"M 4152.051, 3130.484 m -1.004, 0 a 1.004,1.004 0 1,0 2.008,0 a 1.004,1.004 0 1,0 -2.008,0","start":[4152.051,3130.484],"radius":1.004,"width":"1","net":""},{"type":"text","svgpath":"M 4187.6844 3165.4048 L 4191.9744 3165.4048 M 4187.6844 3166.8348 L 4187.6844 3163.9748 M 4187.6844 3162.6248 L 4191.9744 3162.6248 M 4187.6844 3162.6248 L 4187.6844 3159.9648 M 4189.7244 3162.6248 L 4189.7244 3160.9848 M 4190.1344 3158.6148 L 4190.1344 3154.9348 M 4188.5044 3153.5848 L 4188.2944 3153.1748 L 4187.6844 3152.5548 L 4191.9744 3152.5548 M 4188.7044 3151.0048 L 4188.5044 3151.0048 L 4188.0944 3150.7948 L 4187.8844 3150.5948 L 4187.6844 3150.1848 L 4187.6844 3149.3648 L 4187.8844 3148.9548 L 4188.0944 3148.7548 L 4188.5044 3148.5448 L 4188.9144 3148.5448 L 4189.3244 3148.7548 L 4189.9344 3149.1648 L 4191.9744 3151.2048 L 4191.9744 3148.3448 M 4187.6844 3146.5848 L 4187.6844 3144.3348 L 4189.3244 3145.5648 L 4189.3244 3144.9448 L 4189.5244 3144.5348 L 4189.7244 3144.3348 L 4190.3444 3144.1348 L 4190.7544 3144.1348 L 4191.3644 3144.3348 L 4191.7744 3144.7448 L 4191.9744 3145.3548 L 4191.9744 3145.9748 L 4191.7744 3146.5848 L 4191.5744 3146.7848 L 4191.1644 3146.9948 M 4190.1344 3142.7848 L 4190.1344 3139.0948 M 4187.6844 3136.1148 L 4191.9744 3137.7448 M 4187.6844 3136.1148 L 4191.9744 3134.4748 M 4190.5444 3137.1348 L 4190.5444 3135.0848 M 4187.6844 3133.1248 L 4191.9744 3133.1248 M 4187.6844 3133.1248 L 4187.6844 3131.2848 L 4187.8844 3130.6748 L 4188.0944 3130.4648 L 4188.5044 3130.2648 L 4188.9144 3130.2648 L 4189.3244 3130.4648 L 4189.5244 3130.6748 L 4189.7244 3131.2848 L 4189.7244 3133.1248 M 4189.7244 3131.6948 L 4191.9744 3130.2648 M 4187.6844 3128.9148 L 4191.9744 3128.9148 M 4187.6844 3128.9148 L 4187.6844 3127.0748 L 4187.8844 3126.4548 L 4188.0944 3126.2548 L 4188.5044 3126.0448 L 4189.1144 3126.0448 L 4189.5244 3126.2548 L 4189.7244 3126.4548 L 4189.9344 3127.0748 L 4189.9344 3128.9148 M 4189.1144 3122.0348 L 4189.7244 3122.2448 L 4190.1344 3122.6548 L 4190.3444 3123.2648 L 4190.3444 3123.4748 L 4190.1344 3124.0848 L 4189.7244 3124.4948 L 4189.1144 3124.6948 L 4188.9144 3124.6948 L 4188.2944 3124.4948 L 4187.8844 3124.0848 L 4187.6844 3123.4748 L 4187.6844 3123.2648 L 4187.8844 3122.6548 L 4188.2944 3122.2448 L 4189.1144 3122.0348 L 4190.1344 3122.0348 L 4191.1644 3122.2448 L 4191.7744 3122.6548 L 4191.9744 3123.2648 L 4191.9744 3123.6748 L 4191.7744 3124.2848 L 4191.3644 3124.4948 M 4187.6844 3120.6848 L 4191.9744 3120.6848 M 4187.6844 3117.8248 L 4191.9744 3117.8248 M 4189.7244 3120.6848 L 4189.7244 3117.8248 M 4188.5044 3116.4748 L 4188.2944 3116.0648 L 4187.6844 3115.4548 L 4191.9744 3115.4548 M 4187.6844 3111.2348 L 4191.9744 3113.2848 M 4187.6844 3114.1048 L 4187.6844 3111.2348","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"text","svgpath":"M 4184.9743 3111.2348 L 4181.9043 3111.2348 L 4181.2943 3111.4348 L 4180.8843 3111.8448 L 4180.6843 3112.4648 L 4180.6843 3112.8748 L 4180.8843 3113.4848 L 4181.2943 3113.8948 L 4181.9043 3114.0948 L 4184.9743 3114.0948 M 4184.1543 3115.4448 L 4184.3643 3115.8548 L 4184.9743 3116.4748 L 4180.6843 3116.4748","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","ref":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4143.6049,3090.9622 4142.1543,3090.9622"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4142.1543,3094.0378 4143.6049,3094.0378"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4144.2049,3093.4378 4144.2049,3091.5622"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4139.3951,3090.9622 4140.8457,3090.9622"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4140.8457,3094.0378 4139.3951,3094.0378"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":0.6,"svgpath":"M4138.7951,3093.4378 4138.7951,3091.5622"},{"type":"arc","width":0.6,"svgpath":"M 4143.6049 3094.0378 A 0.6 0.6 0 0 0 4144.2049 3093.4378","net":""},{"type":"arc","width":0.6,"svgpath":"M 4144.2049 3091.5622 A 0.6 0.6 0 0 0 4143.6049 3090.9622","net":""},{"type":"arc","width":0.6,"svgpath":"M 4139.3951 3094.0378 A 0.6 0.6 0 0 1 4138.7951 3093.4378","net":""},{"type":"arc","width":0.6,"svgpath":"M 4138.7951 3091.5622 A 0.6 0.6 0 0 1 4139.3951 3090.9622","net":""},{"type":"text","svgpath":"M 4141.5 3078.78 L 4141.91 3078.57 L 4142.52 3077.96 L 4142.52 3082.25 M 4145.1 3077.96 L 4144.49 3078.16 L 4144.08 3078.78 L 4143.87 3079.8 L 4143.87 3080.41 L 4144.08 3081.44 L 4144.49 3082.05 L 4145.1 3082.25 L 4145.51 3082.25 L 4146.12 3082.05 L 4146.53 3081.44 L 4146.74 3080.41 L 4146.74 3079.8 L 4146.53 3078.78 L 4146.12 3078.16 L 4145.51 3077.96 L 4145.1 3077.96 M 4149.31 3077.96 L 4148.7 3078.16 L 4148.29 3078.78 L 4148.09 3079.8 L 4148.09 3080.41 L 4148.29 3081.44 L 4148.7 3082.05 L 4149.31 3082.25 L 4149.72 3082.25 L 4150.34 3082.05 L 4150.75 3081.44 L 4150.95 3080.41 L 4150.95 3079.8 L 4150.75 3078.78 L 4150.34 3078.16 L 4149.72 3077.96 L 4149.31 3077.96 M 4152.3 3079.39 L 4152.3 3082.25 M 4152.3 3080.21 L 4152.91 3079.6 L 4153.32 3079.39 L 4153.94 3079.39 L 4154.35 3079.6 L 4154.55 3080.21 L 4154.55 3082.25 M 4155.9 3077.96 L 4155.9 3082.25 M 4155.9 3077.96 L 4158.56 3077.96 M 4155.9 3080 L 4157.54 3080","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1}],"B":[]},"fabrication":{"F":[],"B":[]}},"footprints":[{"ref":"C6","center":[4141.5,3097.5],"bbox":{"pos":[4141.5,3097.5],"angle":0,"relpos":[-4.601200000000063,-1.9630000000001928],"size":[9.202400000000125,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.646,3097.5],"size":[3.1106,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.6459,"y":3097.5},"polygon":[{"x":4142.0906,"y":3098.563},{"x":4142.0906,"y":3096.437},{"x":4145.2012,"y":3096.437},{"x":4145.2012,"y":3098.563}],"net":"GND"},{"layers":["F"],"pos":[4139.354,3097.5],"size":[3.1106,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.3541,"y":3097.5},"polygon":[{"x":4140.9094,"y":3098.563},{"x":4140.9094,"y":3096.437},{"x":4137.7988,"y":3096.437},{"x":4137.7988,"y":3098.563}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"R1","center":[4141.5,3130.5],"bbox":{"pos":[4141.5,3130.5],"angle":0,"relpos":[-3.7174999999997453,-1.9630000000001928],"size":[7.434999999999491,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.204,3130.5],"size":[2.227,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.204,"y":3130.5},"polygon":[{"x":4142.0906,"y":3131.563},{"x":4142.0906,"y":3129.437},{"x":4144.3175,"y":3129.437},{"x":4144.3175,"y":3131.563}],"net":"CS"},{"layers":["F"],"pos":[4139.796,3130.5],"size":[2.227,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.796,"y":3130.5},"polygon":[{"x":4140.9094,"y":3131.563},{"x":4140.9094,"y":3129.437},{"x":4138.6825,"y":3129.437},{"x":4138.6825,"y":3131.563}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"R2","center":[4141.5,3123.5],"bbox":{"pos":[4141.5,3123.5],"angle":0,"relpos":[-3.7174999999997453,-1.9630000000001928],"size":[7.434999999999491,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.204,3123.5],"size":[2.227,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.204,"y":3123.5},"polygon":[{"x":4142.0906,"y":3124.563},{"x":4142.0906,"y":3122.437},{"x":4144.3175,"y":3122.437},{"x":4144.3175,"y":3124.563}],"net":"DI"},{"layers":["F"],"pos":[4139.796,3123.5],"size":[2.227,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.796,"y":3123.5},"polygon":[{"x":4140.9094,"y":3124.563},{"x":4140.9094,"y":3122.437},{"x":4138.6825,"y":3122.437},{"x":4138.6825,"y":3124.563}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"R3","center":[4141.5,3110],"bbox":{"pos":[4141.5,3110],"angle":0,"relpos":[-3.7174999999997453,-1.9630000000001928],"size":[7.434999999999491,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.204,3110],"size":[2.227,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.204,"y":3110},"polygon":[{"x":4142.0906,"y":3111.063},{"x":4142.0906,"y":3108.937},{"x":4144.3175,"y":3108.937},{"x":4144.3175,"y":3111.063}],"net":"SCLK"},{"layers":["F"],"pos":[4139.796,3110],"size":[2.227,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.796,"y":3110},"polygon":[{"x":4140.9094,"y":3111.063},{"x":4140.9094,"y":3108.937},{"x":4138.6825,"y":3108.937},{"x":4138.6825,"y":3111.063}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"R4","center":[4141.5,3103.5],"bbox":{"pos":[4141.5,3103.5],"angle":0,"relpos":[-3.7174999999997453,-1.9630000000001928],"size":[7.434999999999491,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.204,3103.5],"size":[2.227,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.204,"y":3103.5},"polygon":[{"x":4142.0906,"y":3104.563},{"x":4142.0906,"y":3102.437},{"x":4144.3175,"y":3102.437},{"x":4144.3175,"y":3104.563}],"net":"DO"},{"layers":["F"],"pos":[4139.796,3103.5],"size":[2.227,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.796,"y":3103.5},"polygon":[{"x":4140.9094,"y":3104.563},{"x":4140.9094,"y":3102.437},{"x":4138.6825,"y":3102.437},{"x":4138.6825,"y":3104.563}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"R5","center":[4141.5,3116.5],"bbox":{"pos":[4141.5,3116.5],"angle":0,"relpos":[-3.7174999999997453,-1.9630000000001928],"size":[7.434999999999491,3.9260000000003856]},"pads":[{"layers":["F"],"pos":[4143.204,3116.5],"size":[2.227,2.126],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4143.204,"y":3116.5},"polygon":[{"x":4142.0906,"y":3117.563},{"x":4142.0906,"y":3115.437},{"x":4144.3175,"y":3115.437},{"x":4144.3175,"y":3117.563}],"net":"SWITCH"},{"layers":["F"],"pos":[4139.796,3116.5],"size":[2.227,2.126],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4139.796,"y":3116.5},"polygon":[{"x":4140.9094,"y":3117.563},{"x":4140.9094,"y":3115.437},{"x":4138.6825,"y":3115.437},{"x":4138.6825,"y":3117.563}],"net":"3V3"}],"drawings":[],"layer":"F"},{"ref":"U1","center":[4164,3112],"bbox":{"pos":[4164,3112],"angle":270,"relpos":[-22.83389999999963,-14.73405000000048],"size":[45.668799999999464,27.89330000000109]},"pads":[{"layers":["F"],"pos":[4151.825,3127.158],"size":[1.9685,3.937],"angle":-270,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3127.1576},"polygon":[{"x":4153.7936,"y":3126.1733},{"x":4153.7936,"y":3128.1418},{"x":4149.8566,"y":3128.1418},{"x":4149.8566,"y":3126.1733}],"net":""},{"layers":["F"],"pos":[4151.825,3122.827],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3122.8269},"polygon":[{"x":4153.7936,"y":3121.8423},{"x":4153.7936,"y":3123.8108},{"x":4149.8566,"y":3123.8108},{"x":4149.8566,"y":3121.8423}],"net":"CS"},{"layers":["F"],"pos":[4151.825,3118.497],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3118.4962},"polygon":[{"x":4153.7936,"y":3117.5123},{"x":4153.7936,"y":3119.4808},{"x":4149.8566,"y":3119.4808},{"x":4149.8566,"y":3117.5123}],"net":"DI"},{"layers":["F"],"pos":[4151.825,3115.544],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3115.5434},"polygon":[{"x":4153.7936,"y":3114.5593},{"x":4153.7936,"y":3116.5278},{"x":4149.8566,"y":3116.5278},{"x":4149.8566,"y":3114.5593}],"net":"3V3"},{"layers":["F"],"pos":[4151.825,3109.835],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3109.8347},"polygon":[{"x":4153.7936,"y":3108.8503},{"x":4153.7936,"y":3110.8188},{"x":4149.8566,"y":3110.8188},{"x":4149.8566,"y":3108.8503}],"net":"SCLK"},{"layers":["F"],"pos":[4151.825,3105.505],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3105.504},"polygon":[{"x":4153.7936,"y":3104.5203},{"x":4153.7936,"y":3106.4888},{"x":4149.8566,"y":3106.4888},{"x":4149.8566,"y":3104.5203}],"net":"GND"},{"layers":["F"],"pos":[4151.825,3101.174],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3101.1733},"polygon":[{"x":4153.7936,"y":3100.1893},{"x":4153.7936,"y":3102.1578},{"x":4149.8566,"y":3102.1578},{"x":4149.8566,"y":3100.1893}],"net":"DO"},{"layers":["F"],"pos":[4151.825,3096.843],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3096.8426},"polygon":[{"x":4153.7936,"y":3095.8583},{"x":4153.7936,"y":3097.8268},{"x":4149.8566,"y":3097.8268},{"x":4149.8566,"y":3095.8583}],"net":""},{"layers":["F"],"pos":[4151.825,3112.788],"size":[1.9685,3.937],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4151.8251,"y":3112.7875},"polygon":[{"x":4153.7936,"y":3111.8033},{"x":4153.7936,"y":3113.7718},{"x":4149.8566,"y":3113.7718},{"x":4149.8566,"y":3111.8033}],"net":"SWITCH"},{"layers":["F"],"pos":[4158.656,3091.922],"size":[5.1181,5.5118],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4158.6558,"y":3091.9214},"polygon":[{"x":4161.4119,"y":3089.3624},{"x":4161.4119,"y":3094.4806},{"x":4155.9001,"y":3094.4806},{"x":4155.9001,"y":3089.3624}],"net":"GND"},{"layers":["F"],"pos":[4176.175,3091.922],"size":[5.1181,5.5118],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.1754,"y":3091.9214},"polygon":[{"x":4178.9309,"y":3089.3624},{"x":4178.9309,"y":3094.4806},{"x":4173.4191,"y":3094.4806},{"x":4173.4191,"y":3089.3624}],"net":"GND"},{"layers":["F"],"pos":[4176.175,3132.079],"size":[5.1181,5.5118],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.1754,"y":3132.0788},"polygon":[{"x":4178.9309,"y":3129.5194},{"x":4178.9309,"y":3134.6376},{"x":4173.4191,"y":3134.6376},{"x":4173.4191,"y":3129.5194}],"net":"GND"},{"layers":["F"],"pos":[4158.656,3132.079],"size":[5.1181,5.5118],"angle":-270,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4158.6558,"y":3132.0788},"polygon":[{"x":4161.4119,"y":3129.5194},{"x":4161.4119,"y":3134.6376},{"x":4155.9001,"y":3134.6376},{"x":4155.9001,"y":3129.5194}],"net":"GND"}],"drawings":[],"layer":"F"},{"ref":"U4","center":[4141.5,3092.5],"bbox":{"pos":[4141.5,3092.5],"angle":0,"relpos":[-2.704899999999725,-1.5378000000000611],"size":[5.40979999999945,3.0756000000001222]},"pads":[{"layers":["F"],"pos":[4142.58,3092.5],"size":[1.4505,1.2756],"angle":0,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4142.5796,"y":3092.5},"polygon":[{"x":4141.8543,"y":3093.1378},{"x":4141.8543,"y":3091.8622},{"x":4143.3049,"y":3091.8622},{"x":4143.3049,"y":3093.1378}],"net":"GND"},{"layers":["F"],"pos":[4140.42,3092.5],"size":[1.4505,1.2756],"angle":0,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4140.4204,"y":3092.5},"polygon":[{"x":4141.1457,"y":3093.1378},{"x":4141.1457,"y":3091.8622},{"x":4139.6951,"y":3091.8622},{"x":4139.6951,"y":3093.1378}],"net":"3V3"}],"drawings":[],"layer":"F"}],"metadata":{"title":"PCB SD Cards","revision":"0","company":"Unknown Company","date":"2023-11-21"},"tracks":{"F":[{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4142.58,3094.239 4143.646,3095.305 4143.646,3097.5"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4142.58,3092.5 4142.58,3094.239"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4158.656,3091.922 4144.984,3091.922 4144.406,3092.5"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4142.58,3092.5 4144.406,3092.5"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.175,3091.922 4158.656,3091.922"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.175,3132.079 4172.318,3132.079"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.318,3132.079 4171.605,3132.079"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3105.505 4154.894,3105.505"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4158.466,3103.742 4158.466,3095.772 4158.656,3095.582"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4158.466,3103.742 4156.657,3103.742 4154.894,3105.505"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4158.656,3091.922 4158.656,3095.582"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4161.453,3132.079 4161.453,3106.729 4158.466,3103.742"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4158.656,3132.079 4161.453,3132.079"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4161.453,3132.079 4161.673,3132.299 4171.385,3132.299 4171.605,3132.079"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4140.42,3094.239 4139.354,3095.305 4139.354,3097.5"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4140.42,3092.5 4140.42,3094.239"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3116.5 4139.796,3118.664"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.804,3118.672 4139.804,3121.328 4139.796,3121.336"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.804,3118.672 4139.796,3118.664"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3101.336 4139.354,3100.894 4139.354,3097.5"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3103.5 4139.796,3101.336"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3116.5 4139.796,3110"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3115.544 4148.755,3115.544"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3110 4139.796,3107.595"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3107.595 4139.796,3103.5"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3107.595 4159.007,3107.595"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3122.418 4139.796,3121.336"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.804,3118.672 4146.474,3118.672 4148.755,3116.391 4148.755,3115.544"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3122.418 4139.796,3123.5"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4139.796,3123.5 4139.796,3130.5"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4148.755,3122.827 4143.246,3128.336 4143.204,3128.336"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3130.5 4143.204,3128.336"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4150.29,3122.827 4148.755,3122.827"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4150.29,3122.827 4151.825,3122.827"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3122.827 4154.894,3122.827"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4155.7,3122.906 4154.973,3122.906 4154.894,3122.827"},{"type":"polyline","net":"DI","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3123.5 4143.204,3121.336"},{"type":"polyline","net":"DI","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3118.497 4156.258,3118.497 4157.069,3117.686"},{"type":"polyline","net":"DI","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3121.336 4146.927,3121.336 4149.766,3118.497 4151.825,3118.497"},{"type":"polyline","net":"SCLK","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3110 4145.419,3110"},{"type":"polyline","net":"SCLK","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3109.835 4151.825,3109.9"},{"type":"polyline","net":"SCLK","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4145.419,3110 4145.519,3109.9 4151.825,3109.9"},{"type":"polyline","net":"SCLK","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3109.9 4155.562,3109.9 4158.892,3113.23"},{"type":"polyline","net":"DO","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3103.5 4143.204,3101.336"},{"type":"polyline","net":"DO","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3101.336 4143.366,3101.174 4151.825,3101.174"},{"type":"polyline","net":"DO","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4151.825,3101.174 4154.894,3101.174"},{"type":"polyline","net":"DO","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4154.894,3101.174 4155.67,3101.174"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3114.336 4144.752,3112.788 4151.825,3112.788"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3116.5 4143.204,3115.418"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3115.418 4143.204,3114.336"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4163.758,3129.994 4163.758,3116.242 4169.376,3110.624"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4143.204,3115.418 4146.202,3115.418"},{"start":[4169.376,3110.624],"end":[4169.376,3110.624],"width":2.4,"net":"SWITCH"},{"start":[4163.758,3129.994],"end":[4163.758,3129.994],"width":2.4,"net":"SWITCH"},{"start":[4146.202,3115.418],"end":[4146.202,3115.418],"width":2.4,"net":"SWITCH"},{"start":[4155.67,3101.174],"end":[4155.67,3101.174],"width":2.4,"net":"DO"},{"start":[4158.892,3113.23],"end":[4158.892,3113.23],"width":2.4,"net":"SCLK"},{"start":[4157.069,3117.686],"end":[4157.069,3117.686],"width":2.4,"net":"DI"},{"start":[4155.7,3122.906],"end":[4155.7,3122.906],"width":2.4,"net":"CS"},{"start":[4159.007,3107.595],"end":[4159.007,3107.595],"width":2.4,"net":"3V3"},{"start":[4171.605,3132.079],"end":[4171.605,3132.079],"width":2.4,"net":"GND"}],"B":[{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3122.5 4172.399,3122.5"},{"type":"polyline","net":"GND","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.399,3122.5 4171.605,3123.294 4171.605,3132.079"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3094.5 4172.399,3094.5"},{"type":"polyline","net":"3V3","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.399,3094.5 4159.304,3107.595 4159.007,3107.595"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3075.5 4176.5,3079.601"},{"type":"polyline","net":"CS","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3079.601 4173.424,3079.601 4151.965,3101.06 4151.965,3119.171 4155.7,3122.906"},{"type":"polyline","net":"DI","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3085.5 4176.5,3089.601"},{"type":"polyline","net":"DI","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3089.601 4173.057,3089.601 4156.44,3106.218 4156.44,3117.057 4157.069,3117.686"},{"type":"polyline","net":"SCLK","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3113 4159.122,3113 4158.892,3113.23"},{"type":"polyline","net":"DO","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3132.5 4174.236,3134.764 4170.82,3134.764 4166.063,3130.007 4166.063,3129.038 4164.714,3127.689 4163.745,3127.689 4153.997,3117.941 4153.997,3102.847 4155.67,3101.174"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4176.5,3103.5 4172.399,3103.5"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.399,3103.5 4172.399,3107.601 4169.376,3110.624"},{"type":"polyline","net":"SWITCH","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4163.758,3129.994 4159.269,3129.994 4146.202,3116.927 4146.202,3115.418"},{"start":[4169.376,3110.624],"end":[4169.376,3110.624],"width":2.4,"net":"SWITCH"},{"start":[4163.758,3129.994],"end":[4163.758,3129.994],"width":2.4,"net":"SWITCH"},{"start":[4146.202,3115.418],"end":[4146.202,3115.418],"width":2.4,"net":"SWITCH"},{"start":[4155.67,3101.174],"end":[4155.67,3101.174],"width":2.4,"net":"DO"},{"start":[4158.892,3113.23],"end":[4158.892,3113.23],"width":2.4,"net":"SCLK"},{"start":[4157.069,3117.686],"end":[4157.069,3117.686],"width":2.4,"net":"DI"},{"start":[4155.7,3122.906],"end":[4155.7,3122.906],"width":2.4,"net":"CS"},{"start":[4159.007,3107.595],"end":[4159.007,3107.595],"width":2.4,"net":"3V3"},{"start":[4171.605,3132.079],"end":[4171.605,3132.079],"width":2.4,"net":"GND"}]},"zones":{"F":[{"net":"GND","svgpath":"M 4082.93229 3135.48 L 4082.77843 3135.44922 4082.64824 3135.36163 4082.56176 3135.2307 4082.5323 3135.07658 4082.85485 3097.33327 4082.88754 3097.17827 4082.97785 3097.04811 4083.1116 3096.96321 4083.26782 3096.9369 4085.79698 3097.01904 4085.99423 3097.00945 4092.71453 3096.13342 4092.86181 3096.10383 4092.99298 3096.05999 4095.71685 3094.95054 4095.87724 3094.87037 4098.36885 3093.37602 4098.41607 3093.34614 4099.89694 3092.35889 4100.06944 3092.21968 4102.6843 3089.68406 4102.74754 3089.61164 4118.39069 3072.64883 4118.52423 3072.55362 4118.68474 3072.52 4179.08 3072.52 4179.23307 3072.55045 4179.36284 3072.63716 4179.44955 3072.76693 4179.48 3072.92 4179.48 3135.08 4179.44955 3135.23307 4179.36284 3135.36284 4179.23307 3135.44955 4179.08 3135.48 4082.93229 3135.48 Z M 4144.29504 3132.583 L 4144.54391 3132.55496 4144.75896 3132.47971 4144.95188 3132.35849 4145.11299 3132.19738 4145.23421 3132.00446 4145.30946 3131.78941 4145.3375 3131.54054 4145.3375 3129.45946 4145.30946 3129.21059 4145.23421 3128.99554 4145.16042 3128.83591 4145.1529 3128.70212 4145.19 3128.57335 4145.26755 3128.46406 4148.20674 3125.52487 4148.33355 3125.4394 4148.48317 3125.40776 4148.63372 3125.43459 4148.76321 3125.51595 4148.8527 3125.63996 4148.88912 3125.78848 4148.8366 3126.19581 4148.8366 3128.11939 4148.86464 3128.36826 4148.93989 3128.58331 4149.06111 3128.77623 4149.22222 3128.93734 4149.41514 3129.05856 4149.63019 3129.13381 4149.87906 3129.16185 4153.77114 3129.16185 4154.02001 3129.13381 4154.23506 3129.05856 4154.42798 3128.93734 4154.58909 3128.77623 4154.71031 3128.58331 4154.78556 3128.36826 4154.8136 3128.11939 4154.8136 3126.19581 4154.78556 3125.94694 4154.71031 3125.73189 4154.64578 3125.62919 4154.58971 3125.48092 4154.59564 3125.32251 4154.66263 3125.17885 4154.78017 3125.07249 4154.92979 3125.02013 4155.088 3125.03001 4155.31477 3125.09077 4155.7 3125.12447 4156.08523 3125.09077 4156.45876 3124.99068 4156.80924 3124.82725 4157.12601 3124.60545 4157.39945 3124.33201 4157.62125 3124.01524 4157.78468 3123.66476 4157.88477 3123.29123 4157.91847 3122.906 4157.88477 3122.52077 4157.78468 3122.14724 4157.62125 3121.79676 4157.39945 3121.47999 4157.12601 3121.20655 4156.80924 3120.98475 4156.45876 3120.82132 4156.328 3120.78628 4156.18654 3120.71611 4156.08326 3120.59666 4156.03425 3120.44655 4156.04716 3120.28918 4156.11996 3120.14905 4156.24132 3120.04803 4156.39232 3120.00184 4156.55416 3119.9859 4156.80377 3119.91018 4156.95474 3119.89448 4157.069 3119.90447 4157.45423 3119.87077 4157.82776 3119.77068 4158.17824 3119.60725 4158.49501 3119.38545 4158.76845 3119.11201 4158.99025 3118.79524 4159.15368 3118.44476 4159.25377 3118.07123 4159.28747 3117.686 4159.25377 3117.30077 4159.15368 3116.92724 4158.99025 3116.57676 4158.76845 3116.25999 4158.63871 3116.13026 4158.55427 3116.00585 4158.52172 3115.85905 4158.54568 3115.71061 4158.62274 3115.5815 4158.74203 3115.48996 4158.88669 3115.44894 4159.27723 3115.41477 4159.65076 3115.31468 4160.00124 3115.15125 4160.31801 3114.92945 4160.59145 3114.65601 4160.81325 3114.33924 4160.97668 3113.98876 4161.07677 3113.61523 4161.11047 3113.23 4161.07677 3112.84477 4160.97668 3112.47124 4160.81325 3112.12076 4160.59145 3111.80399 4160.31801 3111.53055 4160.00124 3111.30875 4159.65076 3111.14532 4159.27723 3111.04523 4158.96156 3111.01761 4158.82738 3110.98166 4158.71358 3110.90198 4158.26969 3110.45808 4158.18079 3110.32292 4158.1527 3110.16361 4158.19001 3110.00619 4158.28661 3109.87643 4158.42671 3109.79554 4158.58739 3109.77676 4159.007 3109.81347 4159.39223 3109.77977 4159.76576 3109.67968 4160.11624 3109.51625 4160.43301 3109.29445 4160.70645 3109.02101 4160.92825 3108.70424 4161.09168 3108.35376 4161.19177 3107.98023 4161.22547 3107.595 4161.19177 3107.20977 4161.09168 3106.83624 4160.92825 3106.48576 4160.70645 3106.16899 4160.43301 3105.89555 4160.11624 3105.67375 4159.76576 3105.51032 4159.39223 3105.41023 4159.007 3105.37653 4158.62177 3105.41023 4158.24824 3105.51032 4157.89776 3105.67375 4157.58099 3105.89555 4157.5187 3105.95784 4157.38893 3106.04455 4157.23586 3106.075 4145.19999 3106.075 4145.04677 3106.04449 4144.91693 3105.95762 4144.83026 3105.82764 4144.79999 3105.67438 4144.83074 3105.52121 4144.91781 3105.3915 4145.11324 3105.19698 4145.23421 3105.00446 4145.30946 3104.78941 4145.3375 3104.54054 4145.3375 3103.094 4145.36795 3102.94093 4145.45466 3102.81116 4145.58443 3102.72445 4145.7375 3102.694 4148.79749 3102.694 4148.95057 3102.72445 4149.08034 3102.81116 4149.22222 3102.95304 4149.41514 3103.07426 4149.63019 3103.14951 4149.87906 3103.17755 4153.77114 3103.17755 4154.02001 3103.14951 4154.24178 3103.07191 4154.39383 3103.04996 4154.54293 3103.08694 4154.91124 3103.25868 4155.28477 3103.35877 4155.67 3103.39247 4156.05523 3103.35877 4156.42876 3103.25868 4156.77924 3103.09525 4157.09601 3102.87345 4157.36945 3102.60001 4157.59125 3102.28324 4157.75468 3101.93276 4157.85477 3101.55923 4157.88847 3101.174 4157.85477 3100.78877 4157.75468 3100.41524 4157.59125 3100.06476 4157.36945 3099.74799 4157.09601 3099.47455 4156.77924 3099.25275 4156.42876 3099.08932 4156.05523 3098.98923 4155.67 3098.95553 4155.28477 3098.98923 4155.03378 3099.05648 4154.87557 3099.06636 4154.72595 3099.014 4154.60841 3098.90764 4154.54142 3098.76398 4154.53549 3098.60557 4154.59156 3098.4573 4154.71031 3098.26831 4154.78556 3098.05326 4154.8136 3097.80439 4154.8136 3095.88081 4154.78556 3095.63194 4154.71031 3095.41689 4154.58909 3095.22397 4154.42798 3095.06286 4154.23506 3094.94164 4154.02001 3094.86639 4153.77114 3094.83835 4149.87906 3094.83835 4149.63019 3094.86639 4149.41514 3094.94164 4149.22222 3095.06286 4149.06111 3095.22397 4148.93989 3095.41689 4148.86464 3095.63194 4148.8366 3095.88081 4148.8366 3097.80439 4148.86464 3098.05326 4148.93989 3098.26831 4149.06111 3098.46123 4149.22222 3098.62234 4149.29689 3098.66926 4149.41288 3098.78016 4149.47595 3098.92771 4149.47595 3099.08819 4149.41288 3099.23574 4149.29689 3099.34664 4149.22222 3099.39356 4149.07894 3099.53684 4148.94917 3099.62355 4148.79609 3099.654 4143.38565 3099.654 4143.06984 3099.6851 4142.78506 3099.77149 4142.52261 3099.91178 4142.2773 3100.11309 4142.14309 3100.2473 4141.94178 3100.49261 4141.85277 3100.65913 4141.74142 3100.7895 4141.58572 3100.86128 4141.41428 3100.86128 4141.25858 3100.7895 4141.14723 3100.65913 4141.05822 3100.49261 4140.9648 3100.37877 4140.89738 3100.25976 4140.874 3100.12501 4140.874 3099.93038 4140.90738 3099.77043 4141.00193 3099.63716 4141.14189 3099.55283 4141.35086 3099.47971 4141.54378 3099.35849 4141.70489 3099.19738 4141.82611 3099.00446 4141.90136 3098.78941 4141.9294 3098.54054 4141.9294 3096.45946 4141.90136 3096.21059 4141.82611 3095.99554 4141.70489 3095.80262 4141.62415 3095.72188 4141.54131 3095.60113 4141.50747 3095.45866 4141.52718 3095.31356 4141.59779 3095.18528 4141.68222 3095.08239 4141.82251 3094.81994 4141.9089 3094.53516 4141.94 3094.21935 4141.94 3093.88923 4141.95563 3093.7785 4142.06236 3093.57926 4142.13761 3093.36421 4142.16565 3093.11534 4142.16565 3091.88466 4142.13761 3091.63579 4142.06236 3091.42074 4141.94114 3091.22782 4141.78003 3091.06671 4141.58711 3090.94549 4141.37206 3090.87024 4141.12319 3090.8422 4139.71761 3090.8422 4139.46874 3090.87024 4139.25369 3090.94549 4139.06077 3091.06671 4138.89966 3091.22782 4138.77844 3091.42074 4138.70319 3091.63579 4138.67515 3091.88466 4138.67515 3093.11534 4138.70319 3093.36421 4138.73475 3093.4544 4138.75692 3093.60147 4138.72382 3093.74647 4138.64004 3093.86936 4138.29309 3094.2163 4138.09178 3094.46161 4137.95149 3094.72406 4137.8651 3095.00884 4137.85608 3095.10049 4137.81338 3095.24488 4137.72033 3095.36325 4137.59012 3095.43884 4137.35734 3095.52029 4137.16442 3095.64151 4137.00331 3095.80262 4136.88209 3095.99554 4136.80684 3096.21059 4136.7788 3096.45946 4136.7788 3098.54054 4136.80684 3098.78941 4136.88209 3099.00446 4137.00331 3099.19738 4137.16442 3099.35849 4137.35734 3099.47971 4137.56611 3099.55276 4137.70607 3099.63709 4137.80062 3099.77036 4137.834 3099.93031 4137.834 3100.87435 4137.8651 3101.19016 4137.9446 3101.45221 4137.95827 3101.62146 4137.90051 3101.78113 4137.76579 3101.99554 4137.69054 3102.21059 4137.6625 3102.45946 4137.6625 3104.54054 4137.69054 3104.78941 4137.76579 3105.00446 4137.88701 3105.19738 4138.04812 3105.35849 4138.18873 3105.47335 4138.25355 3105.59064 4138.276 3105.72275 4138.276 3107.77725 4138.25355 3107.90936 4138.18873 3108.02665 4138.04812 3108.14151 4137.88701 3108.30262 4137.76579 3108.49554 4137.69054 3108.71059 4137.6625 3108.95946 4137.6625 3111.04054 4137.69054 3111.28941 4137.76579 3111.50446 4137.88701 3111.69738 4138.04812 3111.85849 4138.18873 3111.97335 4138.25355 3112.09064 4138.276 3112.22275 4138.276 3114.27725 4138.25355 3114.40936 4138.18873 3114.52665 4138.04812 3114.64151 4137.88701 3114.80262 4137.76579 3114.99554 4137.69054 3115.21059 4137.6625 3115.45946 4137.6625 3117.54054 4137.69054 3117.78941 4137.76579 3118.00446 4137.88701 3118.19738 4138.06681 3118.37719 4138.13933 3118.43732 4138.24603 3118.57513 4138.284 3118.74523 4138.284 3121.25477 4138.24603 3121.42487 4138.13933 3121.56268 4138.06681 3121.62281 4137.88701 3121.80262 4137.76579 3121.99554 4137.69054 3122.21059 4137.6625 3122.45946 4137.6625 3124.54054 4137.69054 3124.78941 4137.76579 3125.00446 4137.88701 3125.19738 4138.04812 3125.35849 4138.18873 3125.47335 4138.25355 3125.59064 4138.276 3125.72275 4138.276 3128.27725 4138.25355 3128.40936 4138.18873 3128.52665 4138.04812 3128.64151 4137.88701 3128.80262 4137.76579 3128.99554 4137.69054 3129.21059 4137.6625 3129.45946 4137.6625 3131.54054 4137.69054 3131.78941 4137.76579 3132.00446 4137.88701 3132.19738 4138.04812 3132.35849 4138.24104 3132.47971 4138.45609 3132.55496 4138.70496 3132.583 4140.88704 3132.583 4141.13591 3132.55496 4141.36789 3132.47379 4141.5 3132.45134 4141.63211 3132.47379 4141.86409 3132.55496 4142.11296 3132.583 4144.29504 3132.583 Z M 4163.37277 3132.17877 L 4163.758 3132.21247 4164.14323 3132.17877 4164.51676 3132.07868 4164.86724 3131.91525 4165.18401 3131.69345 4165.45745 3131.42001 4165.67925 3131.10324 4165.84268 3130.75276 4165.94277 3130.37923 4165.97647 3129.994 4165.94277 3129.60877 4165.84268 3129.23524 4165.67925 3128.88476 4165.45745 3128.56799 4165.39516 3128.5057 4165.30845 3128.37593 4165.278 3128.22286 4165.278 3117.03729 4165.30845 3116.88422 4165.39516 3116.75445 4169.19758 3112.95202 4169.31138 3112.87234 4169.44556 3112.83639 4169.76123 3112.80877 4170.13476 3112.70868 4170.48524 3112.54525 4170.80201 3112.32345 4171.07545 3112.05001 4171.29725 3111.73324 4171.46068 3111.38276 4171.56077 3111.00923 4171.59447 3110.624 4171.56077 3110.23877 4171.46068 3109.86524 4171.29725 3109.51476 4171.07545 3109.19799 4170.80201 3108.92455 4170.48524 3108.70275 4170.13476 3108.53932 4169.76123 3108.43923 4169.376 3108.40553 4168.99077 3108.43923 4168.61724 3108.53932 4168.26676 3108.70275 4167.94999 3108.92455 4167.67655 3109.19799 4167.45475 3109.51476 4167.29132 3109.86524 4167.19123 3110.23877 4167.16361 3110.55444 4167.12766 3110.68862 4167.04798 3110.80242 4162.69709 3115.1533 4162.49578 3115.39861 4162.35549 3115.66106 4162.2691 3115.94584 4162.238 3116.26165 4162.238 3128.22286 4162.20755 3128.37593 4162.12084 3128.5057 4162.05855 3128.56799 4161.83675 3128.88476 4161.67332 3129.23524 4161.57323 3129.60877 4161.53953 3129.994 4161.57323 3130.37923 4161.67332 3130.75276 4161.83675 3131.10324 4162.05855 3131.42001 4162.33199 3131.69345 4162.64876 3131.91525 4162.99924 3132.07868 4163.37277 3132.17877 Z "}],"B":[{"net":"GND","svgpath":"M 4177.70977 3081.48 L 4177.55067 3081.447 4177.41783 3081.35344 4177.33316 3081.21476 4177.31063 3081.05384 4177.35397 3080.89724 4177.45602 3080.7708 4177.57343 3080.67443 4177.76222 3080.44439 4177.90251 3080.18194 4178.03129 3079.74016 4178.11996 3079.62362 4178.24462 3079.5468 4178.38858 3079.52 4179.08 3079.52 4179.23307 3079.55045 4179.36284 3079.63716 4179.44955 3079.76693 4179.48 3079.92 4179.48 3081.08 4179.44955 3081.23307 4179.36284 3081.36284 4179.23307 3081.44955 4179.08 3081.48 4177.70977 3081.48 Z "},{"net":"GND","svgpath":"M 4179.23307 3090.44955 L 4179.08 3090.48 4178.35143 3090.48 4178.2106 3090.45439 4178.0878 3090.38083 4177.99877 3090.26875 4177.95489 3090.1325 4177.9618 3089.98953 4177.99895 3089.82953 4178.07647 3089.66982 4178.21548 3089.5594 4178.38858 3089.52 4179.08 3089.52 4179.23307 3089.55045 4179.36284 3089.63716 4179.44955 3089.76693 4179.48 3089.92 4179.48 3090.08 4179.44955 3090.23307 4179.36284 3090.36284 4179.23307 3090.44955 Z "},{"net":"GND","svgpath":"M 4158.36374 3102.09165 L 4158.19207 3102.11425 4158.02693 3102.06219 4157.89927 3101.94521 4157.83301 3101.78524 4157.84056 3101.61225 4157.85477 3101.55923 4157.88847 3101.174 4157.85477 3100.78877 4157.75468 3100.41524 4157.59125 3100.06476 4157.36945 3099.74799 4157.09601 3099.47455 4156.77924 3099.25275 4156.71225 3099.22151 4156.58876 3099.13179 4156.50787 3099.00234 4156.48136 3098.85201 4156.5131 3098.7027 4156.59846 3098.57615 4171.79716 3083.37745 4171.92693 3083.29074 4172.08 3083.26029 4172.23307 3083.29074 4172.36284 3083.37745 4172.44955 3083.50722 4172.48 3083.66029 4172.48 3087.95664 4172.45436 3088.09754 4172.38074 3088.22037 4172.21361 3088.33878 4171.9683 3088.54009 4158.50978 3101.99862 4158.36374 3102.09165 Z "},{"net":"GND","svgpath":"M 4155.917 3104.42571 L 4155.76393 3104.39526 4155.63416 3104.30855 4155.54745 3104.17878 4155.517 3104.02571 4155.517 3103.77239 4155.5442 3103.62742 4155.62209 3103.50215 4155.74008 3103.41364 4155.88214 3103.37391 4156.10825 3103.34456 4156.28124 3103.33701 4156.44121 3103.40327 4156.55819 3103.53093 4156.61025 3103.69607 4156.58765 3103.86774 4156.49462 3104.01378 4156.19984 3104.30855 4156.07007 3104.39526 4155.917 3104.42571 Z "},{"net":"GND","svgpath":"M 4174.0423 3108.98 L 4173.882 3108.94648 4173.74857 3108.85152 4173.66437 3108.71105 4173.64353 3108.54862 4173.68953 3108.39144 4173.80151 3108.18194 4173.93029 3107.74016 4174.01896 3107.62362 4174.14362 3107.5468 4174.28758 3107.52 4179.08 3107.52 4179.23307 3107.55045 4179.36284 3107.63716 4179.44955 3107.76693 4179.48 3107.92 4179.48 3108.58 4179.44955 3108.73307 4179.36284 3108.86284 4179.23307 3108.94955 4179.08 3108.98 4174.0423 3108.98 Z "},{"net":"GND","svgpath":"M 4172.23074 3111.45051 L 4172.07663 3111.47999 4171.95283 3111.47894 4171.79279 3111.44406 4171.66015 3111.34795 4171.57715 3111.20674 4171.55772 3111.0441 4171.58839 3110.69356 4171.62434 3110.55938 4171.70402 3110.44558 4171.79716 3110.35245 4171.92693 3110.26574 4172.08 3110.23529 4172.23307 3110.26574 4172.36284 3110.35245 4172.44955 3110.48222 4172.48 3110.63529 4172.48 3111.08 4172.44923 3111.23385 4172.36165 3111.36403 4172.23074 3111.45051 Z "},{"net":"GND","svgpath":"M 4160.37193 3111.48 L 4160.25165 3111.46149 4160.1425 3111.40766 4160.00124 3111.30875 4159.65076 3111.14532 4159.27723 3111.04523 4158.892 3111.01153 4158.50677 3111.04523 4158.31819 3111.06826 4158.1784 3111.02685 4158.06274 3110.9381 4157.98657 3110.81379 4157.96 3110.67045 4157.96 3110.12374 4157.98657 3109.98039 4158.06274 3109.85609 4158.1784 3109.76734 4158.31819 3109.72593 4158.46353 3109.73737 4158.62177 3109.77977 4159.007 3109.81347 4159.39223 3109.77977 4159.76576 3109.67968 4160.11624 3109.51625 4160.43301 3109.29445 4160.70645 3109.02101 4160.92825 3108.70424 4161.09091 3108.35542 4161.20209 3107.92488 4161.24207 3107.82647 4161.30655 3107.74206 4171.80063 3097.24798 4171.92352 3097.16419 4172.06852 3097.1311 4172.21558 3097.15326 4172.34439 3097.22763 4172.43712 3097.34391 4172.48096 3097.48603 4172.50804 3097.72641 4172.58329 3097.94146 4172.70451 3098.13438 4172.86562 3098.29549 4173.05854 3098.41671 4173.27359 3098.49196 4173.52246 3098.52 4179.08 3098.52 4179.23307 3098.55045 4179.36284 3098.63716 4179.44955 3098.76693 4179.48 3098.92 4179.48 3099.08 4179.44955 3099.23307 4179.36284 3099.36284 4179.23307 3099.44955 4179.08 3099.48 4173.52246 3099.48 4173.27359 3099.50804 4173.05854 3099.58329 4172.86562 3099.70451 4172.70451 3099.86562 4172.58329 3100.05854 4172.50804 3100.27359 4172.48 3100.52246 4172.48 3101.61142 4172.4532 3101.75538 4172.37638 3101.88004 4172.25984 3101.96871 4171.81806 3102.09749 4171.55561 3102.23778 4171.32557 3102.42657 4171.13678 3102.65661 4170.99649 3102.91906 4170.9101 3103.20384 4170.879 3103.51965 4170.879 3106.80571 4170.84855 3106.95878 4170.76184 3107.08855 4169.55442 3108.29598 4169.44062 3108.37566 4169.30644 3108.41161 4168.99077 3108.43923 4168.61724 3108.53932 4168.26676 3108.70275 4167.94999 3108.92455 4167.67655 3109.19799 4167.45475 3109.51476 4167.29132 3109.86524 4167.19123 3110.23877 4167.15753 3110.624 4167.19331 3111.03296 4167.19389 3111.12181 4167.15249 3111.2616 4167.06374 3111.37726 4166.93943 3111.45343 4166.79608 3111.48 4160.37193 3111.48 Z "},{"net":"GND","svgpath":"M 4160.06429 3128.474 L 4159.91122 3128.44355 4159.78145 3128.35684 4156.81849 3125.39388 4156.72545 3125.24785 4156.70285 3125.07618 4156.75492 3124.91104 4156.8719 3124.78338 4157.12601 3124.60545 4157.39945 3124.33201 4157.47154 3124.22906 4157.5992 3124.11208 4157.76433 3124.06001 4157.936 3124.08261 4158.08204 3124.17564 4161.69755 3127.79116 4161.78426 3127.92093 4161.81471 3128.074 4161.78426 3128.22707 4161.69755 3128.35684 4161.56778 3128.44355 4161.41471 3128.474 4160.06429 3128.474 Z "},{"net":"GND","svgpath":"M 4172.23307 3133.21355 L 4172.08 3133.244 4171.61529 3133.244 4171.46222 3133.21355 4171.33245 3133.12684 4167.70016 3129.49455 4167.61345 3129.36478 4167.583 3129.21171 4167.583 3129.05765 4167.5519 3128.74184 4167.46551 3128.45706 4167.32522 3128.19461 4167.12391 3127.9493 4165.8027 3126.62809 4165.55739 3126.42678 4165.29494 3126.28649 4165.01016 3126.2001 4164.69435 3126.169 4164.54029 3126.169 4164.38722 3126.13855 4164.25745 3126.05184 4158.30041 3120.09481 4158.20738 3119.94877 4158.18478 3119.7771 4158.23685 3119.61197 4158.35382 3119.4843 4158.49501 3119.38545 4158.76845 3119.11201 4158.99025 3118.79524 4159.15368 3118.44476 4159.25377 3118.07123 4159.28747 3117.686 4159.25377 3117.30077 4159.15368 3116.92724 4158.99025 3116.57676 4158.76845 3116.25999 4158.63871 3116.13026 4158.55427 3116.00585 4158.52172 3115.85905 4158.54568 3115.71061 4158.62274 3115.5815 4158.74203 3115.48996 4158.88669 3115.44894 4159.27723 3115.41477 4159.65076 3115.31468 4160.00124 3115.15125 4160.31801 3114.92945 4160.6103 3114.63716 4160.74007 3114.55045 4160.89314 3114.52 4172.08 3114.52 4172.23307 3114.55045 4172.36284 3114.63716 4172.44955 3114.76693 4172.48 3114.92 4172.48 3115.97754 4172.50804 3116.22641 4172.58329 3116.44146 4172.70451 3116.63438 4172.86562 3116.79549 4173.05854 3116.91671 4173.27359 3116.99196 4173.52246 3117.02 4179.08 3117.02 4179.23307 3117.05045 4179.36284 3117.13716 4179.44955 3117.26693 4179.48 3117.42 4179.48 3128.08 4179.44955 3128.23307 4179.36284 3128.36284 4179.23307 3128.44955 4179.08 3128.48 4173.52246 3128.48 4173.27359 3128.50804 4173.05854 3128.58329 4172.86562 3128.70451 4172.70451 3128.86562 4172.58329 3129.05854 4172.50804 3129.27359 4172.48 3129.52246 4172.48 3132.844 4172.44955 3132.99707 4172.36284 3133.12684 4172.23307 3133.21355 Z "},{"net":"GND","svgpath":"M 4168.57378 3135.44955 L 4168.42071 3135.48 4082.93229 3135.48 4082.77843 3135.44922 4082.64824 3135.36163 4082.56176 3135.2307 4082.5323 3135.07658 4082.85485 3097.33327 4082.88754 3097.17827 4082.97785 3097.04811 4083.1116 3096.96321 4083.26782 3096.9369 4085.79698 3097.01904 4085.99423 3097.00945 4092.71453 3096.13342 4092.86181 3096.10383 4092.99298 3096.05999 4095.71685 3094.95054 4095.87724 3094.87037 4098.36885 3093.37602 4098.41607 3093.34614 4099.89694 3092.35889 4100.06944 3092.21968 4102.6843 3089.68406 4102.74754 3089.61164 4118.39069 3072.64883 4118.52423 3072.55362 4118.68474 3072.52 4172.08 3072.52 4172.23307 3072.55045 4172.36284 3072.63716 4172.44955 3072.76693 4172.48 3072.92 4172.48 3078.23216 4172.44203 3078.40225 4172.33534 3078.54005 4150.90409 3099.9713 4150.70278 3100.21661 4150.56249 3100.47906 4150.4761 3100.76384 4150.445 3101.07965 4150.445 3118.05471 4150.41455 3118.20778 4150.32784 3118.33755 4150.19807 3118.42426 4150.045 3118.45471 4149.89193 3118.42426 4149.76216 3118.33755 4148.26679 3116.84219 4148.17789 3116.70703 4148.1498 3116.54771 4148.18711 3116.3903 4148.28668 3116.17676 4148.38677 3115.80323 4148.42047 3115.418 4148.38677 3115.03277 4148.28668 3114.65924 4148.12325 3114.30876 4147.90145 3113.99199 4147.62801 3113.71855 4147.31124 3113.49675 4146.96076 3113.33332 4146.58723 3113.23323 4146.202 3113.19953 4145.81677 3113.23323 4145.44324 3113.33332 4145.09276 3113.49675 4144.77599 3113.71855 4144.50255 3113.99199 4144.28075 3114.30876 4144.11732 3114.65924 4144.01723 3115.03277 4143.98353 3115.418 4144.01723 3115.80323 4144.11732 3116.17676 4144.28075 3116.52724 4144.50255 3116.84401 4144.59348 3116.93494 4144.67223 3117.04676 4144.7131 3117.22316 4144.79949 3117.50794 4144.93978 3117.77039 4145.14109 3118.0157 4158.1803 3131.05491 4158.42561 3131.25622 4158.68806 3131.39651 4158.97284 3131.4829 4159.28865 3131.514 4161.98686 3131.514 4162.13993 3131.54445 4162.2697 3131.63116 4162.33199 3131.69345 4162.64876 3131.91525 4162.99924 3132.07868 4163.37277 3132.17877 4163.758 3132.21247 4164.14323 3132.17877 4164.51676 3132.07868 4164.86724 3131.91525 4165.15365 3131.71471 4165.27955 3131.656 4165.41794 3131.64389 4165.55212 3131.67984 4165.66592 3131.75952 4168.70355 3134.79716 4168.79026 3134.92693 4168.82071 3135.08 4168.79026 3135.23307 4168.70355 3135.36284 4168.57378 3135.44955 Z "}]},"pads":[{"layers":["B"],"pos":[4176.5,3132.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3132.5},"polygon":[{"x":4179.5003,"y":3135.5001},{"x":4173.5003,"y":3135.5001},{"x":4173.5003,"y":3129.5001},{"x":4179.5003,"y":3129.5001}],"net":"DO"},{"layers":["B"],"pos":[4176.5,3122.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3122.5},"polygon":[{"x":4179.5003,"y":3125.5001},{"x":4173.5003,"y":3125.5001},{"x":4173.5003,"y":3119.5001},{"x":4179.5003,"y":3119.5001}],"net":"GND"},{"layers":["B"],"pos":[4176.5,3113],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3113},"polygon":[{"x":4179.5003,"y":3116.0001},{"x":4173.5003,"y":3116.0001},{"x":4173.5003,"y":3110.0001},{"x":4179.5003,"y":3110.0001}],"net":"SCLK"},{"layers":["B"],"pos":[4176.5,3103.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3103.5},"polygon":[{"x":4179.5003,"y":3106.5001},{"x":4173.5003,"y":3106.5001},{"x":4173.5003,"y":3100.5001},{"x":4179.5003,"y":3100.5001}],"net":"SWITCH"},{"layers":["B"],"pos":[4176.5,3094.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3094.5},"polygon":[{"x":4179.5003,"y":3097.5001},{"x":4173.5003,"y":3097.5001},{"x":4173.5003,"y":3091.5001},{"x":4179.5003,"y":3091.5001}],"net":"3V3"},{"layers":["B"],"pos":[4176.5,3085.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3085.5},"polygon":[{"x":4179.5003,"y":3088.5001},{"x":4173.5003,"y":3088.5001},{"x":4173.5003,"y":3082.5001},{"x":4179.5003,"y":3082.5001}],"net":"DI"},{"layers":["B"],"pos":[4176.5,3075.5],"size":[6,6],"angle":-180,"pin1":1,"shape":"rect","type":"smd","drillsize":[0,0],"holeCenterPoint":{"x":4176.5,"y":3075.5},"polygon":[{"x":4179.5003,"y":3078.5001},{"x":4173.5003,"y":3078.5001},{"x":4173.5003,"y":3072.5001},{"x":4179.5003,"y":3072.5001}],"net":"CS"}],"nets":["DO","GND","SCLK","SWITCH","3V3","DI","CS"],"bom":{"both":[[1,"10uF","C0402",[["C6",0]],[" "," "," "," "]],[5,"47k","R0402",[["R1",1],["R2",2],["R3",3],["R4",4],["R5",5]],[" "," "," "," "]],[1,"TF-123-ARP9H17","TF-SMD_TF-123-ARP9H15",[["U1",6]],[" "," "," "," "]],[1,"100nF","C0201",[["U4",7]],[" "," "," "," "]]],"F":[[1,"10uF","C0402",[["C6",0]],[" "," "," "," "]],[5,"47k","R0402",[["R1",1],["R2",2],["R3",3],["R4",4],["R5",5]],[" "," "," "," "]],[1,"TF-123-ARP9H17","TF-SMD_TF-123-ARP9H15",[["U1",6]],[" "," "," "," "]],[1,"100nF","C0201",[["U4",7]],[" "," "," "," "]]],"B":[],"skipped":[],"customColumns":[]}};
///////////////////////////////////////////////

///////////////////////////////////////////////
/* Utility functions */

var storagePrefix = 'ibom__' + pcbdata.metadata.title + '__' +
  pcbdata.metadata.revision + '__#';

function buildKeyForLocalStorageDict() {  
  return storagePrefix;
}

var storage;
var _isLocalStorageUsed = false;

function initStorage(key) {
  try {
    window.localStorage.getItem("blank");
    storage = window.localStorage;    
    _isLocalStorageUsed = true;
  } catch (e) {
    // localStorage not available
  }
  if (!storage) {
    try {
      window.sessionStorage.getItem("blank");
      storage = window.sessionStorage;      
    } catch (e) {
      // sessionStorage also not available
    }
  }
}



function readStorage(key) {
  if(!storage) {
    return null;
  }

  if(!_isLocalStorageUsed) {    
    return storage.getItem(storagePrefix + key);
  }

  try {
    var dictKey = buildKeyForLocalStorageDict();
    var obj = JSON.parse(storage.getItem(dictKey));    
    if(!obj || !obj.hasOwnProperty(key)) {
      return null;
    }

    return JSON.parse(storage.getItem(dictKey))[key];
  } catch(e) {
    console.log('[ibom]: Unable to obtain a value from local storage!');
    console.log(e);
  }
  
  // Original implementation
  // return storage.getItem(storagePrefix + key);
}


function writeStorage(key, value) {
  if(!storage) {
    return;
  }

  if(!_isLocalStorageUsed) {
    storage.setItem(storagePrefix + key, value);
    return;
  }

  try {
    var dictKey = buildKeyForLocalStorageDict();
    if(!storage.getItem(dictKey)) {
      storage.setItem(dictKey,JSON.stringify({
        _storagePrefix: storagePrefix
      }));
    }

    var obj = JSON.parse(storage.getItem(dictKey));
    obj[key] = value;
    storage.setItem(dictKey,JSON.stringify(obj));            
  } catch(e) {
    console.log('[ibom]: Unable to write key to local storage!');
    console.log(e);
  }
  
  // Original implementation
  // storage.setItem(storagePrefix + key, value);
}

function fancyDblClickHandler(el, onsingle, ondouble) {
  return function() {
    if (el.getAttribute("data-dblclick") == null) {
      el.setAttribute("data-dblclick", 1);
      setTimeout(function() {
        if (el.getAttribute("data-dblclick") == 1) {
          onsingle();
        }
        el.removeAttribute("data-dblclick");
      }, 200);
    } else {
      el.removeAttribute("data-dblclick");
      ondouble();
    }
  }
}

function smoothScrollToRow(rowid) {
  document.getElementById(rowid).scrollIntoView({
    behavior: "smooth",
    block: "center",
    inline: "nearest"
  });
}

function focusInputField(input) {
  input.scrollIntoView(false);
  input.focus();
  input.select();
}

function copyToClipboard() {
  var text = '';
  for (var node of bomhead.childNodes[0].childNodes) {
    if (node.firstChild) {
      text = text + node.firstChild.nodeValue;
    }
    if (node != bomhead.childNodes[0].lastChild) {
      text += '\t';
    }
  }
  text += '\n';
  for (var row of bombody.childNodes) {
    for (var cell of row.childNodes) {
      for (var node of cell.childNodes) {
        if (node.nodeName == "INPUT") {
          if (node.checked) {
            text = text + '';
          }
        } else if (node.nodeName == "MARK") {
          text = text + node.firstChild.nodeValue;
        } else {
          text = text + node.nodeValue;
        }
      }
      if (cell != row.lastChild) {
        text += '\t';
      }
    }
    text += '\n';
  }
  var textArea = document.createElement("textarea");
  textArea.classList.add('clipboard-temp');
  textArea.value = text;

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    if (document.execCommand('copy')) {
      console.log('Bom copied to clipboard.');
    }
  } catch (err) {
    console.log('Can not copy to clipboard.');
  }

  document.body.removeChild(textArea);
}

function removeGutterNode(node) {
  for (var i = 0; i < node.childNodes.length; i++) {
    if (node.childNodes[i].classList &&
      node.childNodes[i].classList.contains("gutter")) {
      node.removeChild(node.childNodes[i]);
      break;
    }
  }
}

function cleanGutters() {
  removeGutterNode(document.getElementById("bot"));
  removeGutterNode(document.getElementById("canvasdiv"));
}

var units = {
  prefixes: {
    giga: ["G", "g", "giga", "Giga", "GIGA"],
    mega: ["M", "mega", "Mega", "MEGA"],
    kilo: ["K", "k", "kilo", "Kilo", "KILO"],
    milli: ["m", "milli", "Milli", "MILLI"],
    micro: ["U", "u", "micro", "Micro", "MICRO", "", ""], // different utf8 
    nano: ["N", "n", "nano", "Nano", "NANO"],
    pico: ["P", "p", "pico", "Pico", "PICO"],
  },
  unitsShort: ["R", "r", "", "F", "f", "H", "h"],
  unitsLong: [
    "OHM", "Ohm", "ohm", "ohms",
    "FARAD", "Farad", "farad",
    "HENRY", "Henry", "henry"
  ],
  getMultiplier: function(s) {
    if (this.prefixes.giga.includes(s)) return 1e9;
    if (this.prefixes.mega.includes(s)) return 1e6;
    if (this.prefixes.kilo.includes(s)) return 1e3;
    if (this.prefixes.milli.includes(s)) return 1e-3;
    if (this.prefixes.micro.includes(s)) return 1e-6;
    if (this.prefixes.nano.includes(s)) return 1e-9;
    if (this.prefixes.pico.includes(s)) return 1e-12;
    return 1;
  },
  valueRegex: null,
}

function initUtils() {
  var allPrefixes = units.prefixes.giga
                    .concat(units.prefixes.mega)
                    .concat(units.prefixes.kilo)
                    .concat(units.prefixes.milli)
                    .concat(units.prefixes.micro)
                    .concat(units.prefixes.nano)
                    .concat(units.prefixes.pico);
  var allUnits = units.unitsShort.concat(units.unitsLong);
  units.valueRegex = new RegExp("^([0-9\.]+)" +
                         "\\s*(" + allPrefixes.join("|") + ")?" +
                         "(" + allUnits.join("|") + ")?" +
                         "(\\b.*)?$", "");
  units.valueAltRegex = new RegExp("^([0-9]*)" +
                         "(" + units.unitsShort.join("|") + ")?" +
                         "([GgMmKkUuNnPp])?" +
                         "([0-9]*)" +
                         "(\\b.*)?$", "");
  for (var bom_type of ["both", "F", "B"]) {
    for (var row of pcbdata.bom[bom_type]) {
      row.push(parseValue(row[1], row[3][0][0]));
    }
  }
}

function parseValue(val, ref) {
  var inferUnit = (unit, ref) => {
    if (unit) {
      unit = unit.toLowerCase();
      if (unit == '' || unit == "ohm" || unit == "ohms") {
        unit = 'r';
      }
      unit = unit[0];
    } else {
      ref = /^([a-z]+)\d+$/i.exec(ref);
      if (ref) {
        ref = ref[1].toLowerCase();
        if (ref == "c") unit = 'f';
        else if (ref == "l") unit = 'h';
        else if (ref == "r" || ref == "rv") unit = 'r';
        else unit = null;
      }
    }
    return unit;
  };
  val = val.replace(/,/g, "");
  var match = units.valueRegex.exec(val);
  var unit;
  if (match) {
    val = parseFloat(match[1]);
    if (match[2]) {
      val = val * units.getMultiplier(match[2]);
    }
    unit = inferUnit(match[3], ref);
    if (!unit) return null;
    else return {
      val: val,
      unit: unit,
      extra: match[4],
    }
  }
  match = units.valueAltRegex.exec(val);
  if (match && (match[1] || match[4])) {
    val = parseFloat(match[1] + "." + match[4]);
    if (match[3]) {
      val = val * units.getMultiplier(match[3]);
    }
    unit = inferUnit(match[2], ref);
    if (!unit) return null;
    else return {
      val: val,
      unit: unit,
      extra: match[5],
    }
  }
  return null;
}

function valueCompare(a, b, stra, strb) {
  if (a === null && b === null) {
    // Failed to parse both values, compare them as strings.
    if (stra != strb) return stra > strb ? 1 : -1;
    else return 0;
  } else if (a === null) {
    return 1;
  } else if (b === null) {
    return -1;
  } else {
    if (a.unit != b.unit) return a.unit > b.unit ? 1 : -1;
    else if (a.val != b.val) return a.val > b.val ? 1 : -1;
    else if (a.extra != b.extra) return a.extra > b.extra ? 1 : -1;
    else return 0;
  }
}

function validateSaveImgDimension(element) {
  var valid = false;
  var intValue = 0;
  if (/^[1-9]\d*$/.test(element.value)) {
    intValue = parseInt(element.value);
    if (intValue <= 16000) {
      valid = true;
    }
  }
  if (valid) {
    element.classList.remove("invalid");
  } else {
    element.classList.add("invalid");
  }
  return intValue;
}

function saveImage(layer) {
  var width = validateSaveImgDimension(document.getElementById("render-save-width"));
  var height = validateSaveImgDimension(document.getElementById("render-save-height"));
  var bgcolor = null;
  if (!document.getElementById("render-save-transparent").checked) {
    var style = getComputedStyle(topmostdiv);
    bgcolor = style.getPropertyValue("background-color");
  }
  if (!width || !height) return;

  // Prepare image
  var canvas = document.createElement("canvas");
  var layerdict = {
    transform: {
      x: 0,
      y: 0,
      s: 1,
      panx: 0,
      pany: 0,
      zoom: 1,
    },
    bg: canvas,
    fab: canvas,
    silk: canvas,
    highlight: canvas,
    layer: layer,
  }
  // Do the rendering
  recalcLayerScale(layerdict, width, height);
  prepareLayer(layerdict);
  clearCanvas(canvas, bgcolor);
  drawBackground(layerdict, false);
  drawHighlightsOnLayer(layerdict, false);

  // Save image
  var imgdata = canvas.toDataURL("image/png");

  var filename = pcbdata.metadata.title;
  if (pcbdata.metadata.revision) {
    filename += `.${pcbdata.metadata.revision}`;
  }
  filename += `.${layer}.png`;
  saveFile(filename, dataURLtoBlob(imgdata));
}

function saveSettings() {
  var data = {
    type: "InteractiveHtmlBom settings",
    version: 1,
    pcbmetadata: pcbdata.metadata,
    settings: settings,
  }
  var blob = new Blob([JSON.stringify(data, null, 4)], {type: "application/json"});
  saveFile(`${pcbdata.metadata.title}.settings.json`, blob);
}

function loadSettings() {
  var input = document.createElement("input");
  input.type = "file";
  input.accept = ".settings.json";
  input.onchange = function(e) {
    var file = e.target.files[0];
    var reader = new FileReader();
    reader.onload = readerEvent => {
      var content = readerEvent.target.result;
      var newSettings;
      try {
        newSettings = JSON.parse(content);
      } catch(e) {
        alert("Selected file is not InteractiveHtmlBom settings file.");
        return;
      }
      if (newSettings.type != "InteractiveHtmlBom settings") {
        alert("Selected file is not InteractiveHtmlBom settings file.");
        return;
      }
      var metadataMatches = newSettings.hasOwnProperty("pcbmetadata");
      if (metadataMatches) {
        for (var k in pcbdata.metadata) {
          if (!newSettings.pcbmetadata.hasOwnProperty(k) || newSettings.pcbmetadata[k] != pcbdata.metadata[k]) {
            metadataMatches = false;
          }
        }
      }
      if (!metadataMatches) {
        var currentMetadata = JSON.stringify(pcbdata.metadata, null, 4);
        var fileMetadata = JSON.stringify(newSettings.pcbmetadata, null, 4);
        if (!confirm(
          `Settins file metadata does not match current metadata.\n\n` +
          `Page metadata:\n${currentMetadata}\n\n` +
          `Settings file metadata:\n${fileMetadata}\n\n` +
          `Press OK if you would like to import settings anyway.`)) {
          return;
        }
      }
      overwriteSettings(newSettings.settings);
    }
    reader.readAsText(file, 'UTF-8');
  }
  input.click();
}

function overwriteSettings(newSettings) {

  initDone = false;
  Object.assign(settings, newSettings);
  writeStorage("bomlayout", settings.bomlayout);
  writeStorage("bommode", settings.bommode);
  writeStorage("canvaslayout", settings.canvaslayout);
  writeStorage("bomCheckboxes", settings.checkboxes.join(","));
  document.getElementById("bomCheckboxes").value = settings.checkboxes.join(",");
  for (var checkbox of settings.checkboxes) {
    writeStorage("checkbox_" + checkbox, settings.checkboxStoredRefs[checkbox]);
  }
  writeStorage("darkenWhenChecked", settings.darkenWhenChecked);
  padsVisible(settings.renderPads);
  document.getElementById("padsCheckbox").checked = settings.renderPads;
  fabricationVisible(settings.renderFabrication);
  document.getElementById("fabricationCheckbox").checked = settings.renderFabrication;
  silkscreenVisible(settings.renderSilkscreen);
  document.getElementById("silkscreenCheckbox").checked = settings.renderSilkscreen;
  referencesVisible(settings.renderReferences);
  document.getElementById("referencesCheckbox").checked = settings.renderReferences;
  valuesVisible(settings.renderValues);
  document.getElementById("valuesCheckbox").checked = settings.renderValues;
  tracksVisible(settings.renderTracks);
  document.getElementById("tracksCheckbox").checked = settings.renderTracks;
  zonesVisible(settings.renderZones);
  document.getElementById("zonesCheckbox").checked = settings.renderZones;
  dnpOutline(settings.renderDnpOutline);
  document.getElementById("dnpOutlineCheckbox").checked = settings.renderDnpOutline;
  setRedrawOnDrag(settings.redrawOnDrag);
  document.getElementById("dragCheckbox").checked = settings.redrawOnDrag;
  setShowCrosshair(settings.showCrosshair);
  document.getElementById("crosshairCheckbox").checked = settings.showCrosshair;
  setDarkMode(settings.darkMode);
  document.getElementById("darkmodeCheckbox").checked = settings.darkMode;
  setHighlightPin1(settings.highlightpin1);
  document.getElementById("highlightpin1Checkbox").checked = settings.highlightpin1;
  writeStorage("boardRotation", settings.boardRotation);
  document.getElementById("boardRotation").value = settings.boardRotation / 5;
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
  initDone = true;
  prepCheckboxes();
  changeBomLayout(settings.bomlayout);
}

function saveFile(filename, blob) {
  var link = document.createElement("a");
  var objurl = URL.createObjectURL(blob);
  link.download = filename;
  link.href = objurl;
  link.click();
}

function dataURLtoBlob(dataurl) {
  var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--){
      u8arr[n] = bstr.charCodeAt(n);
  }
  return new Blob([u8arr], {type:mime});
}

var settings = {
  canvaslayout: "default",
  bomlayout: "default",
  bommode: "grouped",
  checkboxes: [],
  checkboxStoredRefs: {},
  darkMode: false,
  highlightpin1: false,
  redrawOnDrag: true,
  boardRotation: 0,
  renderPads: true,
  renderReferences: true,
  renderValues: true,
  renderSilkscreen: true,
  renderFabrication: true,
  renderDnpOutline: false,
  renderTracks: true,
  renderZones: true,
}

function initDefaults() {
  settings.bomlayout = readStorage("bomlayout");
  if (settings.bomlayout === null) {
    settings.bomlayout = config.bom_view;
  }
  if (!['bom-only', 'left-right', 'top-bottom'].includes(settings.bomlayout)) {
    settings.bomlayout = config.bom_view;
  }
  settings.bommode = readStorage("bommode");
  if (settings.bommode === null) {
    settings.bommode = "grouped";
  }
  if (!["grouped", "ungrouped", "netlist"].includes(settings.bommode)) {
    settings.bommode = "grouped";
  }
  settings.canvaslayout = readStorage("canvaslayout");
  if (settings.canvaslayout === null) {
    settings.canvaslayout = config.layer_view;
  }
  var bomCheckboxes = readStorage("bomCheckboxes");
  if (bomCheckboxes === null) {
    bomCheckboxes = config.checkboxes;
  }
  settings.checkboxes = bomCheckboxes.split(",").filter((e) => e);
  document.getElementById("bomCheckboxes").value = bomCheckboxes;

  settings.darkenWhenChecked = readStorage("darkenWhenChecked") || "";
  populateDarkenWhenCheckedOptions();

  function initBooleanSetting(storageString, def, elementId, func) {    
    var b = readStorage(storageString);
    if (b === null) {
      b = def;
    } else {
      b = (b === true);
    }
    document.getElementById(elementId).checked = b;
    func(b);
  }

  initBooleanSetting("padsVisible", config.show_pads, "padsCheckbox", padsVisible);
  initBooleanSetting("fabricationVisible", config.show_fabrication, "fabricationCheckbox", fabricationVisible);
  initBooleanSetting("silkscreenVisible", config.show_silkscreen, "silkscreenCheckbox", silkscreenVisible);
  initBooleanSetting("referencesVisible", true, "referencesCheckbox", referencesVisible);
  initBooleanSetting("valuesVisible", false, "valuesCheckbox", valuesVisible);
  if ("tracks" in pcbdata) {
    initBooleanSetting("tracksVisible", true, "tracksCheckbox", tracksVisible);
    initBooleanSetting("zonesVisible", true, "zonesCheckbox", zonesVisible);
  } else {
    document.getElementById("tracksAndZonesCheckboxes").style.display = "none";
    tracksVisible(false);
    zonesVisible(false);
  }
  initBooleanSetting("dnpOutline", false, "dnpOutlineCheckbox", dnpOutline);
  initBooleanSetting("redrawOnDrag", config.redraw_on_drag, "dragCheckbox", setRedrawOnDrag);
  initBooleanSetting("showCrosshair", config.show_crosshair, "crosshairCheckbox", setShowCrosshair);
  initBooleanSetting("darkmode", config.dark_mode, "darkmodeCheckbox", setDarkMode);
  initBooleanSetting("highlightpin1", config.highlight_pin1, "highlightpin1Checkbox", setHighlightPin1);
  settings.boardRotation = readStorage("boardRotation");
  if (settings.boardRotation === null) {
    settings.boardRotation = config.board_rotation * 5;
  } else {
    settings.boardRotation = parseInt(settings.boardRotation);
  }
  document.getElementById("boardRotation").value = settings.boardRotation / 5;
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
}

// Helper classes for user js callbacks.

const IBOM_EVENT_TYPES = {
  ALL: "all",
  HIGHLIGHT_EVENT: "highlightEvent",
  CHECKBOX_CHANGE_EVENT: "checkboxChangeEvent",
  BOM_BODY_CHANGE_EVENT: "bomBodyChangeEvent",
}

const EventHandler = {
  callbacks: {},
  init: function() {
    for (eventType of Object.values(IBOM_EVENT_TYPES))
      this.callbacks[eventType] = [];
  },
  registerCallback: function(eventType, callback) {
    this.callbacks[eventType].push(callback);
  },
  emitEvent: function(eventType, eventArgs) {
    event = {
      eventType: eventType,
      args: eventArgs,
    }
    var callback;
    for(callback of this.callbacks[eventType])
      callback(event);
    for(callback of this.callbacks[IBOM_EVENT_TYPES.ALL])
      callback(event);
  }
}
EventHandler.init();

///////////////////////////////////////////////

///////////////////////////////////////////////
/* PCB rendering code */

var emptyContext2d = document.createElement("canvas").getContext("2d");
var hitTestContext2d = document.createElement("canvas").getContext("2d");

function deg2rad(deg) {
  return deg * Math.PI / 180;
}

function calcFontPoint(linepoint, text, offsetx, offsety, tilt) {
  var point = [
    linepoint[0] * text.width + offsetx,
    linepoint[1] * text.height + offsety
  ];
  // This approximates pcbnew behavior with how text tilts depending on horizontal justification
  point[0] -= (linepoint[1] + 0.5 * (1 + text.justify[0])) * text.height * tilt;
  return point;
}

function drawText(ctx, text, color) {
  if ("ref" in text && !settings.renderReferences) return;
  if ("val" in text && !settings.renderValues) return;
  ctx.save();
  ctx.fillStyle = color;
  ctx.strokeStyle = color;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
  ctx.lineWidth = text.thickness;

  if ("svgpath" in text) {    
    // TODO: This path must be cached!
    const path = new Path2D(text.svgpath);
    if(text.useTrueTypeFontRendering) {            
      ctx.fill(path);
    } else {
      ctx.stroke(path);
    }
    
    ctx.restore();
    return;
  }

  ctx.translate(...text.pos);
  ctx.translate(text.thickness * 0.5, 0);
  var angle = -text.angle;
  if (text.attr.includes("mirrored")) {
    ctx.scale(-1, 1);
    angle = -angle;
  }
  var tilt = 0;
  if (text.attr.includes("italic")) {
    tilt = 0.125;
  }
  var interline = text.height * 1.5 + text.thickness;
  var txt = text.text.split("\n");
  // KiCad ignores last empty line.
  if (txt[txt.length - 1] == '') txt.pop();
  ctx.rotate(deg2rad(angle));
  var offsety = (1 - text.justify[1]) / 2 * text.height; // One line offset
  offsety -= (txt.length - 1) * (text.justify[1] + 1) / 2 * interline; // Multiline offset
  for (var i in txt) {
    var lineWidth = text.thickness + interline / 2 * tilt;
    for (var j = 0; j < txt[i].length; j++) {
      if (txt[i][j] == '\t') {
        var fourSpaces = 4 * pcbdata.font_data[' '].w * text.width;
        lineWidth += fourSpaces - lineWidth % fourSpaces;
      } else {
        if (txt[i][j] == '~') {
          j++;
          if (j == txt[i].length)
            break;
        }
        lineWidth += pcbdata.font_data[txt[i][j]].w * text.width;
      }
    }
    var offsetx = -lineWidth * (text.justify[0] + 1) / 2;
    var inOverbar = false;
    for (var j = 0; j < txt[i].length; j++) {
      if (txt[i][j] == '\t') {
        var fourSpaces = 4 * pcbdata.font_data[' '].w * text.width;
        offsetx += fourSpaces - offsetx % fourSpaces;
        continue;
      } else if (txt[i][j] == '~') {
        j++;
        if (j == txt[i].length)
          break;
        if (txt[i][j] != '~') {
          inOverbar = !inOverbar;
        }
      }
      var glyph = pcbdata.font_data[txt[i][j]];
      if (inOverbar) {
        var overbarStart = [offsetx, -text.height * 1.4 + offsety];
        var overbarEnd = [offsetx + text.width * glyph.w, overbarStart[1]];

        if (!lastHadOverbar) {
          overbarStart[0] += text.height * 1.4 * tilt;
          lastHadOverbar = true;
        }
        ctx.beginPath();
        ctx.moveTo(...overbarStart);
        ctx.lineTo(...overbarEnd);
        ctx.stroke();
      } else {
        lastHadOverbar = false;
      }
      for (var line of glyph.l) {
        ctx.beginPath();
        ctx.moveTo(...calcFontPoint(line[0], text, offsetx, offsety, tilt));
        for (var k = 1; k < line.length; k++) {
          ctx.lineTo(...calcFontPoint(line[k], text, offsetx, offsety, tilt));
        }
        ctx.stroke();
      }
      offsetx += glyph.w * text.width;
    }
    offsety += interline;
  }
  ctx.restore();
}

function drawedge(ctx, scalefactor, edge, color) {
  ctx.strokeStyle = color;
  ctx.lineWidth = Math.max(1 / scalefactor, edge.width);
  ctx.lineCap = "round";
  if ("svgpath" in edge) {
    ctx.stroke(new Path2D(edge.svgpath));
  } else {
    ctx.beginPath();
    if (edge.type == "segment") {
      ctx.moveTo(...edge.start);
      ctx.lineTo(...edge.end);
    }
    if (edge.type == "rect") {
      ctx.moveTo(...edge.start);
      ctx.lineTo(edge.start[0], edge.end[1]);
      ctx.lineTo(...edge.end);
      ctx.lineTo(edge.end[0], edge.start[1]);
      ctx.lineTo(...edge.start);
    }
    if (edge.type == "arc") {
      ctx.arc(
        ...edge.start,
        edge.radius,
        deg2rad(edge.startangle),
        deg2rad(edge.endangle));
    }
    if (edge.type == "circle") {
      ctx.arc(
        ...edge.start,
        edge.radius,
        0, 2 * Math.PI);
      ctx.closePath();
    }
    if (edge.type == "curve") {
      ctx.moveTo(...edge.start);
      ctx.bezierCurveTo(...edge.cpa, ...edge.cpb, ...edge.end);
    }
    ctx.stroke();
  }
}

function getChamferedRectPath(size, radius, chamfpos, chamfratio) {
  // chamfpos is a bitmask, left = 1, right = 2, bottom left = 4, bottom right = 8
  var path = new Path2D();
  var width = size[0];
  var height = size[1];
  var x = width * -0.5;
  var y = height * -0.5;
  var chamfOffset = Math.min(width, height) * chamfratio;
  path.moveTo(x, 0);
  if (chamfpos & 4) {
    path.lineTo(x, y + height - chamfOffset);
    path.lineTo(x + chamfOffset, y + height);
    path.lineTo(0, y + height);
  } else {
    path.arcTo(x, y + height, x + width, y + height, radius);
  }
  if (chamfpos & 8) {
    path.lineTo(x + width - chamfOffset, y + height);
    path.lineTo(x + width, y + height - chamfOffset);
    path.lineTo(x + width, 0);
  } else {
    path.arcTo(x + width, y + height, x + width, y, radius);
  }
  if (chamfpos & 2) {
    path.lineTo(x + width, y + chamfOffset);
    path.lineTo(x + width - chamfOffset, y);
    path.lineTo(0, y);
  } else {
    path.arcTo(x + width, y, x, y, radius);
  }
  if (chamfpos & 1) {
    path.lineTo(x + chamfOffset, y);
    path.lineTo(x, y + chamfOffset);
    path.lineTo(x, 0);
  } else {
    path.arcTo(x, y, x, y + height, radius);
  }
  path.closePath();
  return path;
}

function getOblongPath(size) {
  return getChamferedRectPath(size, Math.min(size[0], size[1]) / 2, 0, 0);
}

function getPolygonsPath(shape) {
  if (shape.path2d) {
    return shape.path2d;
  }
  if ("svgpath" in shape) {
    shape.path2d = new Path2D(shape.svgpath);
  } else {
    var path = new Path2D();
    for (var polygon of shape.polygons) {
      path.moveTo(...polygon[0]);
      for (var i = 1; i < polygon.length; i++) {
        path.lineTo(...polygon[i]);
      }
      path.closePath();
    }
    shape.path2d = path;
  }
  return shape.path2d;
}

function drawPolygonShape(ctx, shape, color) {
  ctx.save();
  ctx.fillStyle = color;
  if (!("svgpath" in shape)) {
    ctx.translate(...shape.pos);
    ctx.rotate(deg2rad(-shape.angle));
  }
  ctx.fill(getPolygonsPath(shape));
  ctx.restore();
}


function drawPolylineShape(ctx, shape, color) {
  ctx.save();
  ctx.strokeStyle = color;
  ctx.lineWidth = shape.width;
  if (!("svgpath" in shape)) {
    ctx.translate(...shape.pos);
    ctx.rotate(deg2rad(-shape.angle));
  }
  ctx.stroke(getPolygonsPath(shape));
  ctx.restore();
}

function drawDrawing(ctx, scalefactor, drawing, color) {  
  if (["segment", "arc", "circle", "curve"].includes(drawing.type)) {
    drawedge(ctx, scalefactor, drawing, color);
  } else if (drawing.type == "polygon") {
    drawPolygonShape(ctx, drawing, color);
  } else if (drawing.type == "text") {    
    drawText(ctx, drawing, color);
  } else if (drawing.type == "polyline") {    
    drawPolylineShape(ctx, drawing, color);
  }
}

function getCirclePath(radius) {
  var path = new Path2D();
  path.arc(0, 0, radius, 0, 2 * Math.PI);
  path.closePath();
  return path;
}

function getCachedPadPath(pad) {
  if (!pad.path2d) {
    // if path2d is not set, build one and cache it on pad object
    if (pad.shape == "rect") {
      pad.path2d = new Path2D();
      pad.path2d.rect(...pad.size.map(c => -c * 0.5), ...pad.size);
    } else if (pad.shape == "oval") {
      pad.path2d = getOblongPath(pad.size);
    } else if (pad.shape == "circle") {
      pad.path2d = getCirclePath(pad.size[0] / 2);
    } else if (pad.shape == "roundrect") {
      pad.path2d = getChamferedRectPath(pad.size, pad.radius, 0, 0);
    } else if (pad.shape == "chamfrect") {
      pad.path2d = getChamferedRectPath(pad.size, pad.radius, pad.chamfpos, pad.chamfratio)
    } else if (pad.shape == "custom") {
      pad.path2d = getPolygonsPath(pad);
    } else if(pad.shape === "polygon") {      
      pad.path2d = new Path2D();
      if(pad.polygon.length > 1) {
        const pos = {
          x: pad.pos[0],
          y: pad.pos[1]
        };

        pad.path2d.moveTo(pad.polygon[0].x - pos.x, pad.polygon[0].y - pos.y);
        for (var i = 1; i < pad.polygon.length; i++) {
          const point = pad.polygon[i];          
          pad.path2d.lineTo(point.x - pos.x, point.y - pos.y);
        }
        pad.path2d.closePath();              
      }
    }
  }
  return pad.path2d;
}

function drawPad(ctx, pad, color, outline) {
  ctx.save();
  ctx.translate(...pad.pos);
  if(pad.shape !== 'polygon') {
    ctx.rotate(deg2rad(pad.angle));  
  } else {
    ctx.rotate(deg2rad(0));  
  }
  
  if (pad.offset) {
    ctx.translate(...pad.offset);
  }
  ctx.fillStyle = color;
  ctx.strokeStyle = color;
  var path = getCachedPadPath(pad);
  if (outline) {
    ctx.stroke(path);
  } else {
    ctx.fill(path);
  }
  ctx.restore();
}

function drawPadHole(ctx, pad, padHoleColor) {
  if (pad.type != "th") {
    return
  };

  ctx.save();
  ctx.translate(pad.holeCenterPoint.x, pad.holeCenterPoint.y);    
  ctx.rotate(deg2rad(pad.angle));
  ctx.fillStyle = padHoleColor;
  if (pad.drillshape == "oblong") {
    ctx.fill(getOblongPath(pad.drillsize));
  } else {
    ctx.fill(getCirclePath(pad.drillsize[0] / 2));
  }
  ctx.restore();
}

function drawFootprint(ctx, layer, scalefactor, footprint, padColor, padHoleColor, outlineColor, highlight, outline) {
  if (highlight) {
    // draw bounding box
    if (footprint.layer == layer) {
      ctx.save();
      ctx.globalAlpha = 0.2;
      ctx.translate(...footprint.bbox.pos);
      ctx.rotate(deg2rad(-footprint.bbox.angle));
      ctx.translate(...footprint.bbox.relpos);
      ctx.fillStyle = padColor;
      ctx.fillRect(0, 0, ...footprint.bbox.size);
      ctx.globalAlpha = 1;
      ctx.strokeStyle = padColor;
      ctx.strokeRect(0, 0, ...footprint.bbox.size);
      ctx.restore();
    }
  }
  // draw drawings
  for (var drawing of footprint.drawings) {
    if (drawing.layer == layer) {
      drawDrawing(ctx, scalefactor, drawing.drawing, padColor);
    }
  }
  // draw pads
  if (settings.renderPads) {
    for (var pad of footprint.pads) {
      if (pad.layers.includes(layer)) {
        drawPad(ctx, pad, padColor, outline);
        if (pad.pin1 && settings.highlightpin1) {
          drawPad(ctx, pad, outlineColor, true);
        }
      }
    }
    for (var pad of footprint.pads) {
      drawPadHole(ctx, pad, padHoleColor);
    }
  }
}

function drawCrosshair(canvas, x, y, scalefactor, color) {
  if(!settings.showCrosshair) {
    return;
  }

  var ctx = canvas.getContext("2d");

  HTMLFormControlsCollection.log
  
  ctx.save();
  ctx.globalAlpha = 0.75;
  ctx.lineWidth = 2 / scalefactor;
  ctx.strokeStyle = color;

  // TODO: Should calculate a proper bbox for the view port.
  const dummyOffset = 4000;

  // horz line
  ctx.beginPath();
  ctx.moveTo(x - dummyOffset, y);
  ctx.lineTo(x + dummyOffset, y);
  ctx.stroke();

  // vert line
  ctx.beginPath();
  ctx.moveTo(x, y - dummyOffset);
  ctx.lineTo(x, y + dummyOffset);
  ctx.stroke();

  ctx.globalAlpha = 1;
  ctx.restore();
}

function drawEdgeCuts(canvas, scalefactor) {
  var ctx = canvas.getContext("2d");
  var edgecolor = getComputedStyle(topmostdiv).getPropertyValue('--pcb-edge-color');
  for (var edge of pcbdata.edges) {
    drawedge(ctx, scalefactor, edge, edgecolor);
  }
}

function drawOrphanPads(canvas, layer, scalefactor, highlight, highlightedPads) {
  if (!settings.renderPads) {
    return;
  }

  highlightedPads = highlightedPads || [];

  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.lineWidth = 3 / scalefactor;
  var style = getComputedStyle(topmostdiv);
  var padColor = style.getPropertyValue('--pad-color');
  var padHoleColor = style.getPropertyValue('--pad-hole-color');  
  if (highlight) {
    padColor = style.getPropertyValue('--pad-color-highlight');
    outlineColor = style.getPropertyValue('--pin1-outline-color-highlight');
  }

  var i = 0;
  for (var pad of pcbdata.pads) {
    if (pad.layers.includes(layer)) {
      var outline = settings.renderDnpOutline;
      if (!highlight || highlightedPads.includes(i)) {
        drawPad(ctx, pad, padColor, outline); 
      }     
    }

    i++;
  }
  
  for (var pad of pcbdata.pads) {
    drawPadHole(ctx, pad, padHoleColor);
  }  

  ctx.restore();
}

function drawFootprints(canvas, layer, scalefactor, highlight) {
  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.lineWidth = 3 / scalefactor;
  var style = getComputedStyle(topmostdiv);
  var padColor = style.getPropertyValue('--pad-color');
  var padHoleColor = style.getPropertyValue('--pad-hole-color');
  var outlineColor = style.getPropertyValue('--pin1-outline-color');
  if (highlight) {
    padColor = style.getPropertyValue('--pad-color-highlight');
    outlineColor = style.getPropertyValue('--pin1-outline-color-highlight');
  }
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    var mod = pcbdata.footprints[i];
    var outline = settings.renderDnpOutline && pcbdata.bom.skipped.includes(i);
    if (!highlight || highlightedFootprints.includes(i)) {
      drawFootprint(ctx, layer, scalefactor, mod, padColor, padHoleColor, outlineColor, highlight, outline);
    }
  }
  ctx.restore();
}

function drawBgLayer(layername, canvas, layer, scalefactor, edgeColor, polygonColor, textColor) {
  var ctx = canvas.getContext("2d");
  for (var d of pcbdata.drawings[layername][layer]) {
    if (["segment", "arc", "circle", "curve", "rect","polyline"].includes(d.type)) {
      drawedge(ctx, scalefactor, d, edgeColor);
    } else if (d.type == "polygon") {
      drawPolygonShape(ctx, d, polygonColor);
    } else if (d.type == "text") {
      drawText(ctx, d, polygonColor);
    }
  }
}

function drawTracks(canvas, layer, color, highlight) {
  ctx = canvas.getContext("2d");
  ctx.strokeStyle = color;
  ctx.lineCap = "round";
  for(var track of pcbdata.tracks[layer]) {
    if (highlight && highlightedNet != track.net) continue;
    ctx.lineWidth = track.width;

    if(track.type === 'polyline') {
      drawPolylineShape(ctx,track,color);
    } else if(track.type === 'polygon') {
      drawPolygonShape(ctx, track, color);
    } else if(track.type === 'text') {
      drawText(ctx, track, color);
    } else {
      if ('radius' in track) {
        ctx.beginPath();
        ctx.arc(
            ...track.center,
            track.radius,
            deg2rad(track.startangle),
            deg2rad(track.endangle));
        ctx.stroke();
      } else if('start' in track && 'end' in track) {
        ctx.beginPath();
        ctx.moveTo(...track.start);
        ctx.lineTo(...track.end);
        ctx.stroke();
      }
      
    }

  }
}

function drawZones(canvas, layer, color, highlight) {
  ctx = canvas.getContext("2d");
  ctx.save();
  ctx.strokeStyle = color;
  ctx.fillStyle = color;
  ctx.lineJoin = "round";
  for(var zone of pcbdata.zones[layer]) {
    if (!zone.path2d) {
      zone.path2d = getPolygonsPath(zone);
    }
    if (highlight && highlightedNet != zone.net) continue;
    ctx.fill(zone.path2d);
    if (zone.width > 0) {
      ctx.lineWidth = zone.width;
      ctx.stroke(zone.path2d);
    }
  }
  ctx.restore();
}

function clearCanvas(canvas, color = null) {
  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  if (color) {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  } else {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  ctx.restore();
}

function drawNets(canvas, layer, highlight) {
  var style = getComputedStyle(topmostdiv);
  if (settings.renderTracks) {
    var trackColor = style.getPropertyValue(highlight ? '--track-color-highlight' : '--track-color');
    drawTracks(canvas, layer, trackColor, highlight);
  }
  if (settings.renderZones) {
    var zoneColor = style.getPropertyValue(highlight ? '--zone-color-highlight' : '--zone-color');
    drawZones(canvas, layer, zoneColor, highlight);
  }
  if (highlight && settings.renderPads) {
    var padColor = style.getPropertyValue('--pad-color-highlight');
    var padHoleColor = style.getPropertyValue('--pad-hole-color');
    var ctx = canvas.getContext("2d");
    for (var footprint of pcbdata.footprints) {
      // draw pads
      var padDrawn = false;
      for (var pad of footprint.pads) {
        if (highlightedNet != pad.net) continue;
        if (pad.layers.includes(layer)) {
          drawPad(ctx, pad, padColor, false);
          padDrawn = true;
        }
      }
      if (padDrawn) {
        // redraw all pad holes because some pads may overlap
        for (var pad of footprint.pads) {
          drawPadHole(ctx, pad, padHoleColor);
        }
      }
    }
  }
}

function drawHighlightsOnLayer(canvasdict, clear = true) {
  if (clear) {
    clearCanvas(canvasdict.highlight);
  }
  
  if (highlightedFootprints.length > 0) {
    drawFootprints(canvasdict.highlight, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom, true);
  }

  // Draw crosshairs
  if (highlightedFootprints.length > 0) {
    for(var i = 0; i < pcbdata.footprints.length; i++) {
      const footprint = pcbdata.footprints[i];
      if(highlightedFootprints.includes(i) && footprint.layer === canvasdict.layer) {
        drawCrosshair(canvasdict.highlight, footprint.center[0], footprint.center[1], canvasdict.transform.s * canvasdict.transform.zoom, 'red');
      }
    }
  }

  if (highlightedNet !== null) {
    var highlightedPads = [];
    for(var i = 0; i < pcbdata.pads.length; i++) {
      var pad = pcbdata.pads[i];
      if(pad.net === highlightedNet) {
        highlightedPads.push(i);
      }
    }
    
    drawOrphanPads(canvasdict.highlight, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom, true, highlightedPads);

    drawNets(canvasdict.highlight, canvasdict.layer, true);
  }
}

function drawHighlights() {
  drawHighlightsOnLayer(allcanvas.front);
  drawHighlightsOnLayer(allcanvas.back);
}

function drawBackground(canvasdict, clear = true) {
  if (clear) {
    clearCanvas(canvasdict.bg);
    clearCanvas(canvasdict.fab);
    clearCanvas(canvasdict.silk);
  }

  drawNets(canvasdict.bg, canvasdict.layer, false);

  drawOrphanPads(canvasdict.bg, canvasdict.layer, canvasdict.transform.s * canvasdict.transform.zoom, false);

  drawFootprints(canvasdict.bg, canvasdict.layer, canvasdict.transform.s * canvasdict.transform.zoom, false);

  drawEdgeCuts(canvasdict.bg, canvasdict.transform.s);

  var style = getComputedStyle(topmostdiv);
  var edgeColor = style.getPropertyValue('--silkscreen-edge-color');
  var polygonColor = style.getPropertyValue('--silkscreen-polygon-color');
  var textColor = style.getPropertyValue('--silkscreen-text-color');
  if (settings.renderSilkscreen) {
    drawBgLayer(
      "silkscreen", canvasdict.silk, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom,
      edgeColor, polygonColor, textColor);
  }
  edgeColor = style.getPropertyValue('--fabrication-edge-color');
  polygonColor = style.getPropertyValue('--fabrication-polygon-color');
  textColor = style.getPropertyValue('--fabrication-text-color');
  if (settings.renderFabrication) {
    drawBgLayer(
      "fabrication", canvasdict.fab, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom,
      edgeColor, polygonColor, textColor);
  }
}

function prepareCanvas(canvas, flip, transform) {
  var ctx = canvas.getContext("2d");
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  var fontsize = 1.55;
  ctx.scale(transform.zoom, transform.zoom);
  ctx.translate(transform.panx, transform.pany);
  if (flip) {
    ctx.scale(-1, 1);
  }
  ctx.translate(transform.x, transform.y);
  ctx.rotate(deg2rad(settings.boardRotation));
  ctx.scale(transform.s, transform.s);
}

function prepareLayer(canvasdict) {
  var flip = (canvasdict.layer == "B");
  for (var c of ["bg", "fab", "silk", "highlight"]) {
    prepareCanvas(canvasdict[c], flip, canvasdict.transform);
  }
}

function rotateVector(v, angle) {
  angle = deg2rad(angle);
  return [
    v[0] * Math.cos(angle) - v[1] * Math.sin(angle),
    v[0] * Math.sin(angle) + v[1] * Math.cos(angle)
  ];
}

function applyRotation(bbox) {
  var corners = [
    [bbox.minx, bbox.miny],
    [bbox.minx, bbox.maxy],
    [bbox.maxx, bbox.miny],
    [bbox.maxx, bbox.maxy],
  ];
  corners = corners.map((v) => rotateVector(v, settings.boardRotation));
  return {
    minx: corners.reduce((a, v) => Math.min(a, v[0]), Infinity),
    miny: corners.reduce((a, v) => Math.min(a, v[1]), Infinity),
    maxx: corners.reduce((a, v) => Math.max(a, v[0]), -Infinity),
    maxy: corners.reduce((a, v) => Math.max(a, v[1]), -Infinity),
  }
}

function recalcLayerScale(layerdict, width, height) {
  var bbox = applyRotation(pcbdata.edges_bbox);
  var scalefactor = 0.98 * Math.min(
    width / (bbox.maxx - bbox.minx),
    height / (bbox.maxy - bbox.miny)
  );
  if (scalefactor < 0.1) {
    scalefactor = 1;
  }
  layerdict.transform.s = scalefactor;
  var flip = (layerdict.layer == "B");
  if (flip) {
    layerdict.transform.x = -((bbox.maxx + bbox.minx) * scalefactor + width) * 0.5;
  } else {
    layerdict.transform.x = -((bbox.maxx + bbox.minx) * scalefactor - width) * 0.5;
  }
  layerdict.transform.y = -((bbox.maxy + bbox.miny) * scalefactor - height) * 0.5;
  for (var c of ["bg", "fab", "silk", "highlight"]) {
    canvas = layerdict[c];
    canvas.width = width;
    canvas.height = height;
    canvas.style.width = (width / devicePixelRatio) + "px";
    canvas.style.height = (height / devicePixelRatio) + "px";
  }
}

function redrawCanvas(layerdict) {
  prepareLayer(layerdict);
  drawBackground(layerdict);
  drawHighlightsOnLayer(layerdict);
}

function resizeCanvas(layerdict) {
  var canvasdivid = {
    "F": "frontcanvas",
    "B": "backcanvas"
  } [layerdict.layer];
  var width = document.getElementById(canvasdivid).clientWidth * devicePixelRatio;
  var height = document.getElementById(canvasdivid).clientHeight * devicePixelRatio;
  recalcLayerScale(layerdict, width, height);
  redrawCanvas(layerdict);
}

function resizeAll() {
  resizeCanvas(allcanvas.front);
  resizeCanvas(allcanvas.back);
}

function pointWithinDistanceToSegment(x, y, x1, y1, x2, y2, d) {
  var A = x - x1;
  var B = y - y1;
  var C = x2 - x1;
  var D = y2 - y1;

  var dot = A * C + B * D;
  var len_sq = C * C + D * D;
  var dx, dy;
  if (len_sq == 0) {
    // start and end of the segment coincide
    dx = x - x1;
    dy = y - y1;
  } else {
    var param = dot / len_sq;
    var xx, yy;
    if (param < 0) {
      xx = x1;
      yy = y1;
    } else if (param > 1) {
      xx = x2;
      yy = y2;
    } else {
      xx = x1 + param * C;
      yy = y1 + param * D;
    }
    dx = x - xx;
    dy = y - yy;
  }
  return dx * dx + dy * dy <= d * d;
}

function modulo(n, mod) {
  return ((n % mod) + mod ) % mod;
}

function pointWithinDistanceToArc(x, y, xc, yc, radius, startangle, endangle, d) {
  var dx = x - xc;
  var dy = y - yc;
  var r_sq = dx * dx + dy * dy;
  var rmin = Math.max(0, radius-d);
  var rmax = radius + d;

  if (r_sq < rmin * rmin || r_sq > rmax * rmax)
    return false;

  var angle1 = modulo(deg2rad(startangle), 2 * Math.PI);
  var dx1 = xc + radius * Math.cos(angle1) - x;
  var dy1 = yc + radius * Math.sin(angle1) - y;
  if (dx1 * dx1 + dy1 * dy1 <= d * d)
    return true;

  var angle2 = modulo(deg2rad(endangle), 2 * Math.PI);
  var dx2 = xc + radius * Math.cos(angle2) - x;
  var dy2 = yc + radius * Math.sin(angle2) - y;
  if (dx2 * dx2 + dy2 * dy2 <= d * d)
    return true;

  var angle = modulo(Math.atan2(dy, dx), 2 * Math.PI);
  if (angle1 > angle2)
    return (angle >= angle2 || angle <= angle1);
  else
    return (angle >= angle1 && angle <= angle2);
}

function pointWithinPad(x, y, pad) {
  var v = [x - pad.pos[0], y - pad.pos[1]];
  v = rotateVector(v, -pad.angle);
  if (pad.offset) {
    v[0] -= pad.offset[0];
    v[1] -= pad.offset[1];
  }
  return emptyContext2d.isPointInPath(getCachedPadPath(pad), ...v);
}

function netHitScan(layer, x, y) {
  // TODO: Should be refactored

  // Check track segments
  if (settings.renderTracks && pcbdata.tracks) {
    for(var track of pcbdata.tracks[layer]) {
      if(track.type === 'polyline') {
        const path = getPolygonsPath(track);
        if(path) {
          hitTestContext2d.save();
          hitTestContext2d.lineWidth = track.width;
          
          if(hitTestContext2d.isPointInStroke(path,x,y)) {
            hitTestContext2d.restore();
            return track.net;            
          }
          
          hitTestContext2d.restore();          
        }        

      } else if(track.type === 'polygon') {
        const path = getPolygonsPath(track);
        if(path && hitTestContext2d.isPointInPath(path,x,y)) {          
          return track.net;                      
        }                     
      } else if(track.type === 'text') {
        // TODO: To implement taking in account TrueType fonts.
      } else if ('radius' in track) {
        if (pointWithinDistanceToArc(x, y, ...track.center, track.radius, track.startangle, track.endangle, track.width / 2)) {
          return track.net;
        }
      } else if('start' in track && 'end' in track) {
        if (pointWithinDistanceToSegment(x, y, ...track.start, ...track.end, track.width / 2)) {
          return track.net;
        }
      }
    }
  }
  // Check pads
  if (settings.renderPads) {

    // Footprints containing pads
    for (var footprint of pcbdata.footprints) {
      for(var pad of footprint.pads) {
        if (pad.layers.includes(layer) && pointWithinPad(x, y, pad)) {
          return pad.net;
        }
      }
    }

    // Orphan pads
    for(var pad of pcbdata.pads) {
      if (pad.layers.includes(layer) && pointWithinPad(x, y, pad)) {
        return pad.net;
      }
    }
  }
  return null;
}

function pointWithinFootprintBbox(x, y, bbox) {
  var v = [x - bbox.pos[0], y - bbox.pos[1]];
  v = rotateVector(v, bbox.angle);
  return bbox.relpos[0] <= v[0] && v[0] <= bbox.relpos[0] + bbox.size[0] &&
         bbox.relpos[1] <= v[1] && v[1] <= bbox.relpos[1] + bbox.size[1];
}

function bboxHitScan(layer, x, y) {
  var result = [];
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    var footprint = pcbdata.footprints[i];
    if (footprint.layer == layer) {
      if (pointWithinFootprintBbox(x, y, footprint.bbox)) {
        result.push(i);
      }
    }
  }
  return result;
}

function handlePointerDown(e, layerdict) {
  if (e.button != 0 && e.button != 1) {
    return;
  }
  e.preventDefault();
  e.stopPropagation();

  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  layerdict.pointerStates[e.pointerId] = {
    distanceTravelled: 0,
    lastX: e.offsetX,
    lastY: e.offsetY,
    downTime: Date.now(),
  };
}

function handleMouseClick(e, layerdict) {
  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  var x = e.offsetX;
  var y = e.offsetY;
  var t = layerdict.transform;
  if (layerdict.layer == "B") {
    x = (devicePixelRatio * x / t.zoom - t.panx + t.x) / -t.s;
  } else {
    x = (devicePixelRatio * x / t.zoom - t.panx - t.x) / t.s;
  }
  y = (devicePixelRatio * y / t.zoom - t.y - t.pany) / t.s;
  var v = rotateVector([x, y], -settings.boardRotation);
  if ("nets" in pcbdata) {
    var net = netHitScan(layerdict.layer, ...v);
    if (net !== highlightedNet) {
      netClicked(net);
    }
  }
  if (highlightedNet === null) {
    var footprints = bboxHitScan(layerdict.layer, ...v);
    if (footprints.length > 0) {
      footprintsClicked(footprints);
    }
  }
}

function handlePointerLeave(e, layerdict) {
  e.preventDefault();
  e.stopPropagation();

  if (!settings.redrawOnDrag) {
    redrawCanvas(layerdict);
  }

  delete layerdict.pointerStates[e.pointerId];
}

function resetTransform(layerdict) {
  layerdict.transform.panx = 0;
  layerdict.transform.pany = 0;
  layerdict.transform.zoom = 1;
  redrawCanvas(layerdict);
}

function handlePointerUp(e, layerdict) {
  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  e.preventDefault();
  e.stopPropagation();

  if (e.button == 2) {
    // Reset pan and zoom on right click.
    resetTransform(layerdict);
    layerdict.anotherPointerTapped = false;
    return;
  }

  // We haven't necessarily had a pointermove event since the interaction started, so make sure we update this now
  var ptr = layerdict.pointerStates[e.pointerId];
  ptr.distanceTravelled += Math.abs(e.offsetX - ptr.lastX) + Math.abs(e.offsetY - ptr.lastY);

  if (e.button == 0 && ptr.distanceTravelled < 10 && Date.now() - ptr.downTime <= 500) {
    if (Object.keys(layerdict.pointerStates).length == 1) {
      if (layerdict.anotherPointerTapped) {
        // This is the second pointer coming off of a two-finger tap
        resetTransform(layerdict);
      } else {
        // This is just a regular tap
        handleMouseClick(e, layerdict);
      }
      layerdict.anotherPointerTapped = false;
    } else {
      // This is the first finger coming off of what could become a two-finger tap
      layerdict.anotherPointerTapped = true;
    }
  } else {
    if (!settings.redrawOnDrag) {
      redrawCanvas(layerdict);
    }
    layerdict.anotherPointerTapped = false;
  }

  delete layerdict.pointerStates[e.pointerId];
}

function handlePointerMove(e, layerdict) {
  if (!layerdict.pointerStates.hasOwnProperty(e.pointerId)) {
    return;
  }
  e.preventDefault();
  e.stopPropagation();

  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  var thisPtr = layerdict.pointerStates[e.pointerId];

  var dx = e.offsetX - thisPtr.lastX;
  var dy = e.offsetY - thisPtr.lastY;

  // If this number is low on pointer up, we count the action as a click
  thisPtr.distanceTravelled += Math.abs(dx) + Math.abs(dy);

  if (Object.keys(layerdict.pointerStates).length == 1) {
    // This is a simple drag
    layerdict.transform.panx += devicePixelRatio * dx / layerdict.transform.zoom;
    layerdict.transform.pany += devicePixelRatio * dy / layerdict.transform.zoom;
  } else if (Object.keys(layerdict.pointerStates).length == 2) {
    var otherPtr = Object.values(layerdict.pointerStates).filter((ptr) => ptr != thisPtr)[0];

    var oldDist = Math.sqrt(Math.pow(thisPtr.lastX - otherPtr.lastX, 2) + Math.pow(thisPtr.lastY - otherPtr.lastY, 2));
    var newDist = Math.sqrt(Math.pow(e.offsetX - otherPtr.lastX, 2)     + Math.pow(e.offsetY - otherPtr.lastY, 2));

    var scaleFactor = newDist/oldDist;

    if (scaleFactor != NaN) {
      layerdict.transform.zoom *= scaleFactor;

      var zoomd = (1 - scaleFactor) / layerdict.transform.zoom;
      layerdict.transform.panx += devicePixelRatio * otherPtr.lastX * zoomd;
      layerdict.transform.pany += devicePixelRatio * otherPtr.lastY * zoomd;
    }
  }

  thisPtr.lastX = e.offsetX;
  thisPtr.lastY = e.offsetY;

  if (settings.redrawOnDrag) {
    redrawCanvas(layerdict);
  }
}

function handleMouseWheel(e, layerdict) {
  e.preventDefault();
  e.stopPropagation();
  var t = layerdict.transform;
  var wheeldelta = e.deltaY;
  if (e.deltaMode == 1) {
    // FF only, scroll by lines
    wheeldelta *= 30;
  } else if (e.deltaMode == 2) {
    wheeldelta *= 300;
  }
  var m = Math.pow(1.1, -wheeldelta / 40);
  // Limit amount of zoom per tick.
  if (m > 2) {
    m = 2;
  } else if (m < 0.5) {
    m = 0.5;
  }
  t.zoom *= m;
  var zoomd = (1 - m) / t.zoom;
  t.panx += devicePixelRatio * e.offsetX * zoomd;
  t.pany += devicePixelRatio * e.offsetY * zoomd;
  redrawCanvas(layerdict);
}

function addMouseHandlers(div, layerdict) {
  div.addEventListener("pointerdown", function(e) {
    handlePointerDown(e, layerdict);
  });
  div.addEventListener("pointermove", function(e) {
    handlePointerMove(e, layerdict);
  });
  div.addEventListener("pointerup", function(e) {
    handlePointerUp(e, layerdict);
  });
  var pointerleave = function(e) {
    handlePointerLeave(e, layerdict);
  }
  div.addEventListener("pointercancel", pointerleave);
  div.addEventListener("pointerleave", pointerleave);
  div.addEventListener("pointerout", pointerleave);

  div.onwheel = function(e) {
    handleMouseWheel(e, layerdict);
  }
  for (var element of [div, layerdict.bg, layerdict.fab, layerdict.silk, layerdict.highlight]) {
    element.addEventListener("contextmenu", function(e) {
      e.preventDefault();
    }, false);
  }
}

function setRedrawOnDrag(value) {
  settings.redrawOnDrag = value;
  writeStorage("redrawOnDrag", value);
}

function setShowCrosshair(value) {
  settings.showCrosshair = value;
  writeStorage("showCrosshair", value);
}

function setBoardRotation(value) {
  settings.boardRotation = value * 5;
  writeStorage("boardRotation", settings.boardRotation);
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
  resizeAll();
}

function initRender() {
  allcanvas = {
    front: {
      transform: {
        x: 0,
        y: 0,
        s: 1,
        panx: 0,
        pany: 0,
        zoom: 1,
      },
      pointerStates: {},
      anotherPointerTapped: false,
      bg: document.getElementById("F_bg"),
      fab: document.getElementById("F_fab"),
      silk: document.getElementById("F_slk"),
      highlight: document.getElementById("F_hl"),
      layer: "F",
    },
    back: {
      transform: {
        x: 0,
        y: 0,
        s: 1,
        panx: 0,
        pany: 0,
        zoom: 1,
      },
      pointerStates: {},
      anotherPointerTapped: false,
      bg: document.getElementById("B_bg"),
      fab: document.getElementById("B_fab"),
      silk: document.getElementById("B_slk"),
      highlight: document.getElementById("B_hl"),
      layer: "B",
    }
  };
  addMouseHandlers(document.getElementById("frontcanvas"), allcanvas.front);
  addMouseHandlers(document.getElementById("backcanvas"), allcanvas.back);
}

///////////////////////////////////////////////

///////////////////////////////////////////////
/* DOM manipulation and misc code */

var bomsplit;
var canvassplit;
var initDone = false;
var bomSortFunction = null;
var currentSortColumn = null;
var currentSortOrder = null;
var currentHighlightedRowId;
var highlightHandlers = [];
var footprintIndexToHandler = {};
var netsToHandler = {};
var highlightedFootprints = [];
var highlightedOrphanPads = [];
var highlightedNet = null;
var lastClicked;

function dbg(html) {
  dbgdiv.innerHTML = html;
}

function redrawIfInitDone() {
  if (initDone) {
    redrawCanvas(allcanvas.front);
    redrawCanvas(allcanvas.back);
  }
}

function padsVisible(value) {
  writeStorage("padsVisible", value);
  settings.renderPads = value;
  redrawIfInitDone();
}

function referencesVisible(value) {
  writeStorage("referencesVisible", value);
  settings.renderReferences = value;
  redrawIfInitDone();
}

function valuesVisible(value) {
  writeStorage("valuesVisible", value);
  settings.renderValues = value;
  redrawIfInitDone();
}

function tracksVisible(value) {
  writeStorage("tracksVisible", value);
  settings.renderTracks = value;
  redrawIfInitDone();
}

function zonesVisible(value) {
  writeStorage("zonesVisible", value);
  settings.renderZones = value;
  redrawIfInitDone();
}

function dnpOutline(value) {
  writeStorage("dnpOutline", value);
  settings.renderDnpOutline = value;
  redrawIfInitDone();
}

function setDarkMode(value) {
  if (value) {
    topmostdiv.classList.add("dark");
  } else {
    topmostdiv.classList.remove("dark");
  }
  writeStorage("darkmode", value);
  settings.darkMode = value;
  redrawIfInitDone();
}

function setFullscreen(value) {
  if (value) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

function fabricationVisible(value) {
  writeStorage("fabricationVisible", value);
  settings.renderFabrication = value;
  redrawIfInitDone();
}

function silkscreenVisible(value) {
  writeStorage("silkscreenVisible", value);
  settings.renderSilkscreen = value;
  redrawIfInitDone();
}

function setHighlightPin1(value) {
  writeStorage("highlightpin1", value);
  settings.highlightpin1 = value;
  redrawIfInitDone();
}

function getStoredCheckboxRefs(checkbox) {
  function convert(ref) {
    var intref = parseInt(ref);
    if (isNaN(intref)) {
      for (var i = 0; i < pcbdata.footprints.length; i++) {
        if (pcbdata.footprints[i].ref == ref) {
          return i;
        }
      }
      return -1;
    } else {
      return intref;
    }
  }
  if (!(checkbox in settings.checkboxStoredRefs)) {
    var val = readStorage("checkbox_" + checkbox);
    settings.checkboxStoredRefs[checkbox] = val ? val : "";
  }
  if (!settings.checkboxStoredRefs[checkbox]) {
    return new Set();
  } else {
    return new Set(settings.checkboxStoredRefs[checkbox].split(",").map(r => convert(r)).filter(a => a >= 0));
  }
}

function getCheckboxState(checkbox, references) {
  var storedRefsSet = getStoredCheckboxRefs(checkbox);
  var currentRefsSet = new Set(references.map(r => r[1]));
  // Get difference of current - stored
  var difference = new Set(currentRefsSet);
  for (ref of storedRefsSet) {
    difference.delete(ref);
  }
  if (difference.size == 0) {
    // All the current refs are stored
    return "checked";
  } else if (difference.size == currentRefsSet.size) {
    // None of the current refs are stored
    return "unchecked";
  } else {
    // Some of the refs are stored
    return "indeterminate";
  }
}

function setBomCheckboxState(checkbox, element, references) {
  var state = getCheckboxState(checkbox, references);
  element.checked = (state == "checked");
  element.indeterminate = (state == "indeterminate");
}

function createCheckboxChangeHandler(checkbox, references, row) {
  return function() {
    refsSet = getStoredCheckboxRefs(checkbox);
    var darkenWhenChecked = settings.darkenWhenChecked == checkbox;
    eventArgs = {
      checkbox: checkbox,
      refs: references,
    }
    if (this.checked) {
      // checkbox ticked
      for (var ref of references) {
        refsSet.add(ref[1]);
      }
      if (darkenWhenChecked) {
        row.classList.add("checked");
      }
      eventArgs.state = 'checked';
    } else {
      // checkbox unticked
      for (var ref of references) {
        refsSet.delete(ref[1]);
      }
      if (darkenWhenChecked) {
        row.classList.remove("checked");
      }
      eventArgs.state = 'unchecked';
    }
    settings.checkboxStoredRefs[checkbox] = [...refsSet].join(",");
    writeStorage("checkbox_" + checkbox, settings.checkboxStoredRefs[checkbox]);
    updateCheckboxStats(checkbox);
    EventHandler.emitEvent(IBOM_EVENT_TYPES.CHECKBOX_CHANGE_EVENT, eventArgs);
  }
}

function clearHighlightedFootprints() {
  if (currentHighlightedRowId) {
    document.getElementById(currentHighlightedRowId).classList.remove("highlighted");
    currentHighlightedRowId = null;
    highlightedFootprints = [];  
    highlightedOrphanPads = [];  
    highlightedNet = null;
  }
}

function createRowHighlightHandler(rowid, refs, net) {
  return function() {
    if (currentHighlightedRowId) {
      if (currentHighlightedRowId == rowid) {
        return;
      }
      document.getElementById(currentHighlightedRowId).classList.remove("highlighted");
    }
    document.getElementById(rowid).classList.add("highlighted");
    currentHighlightedRowId = rowid;
    highlightedFootprints = refs ? refs.map(r => r[1]) : [];
    highlightedNet = net;
    drawHighlights();
    EventHandler.emitEvent(
      IBOM_EVENT_TYPES.HIGHLIGHT_EVENT,
      {
        rowid: rowid,
        refs: refs,
        net: net
      });
  }
}

function entryMatches(entry) {
  if (settings.bommode == "netlist") {
    // entry is just a net name
    return entry.toLowerCase().indexOf(filter) >= 0;
  }
  // check refs
  for (var ref of entry[3]) {
    if (ref[0].toLowerCase().indexOf(filter) >= 0) {
      return true;
    }
  }
  // check extra fields
  for (var i in config.extra_fields) {
    if (entry[4][i].toLowerCase().indexOf(filter) >= 0) {
      return true;
    }
  }
  // check value
  if (entry[1].toLowerCase().indexOf(filter) >= 0) {
    return true;
  }
  // check footprint
  if (entry[2].toLowerCase().indexOf(filter) >= 0) {
    return true;
  }
  return false;
}

function findRefInEntry(entry) {
  return entry[3].filter(r => r[0].toLowerCase() == reflookup);
}

function highlightFilter(s) {
  if (!filter) {
    return s;
  }
  var parts = s.toLowerCase().split(filter);
  if (parts.length == 1) {
    return s;
  }
  var r = "";
  var pos = 0;
  for (var i in parts) {
    if (i > 0) {
      r += '<mark class="highlight">' +
        s.substring(pos, pos + filter.length) +
        '</mark>';
      pos += filter.length;
    }
    r += s.substring(pos, pos + parts[i].length);
    pos += parts[i].length;
  }
  return r;
}

function checkboxSetUnsetAllHandler(checkboxname) {
  return function() {
    var checkboxnum = 0;
    while (checkboxnum < settings.checkboxes.length &&
      settings.checkboxes[checkboxnum].toLowerCase() != checkboxname.toLowerCase()) {
      checkboxnum++;
    }
    if (checkboxnum >= settings.checkboxes.length) {
      return;
    }
    var allset = true;
    var checkbox;
    var row;
    for (row of bombody.childNodes) {
      checkbox = row.childNodes[checkboxnum + 1].childNodes[0];
      if (!checkbox.checked || checkbox.indeterminate) {
        allset = false;
        break;
      }
    }
    for (row of bombody.childNodes) {
      checkbox = row.childNodes[checkboxnum + 1].childNodes[0];
      checkbox.checked = !allset;
      checkbox.indeterminate = false;
      checkbox.onchange();
    }
  }
}

function createColumnHeader(name, cls, comparator) {
  var th = document.createElement("TH");
  th.innerHTML = name;
  th.classList.add(cls);
  th.style.cursor = "pointer";
  var span = document.createElement("SPAN");
  span.classList.add("sortmark");
  span.classList.add("none");
  th.appendChild(span);
  th.onclick = function() {
    if (currentSortColumn && this !== currentSortColumn) {
      // Currently sorted by another column
      currentSortColumn.childNodes[1].classList.remove(currentSortOrder);
      currentSortColumn.childNodes[1].classList.add("none");
      currentSortColumn = null;
      currentSortOrder = null;
    }
    if (currentSortColumn && this === currentSortColumn) {
      // Already sorted by this column
      if (currentSortOrder == "asc") {
        // Sort by this column, descending order
        bomSortFunction = function(a, b) {
          return -comparator(a, b);
        }
        currentSortColumn.childNodes[1].classList.remove("asc");
        currentSortColumn.childNodes[1].classList.add("desc");
        currentSortOrder = "desc";
      } else {
        // Unsort
        bomSortFunction = null;
        currentSortColumn.childNodes[1].classList.remove("desc");
        currentSortColumn.childNodes[1].classList.add("none");
        currentSortColumn = null;
        currentSortOrder = null;
      }
    } else {
      // Sort by this column, ascending order
      bomSortFunction = comparator;
      currentSortColumn = this;
      currentSortColumn.childNodes[1].classList.remove("none");
      currentSortColumn.childNodes[1].classList.add("asc");
      currentSortOrder = "asc";
    }
    populateBomBody();
  }
  return th;
}

function populateBomHeader() {
  while (bomhead.firstChild) {
    bomhead.removeChild(bomhead.firstChild);
  }
  var tr = document.createElement("TR");
  var th = document.createElement("TH");
  th.classList.add("numCol");
  tr.appendChild(th);
  var checkboxCompareClosure = function(checkbox) {
    return (a, b) => {
      var stateA = getCheckboxState(checkbox, a[3]);
      var stateB = getCheckboxState(checkbox, b[3]);
      if (stateA > stateB) return -1;
      if (stateA < stateB) return 1;
      return 0;
    }
  }
  if (settings.bommode == "netlist") {
    th = createColumnHeader("Net name", "bom-netname", (a, b) => {
      if (a > b) return -1;
      if (a < b) return 1;
      return 0;
    });
    tr.appendChild(th);
  } else {
    for (var checkbox of settings.checkboxes) {
      th = createColumnHeader(
        checkbox, "bom-checkbox", checkboxCompareClosure(checkbox));
      th.onclick = fancyDblClickHandler(
        th, th.onclick.bind(th), checkboxSetUnsetAllHandler(checkbox));
      tr.appendChild(th);
    }
    tr.appendChild(createColumnHeader("References", "References", (a, b) => {
      var i = 0;
      while (i < a[3].length && i < b[3].length) {
        if (a[3][i] != b[3][i]) return a[3][i] > b[3][i] ? 1 : -1;
        i++;
      }
      return a[3].length - b[3].length;
    }));
    // Extra fields
    if (config.extra_fields.length > 0) {
      var extraFieldCompareClosure = function(fieldIndex) {
        return (a, b) => {
          var fa = a[4][fieldIndex];
          var fb = b[4][fieldIndex];
          if (fa != fb) return fa > fb ? 1 : -1;
          else return 0;
        }
      }
      for (var i in config.extra_fields) {
        tr.appendChild(createColumnHeader(
          config.extra_fields[i], "extra", extraFieldCompareClosure(i)));
      }
    }
    tr.appendChild(createColumnHeader("Value", "Value", (a, b) => {
      return valueCompare(a[5], b[5], a[1], b[1]);
    }));
    tr.appendChild(createColumnHeader("Footprint", "Footprint", (a, b) => {
      if (a[2] != b[2]) return a[2] > b[2] ? 1 : -1;
      else return 0;
    }));
    if (settings.bommode == "grouped") {
      tr.appendChild(createColumnHeader("Quantity", "Quantity", (a, b) => {
        return a[3].length - b[3].length;
      }));
    }
  }
  bomhead.appendChild(tr);
}

function populateBomBody() {
  while (bom.firstChild) {
    bom.removeChild(bom.firstChild);
  }
  highlightHandlers = [];
  footprintIndexToHandler = {};
  netsToHandler = {};
  currentHighlightedRowId = null;
  var first = true;
  if (settings.bommode == "netlist") {
    bomtable = pcbdata.nets.slice();
  } else {
    switch (settings.canvaslayout) {
      case 'F':
        bomtable = pcbdata.bom.F.slice();
        break;
      case 'FB':
        bomtable = pcbdata.bom.both.slice();
        break;
      case 'B':
        bomtable = pcbdata.bom.B.slice();
        break;
    }
    if (settings.bommode == "ungrouped") {
      // expand bom table
      expandedTable = []
      for (var bomentry of bomtable) {
        for (var ref of bomentry[3]) {
          expandedTable.push([1, bomentry[1], bomentry[2], [ref], bomentry[4], bomentry[5]]);
        }
      }
      bomtable = expandedTable;
    }
  }
  if (bomSortFunction) {
    bomtable = bomtable.sort(bomSortFunction);
  }
  for (var i in bomtable) {
    var bomentry = bomtable[i];
    if (filter && !entryMatches(bomentry)) {
      continue;
    }
    var references = null;
    var netname = null;
    var tr = document.createElement("TR");
    var td = document.createElement("TD");
    var rownum = +i + 1;
    tr.id = "bomrow" + rownum;
    td.textContent = rownum;
    tr.appendChild(td);
    if (settings.bommode == "netlist") {
      netname = bomentry;
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(netname ? netname : "&lt;no net&gt;");
      tr.appendChild(td);
    } else {
      if (reflookup) {
        references = findRefInEntry(bomentry);
        if (references.length == 0) {
          continue;
        }
      } else {
        references = bomentry[3];
      }
      // Checkboxes
      for (var checkbox of settings.checkboxes) {
        if (checkbox) {
          td = document.createElement("TD");
          var input = document.createElement("input");
          input.type = "checkbox";
          input.onchange = createCheckboxChangeHandler(checkbox, references, tr);
          setBomCheckboxState(checkbox, input, references);
          if (input.checked && settings.darkenWhenChecked == checkbox) {
            tr.classList.add("checked");
          }
          td.appendChild(input);
          tr.appendChild(td);
        }
      }
      // References
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(references.map(r => r[0]).join(", "));
      tr.appendChild(td);
      // Extra fields
      for (var i in config.extra_fields) {
        td = document.createElement("TD");
        td.innerHTML = highlightFilter(bomentry[4][i]);
        tr.appendChild(td);
      }
      // Value
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(bomentry[1]);
      tr.appendChild(td);
      // Footprint
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(bomentry[2]);
      tr.appendChild(td);
      if (settings.bommode == "grouped") {
        // Quantity
        td = document.createElement("TD");
        td.textContent = bomentry[3].length;
        tr.appendChild(td);
      }
    }
    bom.appendChild(tr);
    var handler = createRowHighlightHandler(tr.id, references, netname);
    tr.onmousemove = handler;
    highlightHandlers.push({
      id: tr.id,
      handler: handler,
    });
    if (references !== null) {
      for (var refIndex of references.map(r => r[1])) {
        footprintIndexToHandler[refIndex] = handler;
      }
    }
    if (netname !== null) {
      netsToHandler[netname] = handler;
    }
    if ((filter || reflookup) && first) {
      handler();
      first = false;
    }
  }
  EventHandler.emitEvent(
    IBOM_EVENT_TYPES.BOM_BODY_CHANGE_EVENT,
    {
      filter: filter,
      reflookup: reflookup,
      checkboxes: settings.checkboxes,
      bommode: settings.bommode,
    });
}

function highlightPreviousRow() {
  if (!currentHighlightedRowId) {
    highlightHandlers[highlightHandlers.length - 1].handler();
  } else {
    if (highlightHandlers.length > 1 &&
      highlightHandlers[0].id == currentHighlightedRowId) {
      highlightHandlers[highlightHandlers.length - 1].handler();
    } else {
      for (var i = 0; i < highlightHandlers.length - 1; i++) {
        if (highlightHandlers[i + 1].id == currentHighlightedRowId) {
          highlightHandlers[i].handler();
          break;
        }
      }
    }
  }
  smoothScrollToRow(currentHighlightedRowId);
}

function highlightNextRow() {
  if (!currentHighlightedRowId) {
    highlightHandlers[0].handler();
  } else {
    if (highlightHandlers.length > 1 &&
      highlightHandlers[highlightHandlers.length - 1].id == currentHighlightedRowId) {
      highlightHandlers[0].handler();
    } else {
      for (var i = 1; i < highlightHandlers.length; i++) {
        if (highlightHandlers[i - 1].id == currentHighlightedRowId) {
          highlightHandlers[i].handler();
          break;
        }
      }
    }
  }
  smoothScrollToRow(currentHighlightedRowId);
}

function populateBomTable() {
  populateBomHeader();
  populateBomBody();
}

function footprintsClicked(footprintIndexes) {
  var lastClickedIndex = footprintIndexes.indexOf(lastClicked);
  for (var i = 1; i <= footprintIndexes.length; i++) {
    var refIndex = footprintIndexes[(lastClickedIndex + i) % footprintIndexes.length];
    if (refIndex in footprintIndexToHandler) {
      lastClicked = refIndex;
      footprintIndexToHandler[refIndex]();
      smoothScrollToRow(currentHighlightedRowId);
      break;
    }
  }
}

function netClicked(net) {
  if (net in netsToHandler) {
    netsToHandler[net]();
    smoothScrollToRow(currentHighlightedRowId);
  } else {
    clearHighlightedFootprints();
    highlightedNet = net;
    drawHighlights();
  }
}

function updateFilter(input) {
  filter = input.toLowerCase();
  populateBomTable();
}

function updateRefLookup(input) {
  reflookup = input.toLowerCase();
  populateBomTable();
}

function changeCanvasLayout(layout) {
  document.getElementById("fl-btn").classList.remove("depressed");
  document.getElementById("fb-btn").classList.remove("depressed");
  document.getElementById("bl-btn").classList.remove("depressed");
  switch (layout) {
    case 'F':
      document.getElementById("fl-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.collapse(1);
      }
      break;
    case 'B':
      document.getElementById("bl-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.collapse(0);
      }
      break;
    default:
      document.getElementById("fb-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.setSizes([50, 50]);
      }
  }
  settings.canvaslayout = layout;
  writeStorage("canvaslayout", layout);
  resizeAll();
  changeBomMode(settings.bommode);
}

function populateMetadata() {
  document.getElementById("title").innerHTML = pcbdata.metadata.title;
  document.getElementById("revision").innerHTML = "Rev: " + pcbdata.metadata.revision;
  document.getElementById("company").innerHTML = pcbdata.metadata.company;
  document.getElementById("filedate").innerHTML = pcbdata.metadata.date;
  if (pcbdata.metadata.title != "") {
    document.title = pcbdata.metadata.title + " BOM";
  }
  // Calculate board stats
  var fp_f = 0, fp_b = 0, pads_f = 0, pads_b = 0, pads_th = 0;
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    if (pcbdata.bom.skipped.includes(i)) continue;
    var mod = pcbdata.footprints[i];
    if (mod.layer == "F") {
      fp_f++;
    } else {
      fp_b++;
    }
    for (var pad of mod.pads) {
      if (pad.type == "th") {
        pads_th++;
      } else {
        if (pad.layers.includes("F")) {
          pads_f++;
        }
        if (pad.layers.includes("B")) {
          pads_b++;
        }
      }
    }
  }
  document.getElementById("stats-components-front").innerHTML = fp_f;
  document.getElementById("stats-components-back").innerHTML = fp_b;
  document.getElementById("stats-components-total").innerHTML = fp_f + fp_b;
  document.getElementById("stats-groups-front").innerHTML = pcbdata.bom.F.length;
  document.getElementById("stats-groups-back").innerHTML = pcbdata.bom.B.length;
  document.getElementById("stats-groups-total").innerHTML = pcbdata.bom.both.length;
  document.getElementById("stats-smd-pads-front").innerHTML = pads_f;
  document.getElementById("stats-smd-pads-back").innerHTML = pads_b;
  document.getElementById("stats-smd-pads-total").innerHTML = pads_f + pads_b;
  document.getElementById("stats-th-pads").innerHTML = pads_th;
  // Update version string
  document.getElementById("github-link").innerHTML = "InteractiveHtmlBom&nbsp;" +
    /^v\d+\.\d+/.exec(pcbdata.ibom_version)[0];
}

function changeBomLayout(layout) {
  document.getElementById("bom-btn").classList.remove("depressed");
  document.getElementById("lr-btn").classList.remove("depressed");
  document.getElementById("tb-btn").classList.remove("depressed");
  switch (layout) {
    case 'bom-only':
      document.getElementById("bom-btn").classList.add("depressed");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      document.getElementById("frontcanvas").style.display = "none";
      document.getElementById("backcanvas").style.display = "none";
      document.getElementById("bot").style.height = "";
      break;
    case 'top-bottom':
      document.getElementById("tb-btn").classList.add("depressed");
      document.getElementById("frontcanvas").style.display = "";
      document.getElementById("backcanvas").style.display = "";
      document.getElementById("bot").style.height = "calc(100% - 80px)";
      document.getElementById("bomdiv").classList.remove("split-horizontal");
      document.getElementById("canvasdiv").classList.remove("split-horizontal");
      document.getElementById("frontcanvas").classList.add("split-horizontal");
      document.getElementById("backcanvas").classList.add("split-horizontal");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      bomsplit = Split(['#bomdiv', '#canvasdiv'], {
        sizes: [50, 50],
        onDragEnd: resizeAll,
        direction: "vertical",
        gutterSize: 5
      });
      canvassplit = Split(['#frontcanvas', '#backcanvas'], {
        sizes: [50, 50],
        gutterSize: 5,
        onDragEnd: resizeAll
      });
      break;
    case 'left-right':
      document.getElementById("lr-btn").classList.add("depressed");
      document.getElementById("frontcanvas").style.display = "";
      document.getElementById("backcanvas").style.display = "";
      document.getElementById("bot").style.height = "calc(100% - 80px)";
      document.getElementById("bomdiv").classList.add("split-horizontal");
      document.getElementById("canvasdiv").classList.add("split-horizontal");
      document.getElementById("frontcanvas").classList.remove("split-horizontal");
      document.getElementById("backcanvas").classList.remove("split-horizontal");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      bomsplit = Split(['#bomdiv', '#canvasdiv'], {
        sizes: [50, 50],
        onDragEnd: resizeAll,
        gutterSize: 5
      });
      canvassplit = Split(['#frontcanvas', '#backcanvas'], {
        sizes: [50, 50],
        gutterSize: 5,
        direction: "vertical",
        onDragEnd: resizeAll
      });
  }
  settings.bomlayout = layout;
  writeStorage("bomlayout", layout);
  changeCanvasLayout(settings.canvaslayout);
}

function changeBomMode(mode) {
  document.getElementById("bom-grouped-btn").classList.remove("depressed");
  document.getElementById("bom-ungrouped-btn").classList.remove("depressed");
  document.getElementById("bom-netlist-btn").classList.remove("depressed");
  switch (mode) {
    case 'grouped':
      document.getElementById("bom-grouped-btn").classList.add("depressed");
      break;
    case 'ungrouped':
      document.getElementById("bom-ungrouped-btn").classList.add("depressed");
      break;
    case 'netlist':
      document.getElementById("bom-netlist-btn").classList.add("depressed");
  }
  writeStorage("bommode", mode);
  if (mode != settings.bommode) {
    settings.bommode = mode;
    bomSortFunction = null;
    currentSortColumn = null;
    currentSortOrder = null;
    clearHighlightedFootprints();
  }
  populateBomTable();
}

function focusFilterField() {
  focusInputField(document.getElementById("filter"));
}

function focusRefLookupField() {
  focusInputField(document.getElementById("reflookup"));
}

function toggleBomCheckbox(bomrowid, checkboxnum) {
  if (!bomrowid || checkboxnum > settings.checkboxes.length) {
    return;
  }
  var bomrow = document.getElementById(bomrowid);
  var checkbox = bomrow.childNodes[checkboxnum].childNodes[0];
  checkbox.checked = !checkbox.checked;
  checkbox.indeterminate = false;
  checkbox.onchange();
}

function checkBomCheckbox(bomrowid, checkboxname) {
  var checkboxnum = 0;
  while (checkboxnum < settings.checkboxes.length &&
    settings.checkboxes[checkboxnum].toLowerCase() != checkboxname.toLowerCase()) {
    checkboxnum++;
  }
  if (!bomrowid || checkboxnum >= settings.checkboxes.length) {
    return;
  }
  var bomrow = document.getElementById(bomrowid);
  var checkbox = bomrow.childNodes[checkboxnum + 1].childNodes[0];
  checkbox.checked = true;
  checkbox.indeterminate = false;
  checkbox.onchange();
}

function setBomCheckboxes(value) {
  writeStorage("bomCheckboxes", value);
  settings.checkboxes = value.split(",").filter((e) => e);
  prepCheckboxes();
  populateBomTable();
  populateDarkenWhenCheckedOptions();
}

function setDarkenWhenChecked(value) {
  writeStorage("darkenWhenChecked", value);
  settings.darkenWhenChecked = value;
  populateBomTable();
}

function prepCheckboxes() {
  var table = document.getElementById("checkbox-stats");
  while (table.childElementCount > 1) {
    table.removeChild(table.lastChild);
  }
  if (settings.checkboxes.length) {
    table.style.display = "";
  } else {
    table.style.display = "none";
  }
  for (var checkbox of settings.checkboxes) {
    var tr = document.createElement("TR");
    var td = document.createElement("TD");
    td.innerHTML = checkbox;
    tr.appendChild(td);
    td = document.createElement("TD");
    td.id = "checkbox-stats-" + checkbox;
    var progressbar = document.createElement("div");
    progressbar.classList.add("bar");
    td.appendChild(progressbar);
    var text = document.createElement("div");
    text.classList.add("text");
    td.appendChild(text);
    tr.appendChild(td);
    table.appendChild(tr);
    updateCheckboxStats(checkbox);
  }
}

function populateDarkenWhenCheckedOptions() {
  var container = document.getElementById("darkenWhenCheckedContainer");

  if (settings.checkboxes.length == 0) {
    container.parentElement.style.display = "none";
    return;
  }

  container.innerHTML = '';
  container.parentElement.style.display = "inline-block";

  function createOption(name, displayName) {
    var id = "darkenWhenChecked-" + name;

    var div = document.createElement("div");
    div.classList.add("radio-container");

    var input = document.createElement("input");
    input.type = "radio";
    input.name = "darkenWhenChecked";
    input.value = name;
    input.id = id;
    input.onchange = () => setDarkenWhenChecked(name);
    div.appendChild(input);

    // Preserve the selected element when the checkboxes change
    if (name == settings.darkenWhenChecked) {
      input.checked = true;
    }

    var label = document.createElement("label");
    label.innerHTML = displayName;
    label.htmlFor = id;
    div.appendChild(label);

    container.appendChild(div);
  }
  createOption("", "None");
  for (var checkbox of settings.checkboxes) {
    createOption(checkbox, checkbox);
  }
}

function updateCheckboxStats(checkbox) {
  var checked = getStoredCheckboxRefs(checkbox).size;
  var total = pcbdata.footprints.length - pcbdata.bom.skipped.length;
  var percent = checked * 100.0 / total;
  var td = document.getElementById("checkbox-stats-" + checkbox);
  td.firstChild.style.width = percent + "%";
  td.lastChild.innerHTML = checked + "/" + total + " (" + Math.round(percent) + "%)";
}

document.onkeydown = function(e) {
  switch (e.key) {
    case "n":
      if (document.activeElement.type == "text") {
        return;
      }
      if (currentHighlightedRowId !== null) {
        checkBomCheckbox(currentHighlightedRowId, "placed");
        highlightNextRow();
        e.preventDefault();
      }
      break;
    case "ArrowUp":
      highlightPreviousRow();
      e.preventDefault();
      break;
    case "ArrowDown":
      highlightNextRow();
      e.preventDefault();
      break;
    default:
      break;
  }
  if (e.altKey) {
    switch (e.key) {
      case "f":
        focusFilterField();
        e.preventDefault();
        break;
      case "r":
        focusRefLookupField();
        e.preventDefault();
        break;
      case "z":
        changeBomLayout("bom-only");
        e.preventDefault();
        break;
      case "x":
        changeBomLayout("left-right");
        e.preventDefault();
        break;
      case "c":
        changeBomLayout("top-bottom");
        e.preventDefault();
        break;
      case "v":
        changeCanvasLayout("F");
        e.preventDefault();
        break;
      case "b":
        changeCanvasLayout("FB");
        e.preventDefault();
        break;
      case "n":
        changeCanvasLayout("B");
        e.preventDefault();
        break;
      default:
        break;
    }
    if (e.key >= '1' && e.key <= '9') {
      toggleBomCheckbox(currentHighlightedRowId, parseInt(e.key));
    }
  }
}

function hideNetlistButton() {
  document.getElementById("bom-ungrouped-btn").classList.remove("middle-button");
  document.getElementById("bom-ungrouped-btn").classList.add("right-most-button");
  document.getElementById("bom-netlist-btn").style.display = "none";
}

window.onload = function(e) {
  initUtils();
  initRender();
  initStorage();
  initDefaults();
  cleanGutters();
  populateMetadata();
  dbgdiv = document.getElementById("dbg");
  bom = document.getElementById("bombody");
  bomhead = document.getElementById("bomhead");
  filter = "";
  reflookup = "";
  if (!("nets" in pcbdata)) {
    hideNetlistButton();
  }
  initDone = true;
  prepCheckboxes();
  // Triggers render
  changeBomLayout(settings.bomlayout);

  // Users may leave fullscreen without touching the checkbox. Uncheck.
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement)
      document.getElementById('fullscreenCheckbox').checked = false;
  });
}

window.onresize = resizeAll;
window.matchMedia("print").addListener(resizeAll);

///////////////////////////////////////////////

///////////////////////////////////////////////
 
///////////////////////////////////////////////
  </script>
</head>

<body>
<!-- USERHEADER -->
<div id="topmostdiv" class="topmostdiv">
  <div id="top">
    <div style="float: right; height: 100%;">
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="menubtn"></button>
        <div class="menu-content">
          <label class="menu-label menu-label-top" style="width: calc(50% - 18px)">
            <input id="darkmodeCheckbox" type="checkbox" onchange="setDarkMode(this.checked)">
            Dark mode
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label menu-label-top" style="width: calc(50% - 17px); border-left: 0;">
            <input id="fullscreenCheckbox" type="checkbox" onchange="setFullscreen(this.checked)">
            Full Screen
          </label>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="fabricationCheckbox" type="checkbox" checked onchange="fabricationVisible(this.checked)">
            Fab layer
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="silkscreenCheckbox" type="checkbox" checked onchange="silkscreenVisible(this.checked)">
            Silkscreen
          </label>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="referencesCheckbox" type="checkbox" checked onchange="referencesVisible(this.checked)">
            References
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="valuesCheckbox" type="checkbox" checked onchange="valuesVisible(this.checked)">
            Values
          </label>
          <div id="tracksAndZonesCheckboxes">
            <label class="menu-label" style="width: calc(50% - 18px)">
              <input id="tracksCheckbox" type="checkbox" checked onchange="tracksVisible(this.checked)">
              Tracks
            </label><!-- This comment eats space! All of it!
            --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
              <input id="zonesCheckbox" type="checkbox" checked onchange="zonesVisible(this.checked)">
              Zones
            </label>
          </div>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="padsCheckbox" type="checkbox" checked onchange="padsVisible(this.checked)">
            Pads
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="dnpOutlineCheckbox" type="checkbox" checked onchange="dnpOutline(this.checked)">
            DNP outlined
          </label>
          <label class="menu-label">
            <input id="highlightpin1Checkbox" type="checkbox" onchange="setHighlightPin1(this.checked)">
            Highlight first pin
          </label>
          <label class="menu-label">
            <input id="dragCheckbox" type="checkbox" checked onchange="setRedrawOnDrag(this.checked)">
            Continuous redraw on drag
          </label>
          <label class="menu-label">
            <input id="crosshairCheckbox" type="checkbox" checked onchange="setShowCrosshair(this.checked)">
            Show Crosshair
          </label>
          <label class="menu-label">
            <span>Board rotation</span>
            <span style="float: right"><span id="rotationDegree">0</span>&#176;</span>
            <input id="boardRotation" type="range" min="-36" max="36" value="0" class="slider" oninput="setBoardRotation(this.value)">
          </label>
          <label class="menu-label">
            <div style="margin-left: 5px">Bom checkboxes</div>
            <input id="bomCheckboxes" class="menu-textbox" type=text
                   oninput="setBomCheckboxes(this.value)">
          </label>
          <label class="menu-label">
            <div style="margin-left: 5px">Darken when checked</div>
            <div id="darkenWhenCheckedContainer"></div>
          </label>
          <label class="menu-label">
            <span class="shameless-plug">
              <span>Created using</span>
              <a id="github-link" target="blank" href="https://github.com/openscopeproject/InteractiveHtmlBom">InteractiveHtmlBom</a>
            </span>
          </label>
        </div>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="fl-btn" class="left-most-button" onclick="changeCanvasLayout('F')"
                title="Front only">F
        </button>
        <button id="fb-btn" class="middle-button" onclick="changeCanvasLayout('FB')"
                title="Front and Back">FB
        </button>
        <button id="bl-btn" class="right-most-button" onclick="changeCanvasLayout('B')"
                title="Back only">B
        </button>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="bom-btn" class="left-most-button" onclick="changeBomLayout('bom-only')"
                title="BOM only"></button>
        <button id="lr-btn" class="middle-button" onclick="changeBomLayout('left-right')"
                title="BOM left, drawings right"></button>
        <button id="tb-btn" class="right-most-button" onclick="changeBomLayout('top-bottom')"
                title="BOM top, drawings bot"></button>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="bom-grouped-btn" class="left-most-button" onclick="changeBomMode('grouped')"
                title="Grouped BOM"></button>
        <button id="bom-ungrouped-btn" class="middle-button" onclick="changeBomMode('ungrouped')"
                title="Ungrouped BOM"></button>
        <button id="bom-netlist-btn" class="right-most-button" onclick="changeBomMode('netlist')"
                title="Netlist"></button>
      </div>
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="statsbtn"></button>
        <div class="menu-content">
          <table class="stats">
            <tbody>
              <tr>
                <td width="40%">Board stats</td>
                <td>Front</td>
                <td>Back</td>
                <td>Total</td>
              </tr>
              <tr>
                <td>Components</td>
                <td id="stats-components-front">~</td>
                <td id="stats-components-back">~</td>
                <td id="stats-components-total">~</td>
              </tr>
              <tr>
                <td>Groups</td>
                <td id="stats-groups-front">~</td>
                <td id="stats-groups-back">~</td>
                <td id="stats-groups-total">~</td>
              </tr>
              <tr>
                <td>SMD pads</td>
                <td id="stats-smd-pads-front">~</td>
                <td id="stats-smd-pads-back">~</td>
                <td id="stats-smd-pads-total">~</td>
              </tr>
              <tr>
                <td>TH pads</td>
                <td colspan=3 id="stats-th-pads">~</td>
              </tr>
            </tbody>
          </table>
          <table class="stats">
            <col width="40%"/><col />
            <tbody id="checkbox-stats">
              <tr>
                <td colspan=2 style="border-top: 0">Checkboxes</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="iobtn"></button>
        <div class="menu-content">
          <div class="menu-label menu-label-top">
            <div style="margin-left: 5px;">Save board image</div>
            <div class="flexbox">
              <input id="render-save-width" class="menu-textbox" type="text" value="1000" placeholder="Width"
                  style="flex-grow: 1; width: 50px;" oninput="validateSaveImgDimension(this)">
              <span>X</span>
              <input id="render-save-height" class="menu-textbox" type="text" value="1000" placeholder="Height"
                  style="flex-grow: 1; width: 50px;" oninput="validateSaveImgDimension(this)">
            </div>
            <label>
              <input id="render-save-transparent" type="checkbox">
              Transparent background
            </label>
            <div class="flexbox">
              <button class="savebtn" onclick="saveImage('F')">Front</button>
              <button class="savebtn" onclick="saveImage('B')">Back</button>
            </div>
          </div>
          <div class="menu-label">
            <span style="margin-left: 5px;">Config and checkbox state</span>
            <div class="flexbox">
              <button class="savebtn" onclick="saveSettings()">Export</button>
              <button class="savebtn" onclick="loadSettings()">Import</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="fileinfodiv" style="overflow: auto;">
      <table class="fileinfo">
        <tbody>
          <tr>
            <td id="title" class="title" style="width: 70%">
              Title
            </td>
            <td id="revision" class="title" style="width: 30%">
              Revision
            </td>
          </tr>
          <tr>
            <td id="company">
              Company
            </td>
            <td id="filedate">
              Date
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div id="bot" class="split" style="height: calc(100% - 80px)">
    <div id="bomdiv" class="split split-horizontal">
      <div style="width: 100%">
        <input id="reflookup" class="textbox searchbox reflookup hideonprint" type="text" placeholder="Ref lookup"
               oninput="updateRefLookup(this.value)">
        <input id="filter" class="textbox searchbox filter hideonprint" type="text" placeholder="Filter"
               oninput="updateFilter(this.value)">
        <div class="button-container hideonprint" style="float: left; margin: 0;">
          <button id="copy" title="Copy bom table to clipboard"
               onclick="copyToClipboard()"></button>
        </div>
      </div>
      <div id="dbg"></div>
      <table class="bom">
        <thead id="bomhead">
        </thead>
        <tbody id="bombody">
        </tbody>
      </table>
    </div>
    <div id="canvasdiv" class="split split-horizontal">
      <div id="frontcanvas" class="split" touch-action="none" style="overflow: hidden">
        <div style="position: relative; width: 100%; height: 100%;">
          <canvas id="F_bg" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
          <canvas id="F_fab" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
          <canvas id="F_slk" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
          <canvas id="F_hl" style="position: absolute; left: 0; top: 0; z-index: 3;"></canvas>
        </div>
      </div>
      <div id="backcanvas" class="split" touch-action="none" style="overflow: hidden">
        <div style="position: relative; width: 100%; height: 100%;">
          <canvas id="B_bg" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
          <canvas id="B_fab" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
          <canvas id="B_slk" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
          <canvas id="B_hl" style="position: absolute; left: 0; top: 0; z-index: 3;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- USERFOOTER -->
</body>

</html>
